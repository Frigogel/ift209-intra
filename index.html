<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INF â€” Notes de cours interactives</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;700;800&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0d0f14;
  --surface: #141720;
  --surface2: #1c2030;
  --border: #252a3a;
  --accent: #5b8dee;
  --text: #e0e4f0;
  --muted: #7a8099;
  --sidebar-w: 260px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Lato', sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  min-height: 100vh;
}

/* â”€â”€ SIDEBAR â”€â”€ */
#sidebar {
  width: var(--sidebar-w);
  background: #0a0c11;
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 200;
  transition: transform 0.3s cubic-bezier(.4,0,.2,1);
  overflow: hidden;
}
.sidebar-logo {
  padding: 1.4rem 1.25rem 1rem;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.sidebar-logo .logo-chip {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.58rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 0.35rem;
}
.sidebar-logo h2 {
  font-family: 'Syne', sans-serif;
  font-size: 0.95rem;
  font-weight: 800;
  color: var(--text);
  line-height: 1.25;
}
.sidebar-logo h2 span { color: var(--accent); }

.sidebar-nav {
  flex: 1;
  overflow-y: auto;
  padding: 0.6rem 0;
  scrollbar-width: thin;
  scrollbar-color: var(--border) transparent;
}
.nav-item {
  display: flex;
  align-items: flex-start;
  gap: 0.7rem;
  padding: 0.75rem 1.1rem;
  cursor: pointer;
  border-left: 3px solid transparent;
  transition: background 0.15s, border-color 0.15s;
}
.nav-item:hover { background: rgba(255,255,255,0.03); }
.nav-item.active {
  border-left-color: var(--ch-accent);
  background: rgba(255,255,255,0.04);
}
.nav-num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.62rem;
  color: var(--muted);
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 3px;
  padding: 2px 5px;
  margin-top: 2px;
  flex-shrink: 0;
  transition: all 0.2s;
}
.nav-item.active .nav-num {
  color: var(--ch-accent);
  background: rgba(255,255,255,0.08);
  border-color: rgba(255,255,255,0.15);
}
.nav-text { flex: 1; min-width: 0; }
.nav-ch {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.57rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 2px;
}
.nav-title {
  font-family: 'Syne', sans-serif;
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--text);
  line-height: 1.3;
  white-space: normal;
}
.nav-item.active .nav-title { color: var(--ch-accent); }

.sidebar-footer {
  padding: 0.9rem 1.25rem;
  border-top: 1px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.58rem;
  color: var(--muted);
  flex-shrink: 0;
}

/* â”€â”€ MAIN â”€â”€ */
#main {
  margin-left: var(--sidebar-w);
  flex: 1;
  min-width: 0;
  position: relative;
}

/* progress bar */
#progress {
  position: fixed;
  top: 0;
  left: var(--sidebar-w);
  right: 0;
  height: 2px;
  background: var(--accent);
  z-index: 300;
  transform-origin: left;
  transform: scaleX(0);
  transition: transform 0.08s linear;
  pointer-events: none;
}

/* â”€â”€ WELCOME â”€â”€ */
#welcome {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 3rem 2rem;
  text-align: center;
  position: relative;
}
#welcome::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at 50% 35%, rgba(91,141,238,0.07) 0%, transparent 65%);
  pointer-events: none;
}
.w-chip {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  color: var(--accent);
  background: rgba(91,141,238,0.1);
  border: 1px solid rgba(91,141,238,0.22);
  border-radius: 4px;
  padding: 4px 12px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 1.5rem;
  display: inline-block;
  position: relative;
}
#welcome h1 {
  font-family: 'Syne', sans-serif;
  font-size: clamp(1.8rem, 4.5vw, 3.2rem);
  font-weight: 800;
  line-height: 1.1;
  margin-bottom: 0.9rem;
  position: relative;
}
#welcome h1 em { font-style: normal; color: var(--accent); }
#welcome p {
  font-size: 1rem;
  color: var(--muted);
  font-weight: 300;
  max-width: 480px;
  line-height: 1.6;
  margin-bottom: 2.5rem;
  position: relative;
}
.ch-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
  gap: 0.85rem;
  max-width: 820px;
  width: 100%;
  position: relative;
}
.ch-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 1.1rem 1.1rem 1rem;
  cursor: pointer;
  text-align: left;
  transition: border-color 0.2s, transform 0.15s, box-shadow 0.2s;
}
.ch-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 28px rgba(0,0,0,0.35);
}
.ch-card-num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 0.45rem;
  font-weight: 600;
}
.ch-card-title {
  font-family: 'Syne', sans-serif;
  font-size: 0.85rem;
  font-weight: 700;
  margin-bottom: 0.3rem;
  line-height: 1.3;
}
.ch-card-desc {
  font-size: 0.72rem;
  color: var(--muted);
  line-height: 1.45;
}

/* â”€â”€ CHAPTER FRAME (iframe approach) â”€â”€ */
.ch-frame {
  display: none;
  width: 100%;
  min-height: 100vh;
  border: none;
  background: #0d0f14;
}
.ch-frame.active { display: block; }

/* â”€â”€ MOBILE â”€â”€ */
#menu-btn {
  display: none;
  position: fixed;
  top: 0.8rem; left: 0.8rem;
  z-index: 300;
  background: var(--surface2);
  border: 1px solid var(--border);
  color: var(--text);
  font-size: 1.1rem;
  width: 38px; height: 38px;
  border-radius: 7px;
  cursor: pointer;
  align-items: center;
  justify-content: center;
}
#overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  z-index: 150;
}

@media (max-width: 768px) {
  #sidebar { transform: translateX(-100%); }
  #sidebar.open { transform: translateX(0); }
  #main { margin-left: 0; }
  #menu-btn { display: flex; }
  #progress { left: 0; }
  #overlay.show { display: block; }
}
</style>
</head>
<body>

<div id="overlay" onclick="closeSidebar()"></div>
<button id="menu-btn" onclick="toggleSidebar()">â˜°</button>

<aside id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-chip">IFT209 Â· Architecture &amp; Assembleur</div>
    <h2>Notes de cours <span>interactives</span></h2>
  </div>
  <nav class="sidebar-nav" id="snav"></nav>
  <div class="sidebar-footer">6 chapitres Â· ARM v8 Â· IFT209</div>
</aside>

<div id="main">
  <div id="progress"></div>

  <div id="welcome">
    <span class="w-chip">INF â€” Architecture &amp; Assembleur</span>
    <h1>Notes de cours <em>interactives</em></h1>
    <p>Six chapitres couvrant les systÃ¨mes de numÃ©ration, l'architecture des ordinateurs et la programmation ARM v8.</p>
    <div class="ch-grid" id="ch-grid"></div>
  </div>

  <div id="ch-container"></div>
</div>

<!-- CHAPTERS DATA INJECTED BELOW -->
<script>
const CHAPTERS = [
  {
    title: `Chapitre 1`,
    subtitle: `SystÃ¨mes de numÃ©ration`,
    desc: `Bases, conversions, reprÃ©sentation`,
    accent: `#5b8dee`,
    css: `
  :root {
    --bg: #0d0f14;
    --surface: #141720;
    --surface2: #1c2030;
    --border: #252a3a;
    --accent: #5b8dee;
    --accent2: #e05c7a;
    --accent3: #36c9a0;
    --accent4: #f5a623;
    --purple: #c97af5;
    --text: #e0e4f0;
    --muted: #7a8099;
    --code-bg: #0a0c11;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Lato', sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; }

  header {
    background: linear-gradient(135deg, #0d1220 0%, #111827 100%);
    border-bottom: 1px solid var(--border);
    padding: 3rem 2rem 2rem;
    position: relative; overflow: hidden;
  }
  header::before {
    content: ''; position: absolute; top: -60px; right: -60px;
    width: 350px; height: 350px;
    background: radial-gradient(circle, rgba(91,141,238,0.1) 0%, transparent 70%);
    pointer-events: none;
  }
  .chip {
    display: inline-block;
    background: rgba(91,141,238,0.12);
    border: 1px solid rgba(91,141,238,0.3);
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem; padding: 3px 10px; border-radius: 4px;
    letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 1rem;
  }
  h1 { font-family: 'Syne', sans-serif; font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 800; line-height: 1.15; margin-bottom: 0.5rem; }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 1rem; font-weight: 300; }

  .toc-bar {
    background: var(--surface); border-bottom: 1px solid var(--border);
    padding: 0.75rem 2rem; display: flex; gap: 0.5rem; flex-wrap: wrap;
    position: sticky; top: 0; z-index: 100;
  }
  .toc-btn {
    font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
    padding: 4px 12px; border-radius: 4px; border: 1px solid var(--border);
    background: transparent; color: var(--muted); cursor: pointer;
    transition: all 0.2s; text-decoration: none;
  }
  .toc-btn:hover { background: var(--surface2); color: var(--text); border-color: var(--accent); }

  main { max-width: 980px; margin: 0 auto; padding: 2.5rem 1.5rem 5rem; }

  .section {
    margin-bottom: 2rem; border: 1px solid var(--border); border-radius: 12px;
    overflow: hidden; background: var(--surface); transition: border-color 0.3s;
  }
  .section:hover { border-color: rgba(91,141,238,0.25); }
  .section-header {
    padding: 1.1rem 1.5rem; display: flex; align-items: center; gap: 0.9rem;
    cursor: pointer; user-select: none; background: var(--surface2); transition: background 0.2s;
  }
  .section-header:hover { background: #1f2538; }
  .section-num {
    font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--accent);
    background: rgba(91,141,238,0.1); border: 1px solid rgba(91,141,238,0.25);
    border-radius: 4px; padding: 2px 7px;
  }
  .section-title { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700; flex: 1; }
  .chevron { color: var(--muted); font-size: 0.75rem; transition: transform 0.25s; }
  .section.collapsed .chevron { transform: rotate(-90deg); }
  .section-body { padding: 1.5rem; }
  .section.collapsed .section-body { display: none; }

  p { font-size: 0.94rem; margin-bottom: 0.75rem; }

  .highlight-box { border-left: 3px solid var(--accent); background: rgba(91,141,238,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .warn-box { border-left: 3px solid var(--accent2); background: rgba(224,92,122,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .tip-box { border-left: 3px solid var(--accent3); background: rgba(54,201,160,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .purple-box { border-left: 3px solid var(--purple); background: rgba(201,122,245,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .box-label { font-family: 'JetBrains Mono', monospace; font-size: 0.63rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.35rem; font-weight: 700; }
  .label-blue { color: var(--accent); } .label-red { color: var(--accent2); } .label-green { color: var(--accent3); } .label-orange { color: var(--accent4); } .label-purple { color: var(--purple); }

  pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px; padding: 1rem 1.2rem; overflow-x: auto; margin: 1rem 0; }
  code { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; line-height: 1.85; color: #c9d0e8; }

  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; margin: 1rem 0; }
  th { background: var(--surface2); color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.07em; padding: 0.6rem 0.9rem; border: 1px solid var(--border); text-align: center; }
  td { padding: 0.55rem 0.9rem; border: 1px solid var(--border); vertical-align: middle; text-align: center; }
  tr:hover td { background: rgba(255,255,255,0.02); }
  .mono { font-family: 'JetBrains Mono', monospace; color: var(--accent3); font-size: 0.82rem; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0; }
  @media (max-width: 600px) { .two-col { grid-template-columns: 1fr; } }
  .mini-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 0.9rem 1rem; }
  .mini-card .mc-title { font-family:'JetBrains Mono',monospace; color: var(--accent4); font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem; }

  .formula {
    background: var(--code-bg); border: 1px solid rgba(91,141,238,0.3);
    border-radius: 8px; padding: 0.9rem 1.2rem; margin: 1rem 0;
    font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
    color: var(--text); text-align: center; line-height: 2;
  }
  .formula .fa { color: var(--accent2); }
  .formula .fb { color: var(--accent3); }
  .formula .fc { color: var(--accent4); }
  .formula .fd { color: var(--purple); }

  /* VIZ TOOL */
  .viz-tool {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; padding: 1.4rem; margin: 1rem 0;
  }
  .viz-tool h4 { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 700; color: var(--accent4); margin-bottom: 1.1rem; }
  .viz-input-row { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .viz-input {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px;
    color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;
    padding: 0.45rem 0.65rem; width: 100px; outline: none; transition: border-color 0.2s;
  }
  .viz-input:focus { border-color: var(--accent); }
  .viz-btn {
    background: rgba(91,141,238,0.15); border: 1px solid rgba(91,141,238,0.35);
    color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
    padding: 0.45rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
  }
  .viz-btn:hover { background: rgba(91,141,238,0.28); }
  .viz-result {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px;
    padding: 0.85rem 1rem; margin-top: 0.75rem; font-family: 'JetBrains Mono', monospace; font-size: 0.84rem; line-height: 2;
  }
  .viz-result .step { display: flex; gap: 0.6rem; align-items: baseline; flex-wrap: wrap; margin-bottom: 0.2rem; }
  .viz-result .step-label { color: var(--muted); font-size: 0.75rem; min-width: 180px; }
  .viz-result .step-val { color: var(--text); }
  .viz-result .step-val em { color: var(--accent4); font-style: normal; }

  /* CONVERSION STEPS */
  .steps-list { margin: 0.5rem 0; padding: 0; list-style: none; }
  .steps-list li {
    font-family: 'JetBrains Mono', monospace; font-size: 0.82rem;
    padding: 0.3rem 0.6rem; border-left: 2px solid var(--border);
    margin-bottom: 0.25rem; color: var(--muted); transition: all 0.2s;
  }
  .steps-list li.active { border-left-color: var(--accent4); color: var(--accent4); background: rgba(245,166,35,0.07); border-radius: 0 6px 6px 0; }
  .steps-list li span.rem { color: var(--accent3); font-weight: 700; }
  .steps-list li span.quot { color: var(--text); }

  /* BASE TABLE */
  .base-table { font-family: 'JetBrains Mono', monospace; }
  .base-table td.dec { color: var(--text); }
  .base-table td.bin { color: var(--accent3); }
  .base-table td.oct { color: var(--accent4); }
  .base-table td.hex { color: var(--accent2); }
  .base-table tr.highlight-row td { background: rgba(91,141,238,0.12); font-weight: 700; }

  /* QUIZ */
  .quiz-wrap { margin-top: 2.5rem; }
  .quiz-wrap h3 { font-family: 'Syne', sans-serif; font-size: 1rem; margin-bottom: 1rem; color: var(--accent); }
  .quiz-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1.2rem 1.4rem; margin-bottom: 1rem; }
  .quiz-q { font-size: 0.92rem; margin-bottom: 0.75rem; }
  .quiz-opts { display: flex; flex-direction: column; gap: 0.4rem; }
  .quiz-opt {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 6px;
    padding: 0.55rem 0.85rem; cursor: pointer; font-size: 0.88rem; transition: all 0.15s;
    font-family: 'Lato', sans-serif; color: var(--text); text-align: left;
  }
  .quiz-opt:hover { border-color: var(--accent); }
  .quiz-opt:disabled { cursor: default; }
  .quiz-opt.correct { border-color: var(--accent3); background: rgba(54,201,160,0.1); color: var(--accent3); }
  .quiz-opt.wrong { border-color: var(--accent2); background: rgba(224,92,122,0.1); color: var(--accent2); }
  .quiz-feedback { font-size: 0.83rem; margin-top: 0.6rem; color: var(--muted); font-style: italic; }

  select.viz-input { width: auto; }
`,
    body: `<header>
  <div class="chip">INF â€” Architecture</div>
  <h1>Chapitre 1 â€” <span>SystÃ¨mes de numÃ©ration</span></h1>
  <p class="subtitle">Bases, conversions, reprÃ©sentation des nombres Â· Notes de cours interactives</p>
</header>

<nav class="toc-bar">
  <a class="toc-btn" href="#s1">01 ReprÃ©sentation</a>
  <a class="toc-btn" href="#s2">02 SystÃ¨mes positionnels</a>
  <a class="toc-btn" href="#s3">03 Binaire & bases</a>
  <a class="toc-btn" href="#s4">04 Tableau de bases</a>
  <a class="toc-btn" href="#s5">05 Valeur maximale</a>
  <a class="toc-btn" href="#s6">06 Conversions</a>
  <a class="toc-btn" href="#s6b">07 Fractions â†’ base B</a>
  <a class="toc-btn" href="#s6c">08 B1 â†’ B2 direct</a>
  <a class="toc-btn" href="#s7">09 Nomenclature</a>
  <a class="toc-btn" href="#quiz">ğŸ§  Quiz</a>
</nav>

<main>

<!-- S1 -->
<div class="section" id="s1">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">01</span>
    <span class="section-title">ReprÃ©sentation des nombres</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Il existe plusieurs faÃ§ons de reprÃ©senter des nombres. Un <strong>systÃ¨me de numÃ©ration</strong> (Î·) est un couple composÃ© d'un ensemble de symboles <em>S</em> et d'un ensemble de rÃ¨gles <em>R</em>.</p>
    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Nombres cardinaux</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âœ¦ Utilise un <strong>symbole Ã©talon</strong> rÃ©pÃ©tÃ©<br>
          âœ¦ Exemple : <code>I â†’ 1</code>, <code>IIIIIIII â†’ 8</code><br>
          âœ¦ Simple mais peu pratique pour grands nombres
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Nombres ordinaux</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âœ¦ Valeur de base <strong>0</strong><br>
          âœ¦ Principe de succession : <code>succ(0) := 1</code><br>
          âœ¦ Indique un rang dans un ensemble ordonnÃ©
        </div>
      </div>
    </div>
    <div class="highlight-box">
      <div class="box-label label-blue">Exemple â€” Chiffres romains</div>
      S = { I, V, X, L, C, D, M }<br>
      R = rÃ¨gles d'Ã©criture romaines<br>
      <code>IV = 4</code> &nbsp;Â·&nbsp; <code>LXVI = 66</code><br>
      <strong>âš  La valeur d'un symbole ne dÃ©pend pas de sa position</strong> (systÃ¨me non positionnel)
    </div>
  </div>
</div>

<!-- S2 -->
<div class="section" id="s2">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">02</span>
    <span class="section-title">SystÃ¨mes de numÃ©ration positionnels</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Un systÃ¨me positionnel ajoute une <strong>base B</strong> au systÃ¨me de numÃ©ration. La valeur d'un symbole dÃ©pend alors de sa position.</p>

    <div class="formula">
      <span class="fb">Valeur</span> = Î£ <span class="fa">s<sub>i</sub></span> Ã— <span class="fc">B<sup>i</sup></span>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">RÃ¨gles fondamentales</div>
      âœ¦ Le nombre d'Ã©lÃ©ments dans S est Ã©gal Ã  <strong>B</strong><br>
      âœ¦ La valeur maximale d'un symbole est <strong>B âˆ’ 1</strong><br>
      âœ¦ Un symbole <code>a</code> Ã  la i<sup>Ã¨me</sup> position vaut <strong>a Ã— B<sup>i</sup></strong>
    </div>

    <p>Exemple avec le systÃ¨me dÃ©cimal (B = 10) :</p>
    <div class="formula">
      545 = <span class="fa">5</span> Ã— 10Â² + <span class="fb">4</span> Ã— 10Â¹ + <span class="fc">5</span> Ã— 10â° = <span class="fa">500</span> + <span class="fb">40</span> + <span class="fc">5</span>
    </div>
    <p>Pour les fractions, on utilise les puissances <strong>nÃ©gatives</strong> :</p>
    <div class="formula">
      0,85 = <span class="fa">8</span> Ã— 10<sup>âˆ’1</sup> + <span class="fb">5</span> Ã— 10<sup>âˆ’2</sup>
    </div>
  </div>
</div>

<!-- S3 -->
<div class="section" id="s3">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">03</span>
    <span class="section-title">Binaire, Octal, HexadÃ©cimal</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Les ordinateurs fonctionnent Ã  l'Ã©lectricitÃ© (courant passe = 1, ne passe pas = 0), ce qui les pousse naturellement Ã  utiliser le <strong>binaire</strong> (base 2). Les bases 8 et 16 servent de raccourcis pratiques.</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Binaire (Base 2)</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          S = { 0, 1 }<br>
          Exemple : <code>1011,1101â‚‚</code><br>
          = 1Ã—2Â³ + 1Ã—2Â¹ + 1Ã—2â° + 1Ã—2â»Â¹ + 1Ã—2â»Â² + 1Ã—2â»â´<br>
          = <strong style="color:var(--accent4)">11,8125â‚â‚€</strong>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Hex (Base 16)</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          S = { 0â€¦9, A, B, C, D, E, F }<br>
          1 chiffre hex = <strong>4 bits</strong><br>
          Exemple : <code>0xFF = 255â‚â‚€</code><br>
          TrÃ¨s utilisÃ© pour reprÃ©senter la mÃ©moire
        </div>
      </div>
    </div>

    <div class="tip-box">
      <div class="box-label label-green">Astuce mnÃ©motechnique</div>
      Octal (base 8) â†’ groupe de <strong>3 bits</strong><br>
      HexadÃ©cimal (base 16) â†’ groupe de <strong>4 bits</strong><br>
      Ces groupements permettent de convertir directement depuis/vers le binaire !
    </div>

    <!-- INTERACTIVE BASE CONVERTER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Convertisseur interactif de bases</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Valeur dÃ©cimale (entier) :</label>
        <input class="viz-input" type="number" id="conv-dec" value="42" min="0" max="65535" oninput="convertFromDec()">
      </div>
      <div class="viz-result" id="conv-result"></div>
    </div>
  </div>
</div>

<!-- S4 -->
<div class="section" id="s4">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">04</span>
    <span class="section-title">Tableau de correspondance des bases</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Il est essentiel de connaÃ®tre les 16 premiÃ¨res valeurs en binaire, octal et hexadÃ©cimal. Survolez une ligne pour la mettre en Ã©vidence.</p>
    <table class="base-table" id="base-table">
      <thead>
        <tr><th>DÃ©cimal</th><th>Binaire</th><th>Octal</th><th>HexadÃ©cimal</th></tr>
      </thead>
      <tbody id="base-tbody"></tbody>
    </table>
    <div class="highlight-box">
      <div class="box-label label-blue">Ã€ retenir absolument</div>
      Les valeurs 0â€“15 en binaire sont la base de tout. Ensuite, par <strong>groupement</strong> (3 bits â†’ octal, 4 bits â†’ hex) on convertit instantanÃ©ment.
    </div>
  </div>
</div>

<!-- S5 -->
<div class="section" id="s5">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">05</span>
    <span class="section-title">Valeur maximale reprÃ©sentable</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Il est utile de connaÃ®tre le plus grand entier positif qu'un systÃ¨me positionnel peut reprÃ©senter avec <em>n</em> symboles en base <em>B</em> :</p>

    <div class="formula">
      Max(B, n) = <span class="fc">B<sup>n</sup></span> âˆ’ 1
    </div>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Exemples courants</div>
        <div style="font-size:0.88rem; line-height:2;">
          8 bits binaires â†’ Max = 2â¸ âˆ’ 1 = <strong style="color:var(--accent4)">255</strong><br>
          16 bits â†’ Max = 2Â¹â¶ âˆ’ 1 = <strong style="color:var(--accent4)">65 535</strong><br>
          32 bits â†’ Max = 2Â³Â² âˆ’ 1 = <strong style="color:var(--accent4)">4 294 967 295</strong>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Calcul rapide</div>
        <div style="font-size:0.88rem; line-height:2;">
          Base 10, 3 chiffres â†’ Max = 10Â³ âˆ’ 1 = <strong style="color:var(--accent3)">999</strong><br>
          Base 16, 2 chiffres â†’ Max = 16Â² âˆ’ 1 = <strong style="color:var(--accent3)">255</strong><br>
          Base 2, 4 bits â†’ Max = 2â´ âˆ’ 1 = <strong style="color:var(--accent3)">15</strong>
        </div>
      </div>
    </div>

    <!-- MAX VALUE CALCULATOR -->
    <div class="viz-tool">
      <h4>ğŸ”§ Calculateur de valeur maximale</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Base B :</label>
        <input class="viz-input" type="number" id="max-b" value="2" min="2" max="36">
        <label style="font-size:0.85rem; color:var(--muted);">Nb symboles n :</label>
        <input class="viz-input" type="number" id="max-n" value="8" min="1" max="32">
        <button class="viz-btn" onclick="calcMax()">Calculer</button>
      </div>
      <div class="viz-result" id="max-result" style="display:none;"></div>
    </div>
  </div>
</div>

<!-- S6 -->
<div class="section" id="s6">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">06</span>
    <span class="section-title">Conversions entre bases</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Il y a <strong>6 cas de conversion</strong> selon les bases d'origine et de destination. Deux mÃ©thodes fondamentales :</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">X_B â†’ Y_10 (expansion)</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          On fait la <strong>somme des puissances</strong> :<br>
          <code>4125 = 4Ã—5Â² + 1Ã—5Â¹ + 2Ã—5â° = 107â‚â‚€</code>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Y_10 â†’ X_B (divisions)</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          <strong>Divisions successives</strong> par B, on lit les restes de bas en haut.<br>
          Fractions : <strong>multiplications</strong> successives par B.
        </div>
      </div>
    </div>

    <div class="tip-box">
      <div class="box-label label-green">Cas spÃ©ciaux â€” groupement / Ã©clatement</div>
      <strong>X_B â†’ Y_B^m</strong> : grouper les bits par m (depuis la droite pour entiers)<br>
      <strong>X_B^m â†’ Y_B</strong> : Ã©clater chaque symbole en m symboles de base B<br>
      <strong>X_B^m â†’ Y_B^n</strong> : Ã©clater vers la base, puis regrouper vers B^n
    </div>

    <!-- DIVISION CONVERTER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Convertisseur par divisions successives (Yâ‚â‚€ â†’ X_B)</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Nombre dÃ©cimal :</label>
        <input class="viz-input" type="number" id="div-num" value="314" min="0" max="100000">
        <label style="font-size:0.85rem; color:var(--muted);">Base B :</label>
        <input class="viz-input" type="number" id="div-base" value="3" min="2" max="16">
        <button class="viz-btn" onclick="divConvert()">Convertir</button>
      </div>
      <div id="div-result"></div>
    </div>

    <!-- GROUPING TOOL -->
    <div class="viz-tool">
      <h4>ğŸ”§ Groupement binaire â†’ Hex ou Octal</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Nombre binaire :</label>
        <input class="viz-input" type="text" id="grp-bin" value="100111101" style="width:160px;" placeholder="ex: 100111101">
        <label style="font-size:0.85rem; color:var(--muted);">Vers :</label>
        <select class="viz-input" id="grp-target">
          <option value="16">HexadÃ©cimal (4 bits)</option>
          <option value="8">Octal (3 bits)</option>
        </select>
        <button class="viz-btn" onclick="groupConvert()">Convertir</button>
      </div>
      <div id="grp-result"></div>
    </div>
  </div>
</div>

<!-- S6b -->
<div class="section" id="s6b">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">07</span>
    <span class="section-title">Conversion dÃ©cimal â†’ base B : partie fractionnaire</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Pour la partie entiÃ¨re on utilisait des <strong>divisions</strong> successives. Pour la partie fractionnaire, on utilise des <strong>multiplications</strong> successives par B. Ã€ chaque Ã©tape, la <strong>partie entiÃ¨re</strong> du rÃ©sultat donne le prochain chiffre (aprÃ¨s la virgule, de gauche Ã  droite).</p>

    <div class="formula">
      0,<span class="fa">d</span><sub>-1</sub><span class="fa">d</span><sub>-2</sub>â€¦ = partie fractionnaire Ã— <span class="fc">B</span> â†’ on extrait la partie entiÃ¨re
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Algorithme â€” multiplications successives</div>
      1. Prendre la <strong>partie fractionnaire</strong> du nombre<br>
      2. La multiplier par <strong>B</strong><br>
      3. La <strong>partie entiÃ¨re</strong> du rÃ©sultat = prochain symbole (d<sub>-1</sub>, d<sub>-2</sub>â€¦)<br>
      4. RÃ©pÃ©ter avec la <strong>nouvelle partie fractionnaire</strong><br>
      5. S'arrÃªter quand la partie fractionnaire = 0, ou aprÃ¨s n chiffres souhaitÃ©s
    </div>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Exemple â€” 0,314â‚â‚€ en base 3</div>
        <div style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; line-height:2.1;">
          0,314 Ã— 3 = <span style="color:var(--accent3)">0</span>,942<br>
          0,942 Ã— 3 = <span style="color:var(--accent3)">2</span>,826<br>
          0,826 Ã— 3 = <span style="color:var(--accent3)">2</span>,478<br>
          0,478 Ã— 3 = <span style="color:var(--accent3)">1</span>,434<br>
          0,434 Ã— 3 = <span style="color:var(--accent3)">1</span>,302<br>
          0,302 Ã— 3 = <span style="color:var(--accent3)">0</span>,906<br>
          â†’ <strong style="color:var(--accent4)">0,022110â‚ƒ</strong>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Remarque importante</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âš  Certaines fractions ont une reprÃ©sentation <strong>finie</strong> en base 10 mais <strong>infinie</strong> en base 2 (et vice-versa).<br><br>
          Ex : 0,1â‚â‚€ = 0,0001100110011â€¦â‚‚ (pÃ©riodique !)<br><br>
          C'est une source d'erreurs dans les calculs flottants.
        </div>
      </div>
    </div>

    <!-- FRAC CONVERTER TOOL -->
    <div class="viz-tool">
      <h4>ğŸ”§ Convertisseur de fraction dÃ©cimale â†’ base B</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Fraction (ex: 0.314) :</label>
        <input class="viz-input" type="text" id="frac-num" value="0.314" style="width:120px;" placeholder="ex: 0.314">
        <label style="font-size:0.85rem; color:var(--muted);">Base B :</label>
        <input class="viz-input" type="number" id="frac-base" value="3" min="2" max="16">
        <label style="font-size:0.85rem; color:var(--muted);">Nb de chiffres :</label>
        <input class="viz-input" type="number" id="frac-digits" value="6" min="1" max="16">
        <button class="viz-btn" onclick="fracConvert()">Convertir</button>
      </div>
      <div id="frac-result"></div>
    </div>

    <div class="tip-box">
      <div class="box-label label-green">Nombre complet (entier + fraction)</div>
      Pour un nombre comme <strong>314,314â‚â‚€</strong> en base 3 :<br>
      â†’ On convertit <strong>314â‚â‚€</strong> par divisions successives â†’ <strong>102122â‚ƒ</strong><br>
      â†’ On convertit <strong>0,314â‚â‚€</strong> par multiplications successives â†’ <strong>0,022110â‚ƒ</strong><br>
      â†’ RÃ©sultat : <strong style="color:var(--accent4)">102122,022110â‚ƒ</strong>
    </div>
  </div>
</div>

<!-- S6c -->
<div class="section" id="s6c">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">08</span>
    <span class="section-title">Conversion directe B1 â†’ B2 sans passer par le dÃ©cimal</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>On peut convertir directement d'une base B1 vers une base B2 <strong>en effectuant les calculs dans la base B2</strong>. On fait l'expansion du nombre en base B1, mais en remplaÃ§ant chaque symbole et la base B1 par leurs Ã©quivalents en base B2.</p>

    <div class="formula">
      Y<sub><span class="fb">B2</span></sub> = Î£ <span class="fa">d<sub>i</sub></span><sub>[B2]</sub> Ã— (<span class="fc">B1</span><sub>[B2]</sub>)<sup>i</sup>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">MÃ©thode â€” expansion dans la base cible</div>
      1. Exprimer chaque <strong>symbole</strong> de la base B1 dans la base B2<br>
      2. Exprimer la <strong>base B1 elle-mÃªme</strong> dans la base B2<br>
      3. Faire l'expansion (somme de puissances) <strong>en arithmÃ©tique de la base B2</strong>
    </div>

    <div class="mini-card" style="margin: 1rem 0;">
      <div class="mc-title">Exemple â€” 165â‚‰ â†’ base 5</div>
      <div style="font-family:'JetBrains Mono',monospace; font-size:0.84rem; line-height:2.2;">
        Ã‰tape 1 â€” Convertir chaque symbole en base 5 :<br>
        &nbsp;&nbsp;9 = 14â‚… &nbsp;Â·&nbsp; 1â‚‰ = 1â‚… &nbsp;Â·&nbsp; 6â‚‰ = 11â‚… &nbsp;Â·&nbsp; 5â‚‰ = 10â‚…<br><br>
        Ã‰tape 2 â€” Expansion en base 5 :<br>
        &nbsp;&nbsp;= 1â‚… Ã— 14â‚…Â² + 11â‚… Ã— 14â‚…Â¹ + 10â‚… Ã— 14â‚…â°<br>
        &nbsp;&nbsp;= 1â‚… Ã— 311â‚… + 11â‚… Ã— 14â‚… + 10â‚…<br>
        &nbsp;&nbsp;= 311â‚… + 204â‚… + 10â‚…<br>
        &nbsp;&nbsp;= <strong style="color:var(--accent4)">1030â‚…</strong>
      </div>
    </div>

    <div class="warn-box">
      <div class="box-label label-red">Attention</div>
      Il faut connaÃ®tre l'arithmÃ©tique de la base cible (additions et multiplications en base B2). Cette mÃ©thode est plus directe mais demande de la rigueur. En pratique, il est souvent plus simple de <strong>passer par la base 10</strong> comme base intermÃ©diaire, sauf pour les conversions binaire â†” octal â†” hex.
    </div>

    <!-- B1 to B2 TOOL -->
    <div class="viz-tool">
      <h4>ğŸ”§ Convertisseur B1 â†’ B2 (via base 10 comme intermÃ©diaire)</h4>
      <p style="font-size:0.82rem; color:var(--muted); margin-bottom:0.8rem;">Cet outil montre les deux Ã©tapes : d'abord l'expansion vers la base 10, puis la conversion vers B2 â€” ce qui illustre la mÃ©thode indirecte (base intermÃ©diaire).</p>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Nombre :</label>
        <input class="viz-input" type="text" id="b1b2-num" value="165" style="width:100px;" placeholder="ex: 165">
        <label style="font-size:0.85rem; color:var(--muted);">Base source B1 :</label>
        <input class="viz-input" type="number" id="b1b2-b1" value="9" min="2" max="16">
        <label style="font-size:0.85rem; color:var(--muted);">Base cible B2 :</label>
        <input class="viz-input" type="number" id="b1b2-b2" value="5" min="2" max="16">
        <button class="viz-btn" onclick="b1b2Convert()">Convertir</button>
      </div>
      <div id="b1b2-result"></div>
    </div>

    <div class="purple-box">
      <div class="box-label label-purple">Cas spÃ©cial â€” bases puissances l'une de l'autre</div>
      Quand B2 = B1<sup>m</sup> (ou l'inverse), on peut utiliser directement le <strong>groupement / Ã©clatement</strong> sans calcul :<br><br>
      Binaire â†” Octal : groupes de <strong>3 bits</strong><br>
      Binaire â†” Hex : groupes de <strong>4 bits</strong><br>
      Octal â†” Hex : passer par le binaire (Ã©clater en 3, regrouper en 4)
    </div>
  </div>
</div>

<!-- S7 -->
<div class="section" id="s7">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">09</span>
    <span class="section-title">Nomenclature â€” PrÃ©fixes</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>En informatique, on utilise deux types de prÃ©fixes : les prÃ©fixes <strong>dÃ©cimaux</strong> (puissances de 10) et les prÃ©fixes <strong>binaires</strong> (puissances de 2) pour les octets.</p>

    <div class="two-col">
      <div style="">
        <table>
          <thead><tr><th>PrÃ©fixe</th><th>Puissance de 10</th></tr></thead>
          <tbody>
            <tr><td>Kilo (k)</td><td>10Â³</td></tr>
            <tr><td>MÃ©ga (M)</td><td>10â¶</td></tr>
            <tr><td>Giga (G)</td><td>10â¹</td></tr>
            <tr><td>TÃ©ra (T)</td><td>10Â¹Â²</td></tr>
            <tr><td>PÃ©ta (P)</td><td>10Â¹âµ</td></tr>
            <tr><td>Exa (E)</td><td>10Â¹â¸</td></tr>
          </tbody>
        </table>
      </div>
      <div>
        <table>
          <thead><tr><th>PrÃ©fixe (octets)</th><th>Puissance de 2</th></tr></thead>
          <tbody>
            <tr><td>Kilo (Ko)</td><td>2Â¹â° = 1 024</td></tr>
            <tr><td>MÃ©ga (Mo)</td><td>2Â²â° â‰ˆ 1 million</td></tr>
            <tr><td>Giga (Go)</td><td>2Â³â° â‰ˆ 1 milliard</td></tr>
            <tr><td>TÃ©ra (To)</td><td>2â´â°</td></tr>
            <tr><td>PÃ©ta (Po)</td><td>2âµâ°</td></tr>
            <tr><td>Exa (Eo)</td><td>2â¶â°</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="warn-box">
      <div class="box-label label-red">Attention â€” confusion courante</div>
      Un disque dur de <strong>1 To</strong> (constructeur) â‰ˆ <strong>931 Gio</strong> (OS) car les constructeurs utilisent les puissances de 10 (1 000Â³) et les OS les puissances de 2 (1 024Â³).
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="quiz-wrap" id="quiz">
  <h3>ğŸ§  Quiz de rÃ©vision â€” Chapitre 1</h3>

  <div class="quiz-card" id="q1">
    <p class="quiz-q"><strong>Q1.</strong> Combien vaut <code>1011â‚‚</code> en dÃ©cimal ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” 1001â‚‚ = 9â‚â‚€. Il faut recompter les puissances.')">9</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q1','Correct ! 1Ã—2Â³ + 0Ã—2Â² + 1Ã—2Â¹ + 1Ã—2â° = 8 + 0 + 2 + 1 = 11.')">11</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” 1100â‚‚ = 12â‚â‚€. Attention Ã  ne pas confondre les bits.')">12</button>
    </div>
    <p class="quiz-feedback" id="q1-fb"></p>
  </div>

  <div class="quiz-card" id="q2">
    <p class="quiz-q"><strong>Q2.</strong> Quelle est la valeur maximale reprÃ©sentable sur 8 bits (en entier non signÃ©) ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” 256 = 2â¸, mais la valeur max est 2â¸ âˆ’ 1 car on commence Ã  0.')">256</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q2','Exact ! Max(2,8) = 2â¸ âˆ’ 1 = 255. Le pattern 11111111â‚‚ = FFâ‚â‚†.')">255</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” 127 serait la valeur max pour un entier signÃ© sur 8 bits (complÃ©ment Ã  2).')">127</button>
    </div>
    <p class="quiz-feedback" id="q2-fb"></p>
  </div>

  <div class="quiz-card" id="q3">
    <p class="quiz-q"><strong>Q3.</strong> Pour convertir <code>31â‚â‚€</code> en base 2 par divisions successives, quel est le premier reste obtenu ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'correct','q3','Oui ! 31 Ã· 2 = 15, reste 1. Ce reste est le bit de poids faible (bâ‚€).')">1 (31 Ã· 2 = 15 reste 1)</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” 31 est impair donc le reste de 31Ã·2 est 1, pas 0.')">0 (31 Ã· 2 = 15 reste 0)</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” 31 Ã· 2 donne un quotient de 15, pas 16.')">1 (31 Ã· 2 = 16 reste 1)</button>
    </div>
    <p class="quiz-feedback" id="q3-fb"></p>
  </div>

  <div class="quiz-card" id="q4">
    <p class="quiz-q"><strong>Q4.</strong> <code>6Aâ‚â‚†</code> converti en binaire donne :</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” 6â‚â‚† = 0110â‚‚ et Aâ‚â‚† = 1010â‚‚, on les concatÃ¨ne directement.')">01101100â‚‚</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q4','Exact ! Par Ã©clatement : 6 = 0110, A = 1010, donc 6Aâ‚â‚† = 01101010â‚‚.')">01101010â‚‚</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” Aâ‚â‚† = 10â‚â‚€ = 1010â‚‚, pas 1001â‚‚.')">01101001â‚‚</button>
    </div>
    <p class="quiz-feedback" id="q4-fb"></p>
  </div>

  <div class="quiz-card" id="q5">
    <p class="quiz-q"><strong>Q5.</strong> Quel est l'avantage des bases 8 et 16 par rapport au binaire ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” les valeurs sont identiques, seule la reprÃ©sentation change.')">Elles permettent de reprÃ©senter des nombres plus grands</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q5','Exact ! 8 bits en binaire = 2 chiffres hex ou ~3 chiffres octal. La notation est beaucoup plus compacte et lisible.')">Elles simplifient la notation des nombres binaires (plus compact)</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” les ordinateurs calculent toujours en binaire, quelle que soit la notation.')">Les ordinateurs calculent plus vite en base 16</button>
    </div>
    <p class="quiz-feedback" id="q5-fb"></p>
  </div>

  <div class="quiz-card" id="q6">
    <p class="quiz-q"><strong>Q6.</strong> On convertit <code>0,5â‚â‚€</code> en base 2 par multiplications successives. Quelle est la premiÃ¨re Ã©tape ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'correct','q6','Exact ! 0,5 Ã— 2 = 1,0 â†’ partie entiÃ¨re = 1. La fraction vaut 0, donc on s\\'arrÃªte : 0,5â‚â‚€ = 0,1â‚‚.')">0,5 Ã— 2 = 1,0 â†’ premier chiffre = 1</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q6','Non â€” on multiplie la fraction par la base (2), pas on la divise.')">0,5 Ã· 2 = 0,25 â†’ premier chiffre = 0</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q6','Non â€” 0,5 Ã— 2 = 1,0, la partie entiÃ¨re est 1 (pas 0).')">0,5 Ã— 2 = 1,0 â†’ premier chiffre = 0</button>
    </div>
    <p class="quiz-feedback" id="q6-fb"></p>
  </div>

  <div class="quiz-card" id="q7">
    <p class="quiz-q"><strong>Q7.</strong> Pour convertir directement <code>A3â‚â‚†</code> en octal (base 8), quelle est la meilleure stratÃ©gie ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q7','Non â€” l\\'expansion directe en arithmÃ©tique octale est correcte en thÃ©orie, mais inutilement complexe ici.')">Faire l'expansion en arithmÃ©tique de la base 8 directement</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q7','Exact ! A3â‚â‚† â†’ Ã©clater en binaire (1010 0011â‚‚) â†’ regrouper par 3 bits (010 100 011â‚‚) â†’ 243â‚ˆ. Rapide et sans erreur !')">Ã‰clater en binaire (4 bits/chiffre hex), puis regrouper par 3 bits (octal)</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q7','Cela fonctionne, mais c\\'est inutilement long quand on peut passer directement par le binaire comme base intermÃ©diaire.')">Passer par la base 10 : A3â‚â‚† = 163â‚â‚€, puis 163â‚â‚€ â†’ base 8</button>
    </div>
    <p class="quiz-feedback" id="q7-fb"></p>
  </div>

</div>`,
    script: `// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggle(header) {
  header.closest('.section').classList.toggle('collapsed');
}
function ans(btn, result, qid, feedback) {
  const card = document.getElementById(qid);
  card.querySelectorAll('.quiz-opt').forEach(o => { o.disabled = true; o.style.opacity = '0.5'; });
  btn.style.opacity = '1';
  btn.classList.add(result);
  document.getElementById(qid + '-fb').textContent = (result === 'correct' ? 'âœ… ' : 'âŒ ') + feedback;
}
document.querySelectorAll('.toc-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    e.preventDefault();
    const t = document.querySelector(btn.getAttribute('href'));
    if (t) { t.scrollIntoView({ behavior: 'smooth', block: 'start' }); if (t.classList.contains('collapsed')) t.classList.remove('collapsed'); }
  });
});

// â”€â”€ BASE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildBaseTable() {
  const tbody = document.getElementById('base-tbody');
  for (let i = 0; i <= 20; i++) {
    const tr = document.createElement('tr');
    tr.innerHTML = \`
      <td class="dec">\${i}</td>
      <td class="bin">\${i.toString(2)}</td>
      <td class="oct">\${i.toString(8)}</td>
      <td class="hex">\${i.toString(16).toUpperCase()}</td>\`;
    tr.addEventListener('mouseenter', () => tr.classList.add('highlight-row'));
    tr.addEventListener('mouseleave', () => tr.classList.remove('highlight-row'));
    tbody.appendChild(tr);
  }
}
buildBaseTable();

// â”€â”€ BASE CONVERTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function convertFromDec() {
  const n = parseInt(document.getElementById('conv-dec').value);
  if (isNaN(n) || n < 0) return;
  const el = document.getElementById('conv-result');
  el.innerHTML = \`
    <div class="step"><span class="step-label">DÃ©cimal :</span><span class="step-val">\${n}</span></div>
    <div class="step"><span class="step-label">Binaire (base 2) :</span><span class="step-val" style="color:var(--accent3)">\${n.toString(2)}<sub style="font-size:0.65rem;color:var(--muted)">2</sub></span></div>
    <div class="step"><span class="step-label">Octal (base 8) :</span><span class="step-val" style="color:var(--accent4)">\${n.toString(8)}<sub style="font-size:0.65rem;color:var(--muted)">8</sub></span></div>
    <div class="step"><span class="step-label">HexadÃ©cimal (base 16) :</span><span class="step-val" style="color:var(--accent2)">\${n.toString(16).toUpperCase()}<sub style="font-size:0.65rem;color:var(--muted)">16</sub></span></div>
  \`;
}
convertFromDec();

// â”€â”€ MAX VALUE CALCULATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcMax() {
  const B = parseInt(document.getElementById('max-b').value);
  const n = parseInt(document.getElementById('max-n').value);
  if (isNaN(B) || isNaN(n) || B < 2 || n < 1) return;
  const max = Math.pow(B, n) - 1;
  const el = document.getElementById('max-result');
  el.style.display = 'block';
  el.innerHTML = \`
    <div class="step"><span class="step-label">Base B :</span><span class="step-val">\${B}</span></div>
    <div class="step"><span class="step-label">Nombre de symboles n :</span><span class="step-val">\${n}</span></div>
    <div class="step"><span class="step-label">Formule :</span><span class="step-val">B<sup>n</sup> âˆ’ 1 = \${B}<sup>\${n}</sup> âˆ’ 1</span></div>
    <div class="step"><span class="step-label">Valeur maximale :</span><span class="step-val"><em>\${max.toLocaleString('fr-FR')}</em></span></div>
    \${B === 2 ? \`<div class="step"><span class="step-label">En hex :</span><span class="step-val" style="color:var(--accent2)">\${max.toString(16).toUpperCase()}<sub style="font-size:0.65rem;color:var(--muted)">16</sub></span></div>\` : ''}
  \`;
}

// â”€â”€ DIVISION CONVERTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function divConvert() {
  let n = parseInt(document.getElementById('div-num').value);
  const B = parseInt(document.getElementById('div-base').value);
  if (isNaN(n) || isNaN(B) || B < 2 || n < 0) return;

  const steps = [];
  let temp = n;
  if (temp === 0) steps.push({ quot: 0, rem: 0 });
  while (temp > 0) {
    steps.push({ quot: Math.floor(temp / B), rem: temp % B });
    temp = Math.floor(temp / B);
  }

  const digits = steps.map(s => s.rem.toString(B === 16 ? 16 : 10).toUpperCase()).reverse().join('');

  let html = \`<ul class="steps-list">\`;
  steps.forEach((s, i) => {
    const isLast = i === steps.length - 1;
    html += \`<li class="\${isLast ? 'active' : ''}">
      \${steps[i] ? (n - (steps.slice(0,i).reduce((acc,x)=> acc - x.rem * Math.pow(B, i), n))) : n}
      &nbsp;&rarr;&nbsp; \${steps[i].quot} Ã— \${B} + <span class="rem">\${steps[i].rem}</span>
    </li>\`;
  });
  html += \`</ul>\`;
  html += \`<div class="viz-result" style="margin-top:0.5rem;">
    <div class="step"><span class="step-label">RÃ©sultat (restes lus de bas en haut) :</span>
    <span class="step-val"><em>\${digits}</em><sub style="font-size:0.65rem;color:var(--muted)">\${B}</sub></span></div>
    <div class="step"><span class="step-label">VÃ©rification :</span><span class="step-val">\${digits} en base \${B} = \${parseInt(digits, B === 16 ? 16 : B).toString(10)}â‚â‚€</span></div>
  </div>\`;

  document.getElementById('div-result').innerHTML = html;
}

// â”€â”€ FRACTION CONVERTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fracConvert() {
  let val = parseFloat(document.getElementById('frac-num').value);
  const B = parseInt(document.getElementById('frac-base').value);
  const maxDigits = parseInt(document.getElementById('frac-digits').value) || 6;
  const el = document.getElementById('frac-result');

  if (isNaN(val) || val < 0 || val >= 1 || isNaN(B) || B < 2) {
    el.innerHTML = '<div class="viz-result" style="color:var(--accent2)">âš  Entrez une fraction entre 0 et 1 (ex: 0.314) et une base â‰¥ 2.</div>';
    return;
  }

  const digits = B <= 10
    ? '0123456789'.slice(0, B)
    : ('0123456789ABCDEF').slice(0, B);

  let steps = [];
  let frac = val;
  let result = '';
  let exact = false;

  for (let i = 0; i < maxDigits; i++) {
    const product = frac * B;
    const intPart = Math.floor(product);
    frac = product - intPart;
    const sym = intPart.toString(B).toUpperCase();
    steps.push({ product: product.toFixed(6), intPart: sym, newFrac: frac.toFixed(6) });
    result += sym;
    if (frac < 1e-10) { exact = true; break; }
  }

  let html = '<div class="viz-result">';
  html += \`<div class="step" style="margin-bottom:0.5rem;"><span class="step-label">Ã‰tapes :</span></div>\`;
  steps.forEach((s, i) => {
    html += \`<div class="step">
      <span class="step-label" style="min-width:10px; color:var(--muted);">Ã—\${B} â†’</span>
      <span class="step-val">\${s.product} &nbsp;â†’&nbsp; entier = <em>\${s.intPart}</em> &nbsp;Â·&nbsp; frac = \${s.newFrac}</span>
    </div>\`;
  });
  html += \`<div class="step" style="margin-top:0.6rem; border-top:1px solid var(--border); padding-top:0.5rem;">
    <span class="step-label">RÃ©sultat :</span>
    <span class="step-val">0,<em>\${result}</em><sub style="font-size:0.65rem;color:var(--muted)">\${B}</sub>
    \${exact ? ' &nbsp;<span style="color:var(--accent3); font-size:0.75rem;">(exact)</span>' : ' &nbsp;<span style="color:var(--accent4); font-size:0.75rem;">(tronquÃ© Ã  ' + maxDigits + ' chiffres)</span>'}
    </span>
  </div>\`;
  html += '</div>';
  el.innerHTML = html;
}

// â”€â”€ B1 â†’ B2 CONVERTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function b1b2Convert() {
  const numStr = document.getElementById('b1b2-num').value.trim().toUpperCase();
  const B1 = parseInt(document.getElementById('b1b2-b1').value);
  const B2 = parseInt(document.getElementById('b1b2-b2').value);
  const el = document.getElementById('b1b2-result');

  if (isNaN(B1) || isNaN(B2) || B1 < 2 || B2 < 2) {
    el.innerHTML = '<div class="viz-result" style="color:var(--accent2)">âš  Bases invalides.</div>';
    return;
  }

  // Validate digits are valid for B1
  const validChars = '0123456789ABCDEF'.slice(0, B1);
  for (const c of numStr) {
    if (!validChars.includes(c)) {
      el.innerHTML = \`<div class="viz-result" style="color:var(--accent2)">âš  Le symbole '\${c}' est invalide en base \${B1}.</div>\`;
      return;
    }
  }

  // Step 1: B1 â†’ decimal
  const decVal = parseInt(numStr, B1);
  if (isNaN(decVal)) {
    el.innerHTML = '<div class="viz-result" style="color:var(--accent2)">âš  Nombre invalide.</div>';
    return;
  }

  // Step 2: decimal â†’ B2 via successive divisions
  let temp = decVal;
  const divSteps = [];
  if (temp === 0) divSteps.push({ quot: 0, rem: 0, remSym: '0' });
  while (temp > 0) {
    const rem = temp % B2;
    divSteps.push({ quot: Math.floor(temp / B2), rem, remSym: rem.toString(B2).toUpperCase() });
    temp = Math.floor(temp / B2);
  }
  const resultB2 = divSteps.map(s => s.remSym).reverse().join('') || '0';

  // Show each digit of original and its decimal value
  const digitExpansion = numStr.split('').map((c, i) => {
    const pow = numStr.length - 1 - i;
    const val = parseInt(c, B1);
    return \`\${c}Ã—\${B1}<sup>\${pow}</sup>\`;
  }).join(' + ');

  let html = '<div class="viz-result">';
  html += \`<div class="step"><span class="step-label">Ã‰tape 1 â€” Expansion (\${numStr}<sub>\${B1}</sub> â†’ base 10) :</span></div>\`;
  html += \`<div class="step" style="padding-left:1rem;"><span class="step-val" style="font-size:0.8rem;">\${digitExpansion} = <em>\${decVal}</em>â‚â‚€</span></div>\`;
  html += \`<div class="step" style="margin-top:0.5rem;"><span class="step-label">Ã‰tape 2 â€” Divisions successives (\${decVal}â‚â‚€ â†’ base \${B2}) :</span></div>\`;
  divSteps.forEach(s => {
    html += \`<div class="step" style="padding-left:1rem;"><span class="step-val" style="font-size:0.8rem;">Ã·\${B2} â†’ quotient \${s.quot}, reste <em>\${s.remSym}</em></span></div>\`;
  });
  html += \`<div class="step" style="margin-top:0.6rem; border-top:1px solid var(--border); padding-top:0.5rem;">
    <span class="step-label">RÃ©sultat final :</span>
    <span class="step-val">\${numStr}<sub style="font-size:0.65rem;color:var(--muted)">\${B1}</sub> = <em>\${resultB2}</em><sub style="font-size:0.65rem;color:var(--muted)">\${B2}</sub></span>
  </div>\`;
  html += '</div>';
  el.innerHTML = html;
}
function groupConvert() {
  const binStr = document.getElementById('grp-bin').value.replace(/\\s/g, '');
  const target = parseInt(document.getElementById('grp-target').value);
  const groupSize = target === 16 ? 4 : 3;

  if (!/^[01,]+\$/.test(binStr)) {
    document.getElementById('grp-result').innerHTML = '<div class="viz-result" style="color:var(--accent2)">âš  EntrÃ©e invalide â€” utilisez uniquement 0 et 1.</div>';
    return;
  }

  // Split on comma if there's a fractional part
  const parts = binStr.split(',');
  let intPart = parts[0] || '';
  let fracPart = parts[1] || '';

  // Pad integer part on the left
  while (intPart.length % groupSize !== 0) intPart = '0' + intPart;
  // Pad fractional part on the right
  while (fracPart.length % groupSize !== 0) fracPart = fracPart + '0';

  function toGroups(s, size) {
    const groups = [];
    for (let i = 0; i < s.length; i += size) groups.push(s.slice(i, i + size));
    return groups;
  }

  const intGroups = toGroups(intPart, groupSize);
  const fracGroups = fracPart ? toGroups(fracPart, groupSize) : [];

  const allGroups = [...intGroups, ...fracGroups];
  const converted = allGroups.map(g => parseInt(g, 2).toString(target).toUpperCase());

  const intHex = intGroups.map(g => parseInt(g, 2).toString(target).toUpperCase()).join('');
  const fracHex = fracGroups.map(g => parseInt(g, 2).toString(target).toUpperCase()).join('');
  const result = intHex + (fracHex ? ',' + fracHex : '');

  // Render grouped bits
  const colorsInt = ['var(--accent)', 'var(--accent4)', 'var(--accent3)', 'var(--purple)', 'var(--accent2)'];
  let groupedHtml = intGroups.map((g, i) => \`<span style="color:\${colorsInt[i % colorsInt.length]}; background:\${colorsInt[i % colorsInt.length]}18; padding:2px 4px; border-radius:3px; font-family:\\'JetBrains Mono\\',monospace;">\${g}</span>\`).join(' ');
  if (fracGroups.length) groupedHtml += ' , ' + fracGroups.map((g, i) => \`<span style="color:\${colorsInt[(intGroups.length + i) % colorsInt.length]}; background:\${colorsInt[(intGroups.length + i) % colorsInt.length]}18; padding:2px 4px; border-radius:3px; font-family:\\'JetBrains Mono\\',monospace;">\${g}</span>\`).join(' ');

  let convHtml = allGroups.map((g, i) => \`<span style="color:\${colorsInt[i % colorsInt.length]}; background:\${colorsInt[i % colorsInt.length]}18; padding:2px 4px; border-radius:3px; font-family:\\'JetBrains Mono\\',monospace;">\${parseInt(g, 2).toString(target).toUpperCase()}</span>\`).join(' ');

  document.getElementById('grp-result').innerHTML = \`
    <div class="viz-result">
      <div class="step"><span class="step-label">Groupes de \${groupSize} bits :</span><span class="step-val">\${groupedHtml}</span></div>
      <div class="step"><span class="step-label">Valeurs en base \${target} :</span><span class="step-val">\${convHtml}</span></div>
      <div class="step"><span class="step-label">RÃ©sultat :</span><span class="step-val"><em>\${result}</em><sub style="font-size:0.65rem;color:var(--muted)">\${target}</sub></span></div>
    </div>\`;
}`
  },
  {
    title: `Chapitre 2`,
    subtitle: `Architecture des ordinateurs`,
    desc: `Von Neumann, mÃ©moire, processeur`,
    accent: `#e05c7a`,
    css: `
  :root {
    --bg: #0d0f14;
    --surface: #141720;
    --surface2: #1c2030;
    --border: #252a3a;
    --accent: #5b8dee;
    --accent2: #e05c7a;
    --accent3: #36c9a0;
    --accent4: #f5a623;
    --purple: #c97af5;
    --text: #e0e4f0;
    --muted: #7a8099;
    --code-bg: #0a0c11;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Lato', sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; }

  header {
    background: linear-gradient(135deg, #0d1220 0%, #111827 100%);
    border-bottom: 1px solid var(--border);
    padding: 3rem 2rem 2rem;
    position: relative; overflow: hidden;
  }
  header::before {
    content: ''; position: absolute; top: -60px; right: -60px;
    width: 350px; height: 350px;
    background: radial-gradient(circle, rgba(91,141,238,0.1) 0%, transparent 70%);
    pointer-events: none;
  }
  .chip {
    display: inline-block;
    background: rgba(91,141,238,0.12);
    border: 1px solid rgba(91,141,238,0.3);
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem; padding: 3px 10px; border-radius: 4px;
    letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 1rem;
  }
  h1 { font-family: 'Syne', sans-serif; font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 800; line-height: 1.15; margin-bottom: 0.5rem; }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 1rem; font-weight: 300; }

  .toc-bar {
    background: var(--surface); border-bottom: 1px solid var(--border);
    padding: 0.75rem 2rem; display: flex; gap: 0.5rem; flex-wrap: wrap;
    position: sticky; top: 0; z-index: 100;
  }
  .toc-btn {
    font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
    padding: 4px 12px; border-radius: 4px; border: 1px solid var(--border);
    background: transparent; color: var(--muted); cursor: pointer;
    transition: all 0.2s; text-decoration: none;
  }
  .toc-btn:hover { background: var(--surface2); color: var(--text); border-color: var(--accent); }

  main { max-width: 980px; margin: 0 auto; padding: 2.5rem 1.5rem 5rem; }

  .section {
    margin-bottom: 2rem; border: 1px solid var(--border); border-radius: 12px;
    overflow: hidden; background: var(--surface); transition: border-color 0.3s;
  }
  .section:hover { border-color: rgba(91,141,238,0.25); }
  .section-header {
    padding: 1.1rem 1.5rem; display: flex; align-items: center; gap: 0.9rem;
    cursor: pointer; user-select: none; background: var(--surface2); transition: background 0.2s;
  }
  .section-header:hover { background: #1f2538; }
  .section-num {
    font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--accent);
    background: rgba(91,141,238,0.1); border: 1px solid rgba(91,141,238,0.25);
    border-radius: 4px; padding: 2px 7px;
  }
  .section-title { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700; flex: 1; }
  .chevron { color: var(--muted); font-size: 0.75rem; transition: transform 0.25s; }
  .section.collapsed .chevron { transform: rotate(-90deg); }
  .section-body { padding: 1.5rem; }
  .section.collapsed .section-body { display: none; }

  p { font-size: 0.94rem; margin-bottom: 0.75rem; }

  .highlight-box { border-left: 3px solid var(--accent); background: rgba(91,141,238,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .warn-box { border-left: 3px solid var(--accent2); background: rgba(224,92,122,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .tip-box { border-left: 3px solid var(--accent3); background: rgba(54,201,160,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .purple-box { border-left: 3px solid var(--purple); background: rgba(201,122,245,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .box-label { font-family: 'JetBrains Mono', monospace; font-size: 0.63rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.35rem; font-weight: 700; }
  .label-blue { color: var(--accent); } .label-red { color: var(--accent2); } .label-green { color: var(--accent3); } .label-orange { color: var(--accent4); } .label-purple { color: var(--purple); }

  pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px; padding: 1rem 1.2rem; overflow-x: auto; margin: 1rem 0; }
  code { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; line-height: 1.85; color: #c9d0e8; }
  .cmt { color: #636e8c; font-style: italic; }
  .kw { color: var(--accent); } .reg { color: var(--accent3); } .lbl { color: var(--accent2); }
  .num { color: var(--accent4); }

  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; margin: 1rem 0; }
  th { background: var(--surface2); color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.07em; padding: 0.6rem 0.9rem; border: 1px solid var(--border); text-align: left; }
  td { padding: 0.55rem 0.9rem; border: 1px solid var(--border); vertical-align: middle; font-size: 0.85rem; }
  tr:hover td { background: rgba(255,255,255,0.02); }
  .mono { font-family: 'JetBrains Mono', monospace; color: var(--accent3); font-size: 0.82rem; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0; }
  @media (max-width: 600px) { .two-col { grid-template-columns: 1fr; } }
  .mini-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 0.9rem 1rem; }
  .mini-card .mc-title { font-family:'JetBrains Mono',monospace; color: var(--accent4); font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem; }

  .formula {
    background: var(--code-bg); border: 1px solid rgba(91,141,238,0.3);
    border-radius: 8px; padding: 0.9rem 1.2rem; margin: 1rem 0;
    font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
    color: var(--text); text-align: center; line-height: 2;
  }
  .formula .fa { color: var(--accent2); }
  .formula .fb { color: var(--accent3); }
  .formula .fc { color: var(--accent4); }
  .formula .fd { color: var(--purple); }

  /* VON NEUMANN DIAGRAM */
  .vn-diagram {
    display: flex; flex-direction: column; align-items: center;
    gap: 0.6rem; margin: 1.5rem 0; font-family: 'JetBrains Mono', monospace;
  }
  .vn-cpu {
    background: rgba(91,141,238,0.1); border: 2px solid var(--accent);
    border-radius: 10px; padding: 1rem 1.5rem; text-align: center; width: 100%;
    max-width: 420px;
  }
  .vn-cpu-title { color: var(--accent); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.5rem; }
  .vn-cpu-inner { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }
  .vn-unit {
    background: rgba(91,141,238,0.15); border: 1px solid rgba(91,141,238,0.4);
    border-radius: 6px; padding: 0.4rem 0.8rem; font-size: 0.78rem; color: var(--text);
    cursor: pointer; transition: all 0.2s;
  }
  .vn-unit:hover { background: rgba(91,141,238,0.3); border-color: var(--accent); }
  .vn-bus {
    width: 4px; height: 30px; background: var(--accent4);
    position: relative; margin: 0 auto;
  }
  .vn-bus-label { font-size: 0.65rem; color: var(--accent4); text-align: center; margin: -0.2rem 0 0.2rem; }
  .vn-row { display: flex; gap: 1rem; justify-content: center; width: 100%; max-width: 600px; }
  .vn-box {
    flex: 1; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; padding: 0.7rem 1rem; text-align: center;
    font-size: 0.8rem; color: var(--muted); cursor: pointer; transition: all 0.2s;
    max-width: 180px;
  }
  .vn-box:hover { border-color: var(--accent4); color: var(--text); background: rgba(245,166,35,0.08); }
  .vn-box .vn-box-title { color: var(--accent4); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.07em; margin-bottom: 0.3rem; }
  .vn-info {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px;
    padding: 0.8rem 1rem; font-size: 0.84rem; min-height: 60px; color: var(--muted);
    transition: all 0.3s; margin-top: 0.5rem; width: 100%; max-width: 600px;
    font-family: 'Lato', sans-serif; line-height: 1.6;
  }

  /* PIPELINE STAGE DETAIL CARDS */
  .stage-cards { display: flex; flex-direction: column; gap: 0.55rem; margin: 1.1rem 0; }
  .stage-card {
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .stage-card-header {
    display: flex; align-items: center; gap: 0.9rem;
    padding: 0.7rem 1rem;
    cursor: pointer;
    user-select: none;
    transition: background 0.15s;
  }
  .stage-card-header:hover { background: rgba(255,255,255,0.03); }
  .stage-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem; font-weight: 700;
    padding: 3px 9px; border-radius: 5px;
    border: 1px solid; flex-shrink: 0;
    min-width: 44px; text-align: center;
  }
  .stage-card-title {
    font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700;
    flex: 1;
  }
  .stage-card-chevron {
    font-size: 0.7rem; color: var(--muted);
    transition: transform 0.25s;
  }
  .stage-card.open .stage-card-chevron { transform: rotate(180deg); }
  .stage-card-body {
    display: none;
    padding: 0 1rem 1rem 1rem;
    border-top: 1px solid var(--border);
  }
  .stage-card.open .stage-card-body { display: block; }
  .stage-detail-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem;
    margin-top: 0.8rem;
  }
  @media (max-width: 600px) { .stage-detail-grid { grid-template-columns: 1fr; } }
  .stage-detail-item {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border); border-radius: 7px;
    padding: 0.6rem 0.8rem;
  }
  .stage-detail-item .di-label {
    font-family: 'JetBrains Mono', monospace; font-size: 0.6rem;
    text-transform: uppercase; letter-spacing: 0.08em;
    color: var(--muted); margin-bottom: 4px;
  }
  .stage-detail-item .di-val {
    font-size: 0.8rem; line-height: 1.5; color: var(--text);
  }
  .stage-mem-note {
    display: inline-flex; align-items: center; gap: 0.4rem;
    font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;
    background: rgba(224,92,122,0.12); border: 1px solid rgba(224,92,122,0.35);
    color: var(--accent2); border-radius: 5px; padding: 3px 8px; margin-top: 0.6rem;
  }
  .stage-always-mem {
    display: inline-flex; align-items: center; gap: 0.4rem;
    font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;
    background: rgba(91,141,238,0.12); border: 1px solid rgba(91,141,238,0.35);
    color: var(--accent); border-radius: 5px; padding: 3px 8px; margin-top: 0.6rem;
  }
  .stage-card.ei-card  { border-color: rgba(91,141,238,0.3); }
  .stage-card.di-card  { border-color: rgba(54,201,160,0.3); }
  .stage-card.ex-card  { border-color: rgba(245,166,35,0.3); }
  .stage-card.mem-card { border-color: rgba(224,92,122,0.3); }
  .stage-card.er-card  { border-color: rgba(201,122,245,0.3); }
  .stage-card.open.ei-card  { border-color: var(--accent); }
  .stage-card.open.di-card  { border-color: var(--accent3); }
  .stage-card.open.ex-card  { border-color: var(--accent4); }
  .stage-card.open.mem-card { border-color: var(--accent2); }
  .stage-card.open.er-card  { border-color: var(--purple); }

  /* PIPELINE */
  .pipeline-wrap { overflow-x: auto; margin: 1rem 0; }
  .pipeline-grid {
    display: grid; gap: 3px;
    font-family: 'JetBrains Mono', monospace; font-size: 0.72rem;
    min-width: 600px;
  }
  .pl-cell {
    padding: 6px 4px; border-radius: 4px; text-align: center;
    border: 1px solid var(--border); background: var(--surface2); color: var(--muted);
    transition: all 0.2s;
  }
  .pl-cell.ei  { background: rgba(91,141,238,0.2);  border-color: var(--accent);  color: var(--accent); }
  .pl-cell.di  { background: rgba(54,201,160,0.2);  border-color: var(--accent3); color: var(--accent3); }
  .pl-cell.ex  { background: rgba(245,166,35,0.2);  border-color: var(--accent4); color: var(--accent4); }
  .pl-cell.mem { background: rgba(224,92,122,0.2);  border-color: var(--accent2); color: var(--accent2); }
  .pl-cell.er  { background: rgba(201,122,245,0.2); border-color: var(--purple);  color: var(--purple); }
  .pl-cell.lbl { background: transparent; border-color: transparent; color: var(--muted); text-align: right; padding-right: 8px; font-weight: 700; }
  .pl-cell.hdr { background: transparent; border-color: transparent; color: var(--muted); font-size: 0.6rem; }
  .pl-cell.empty { background: transparent; border-color: transparent; }

  /* REGISTER TABLE */
  .reg-badge {
    display: inline-block; font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem; padding: 2px 8px; border-radius: 4px;
    border: 1px solid; margin: 2px;
  }
  .reg-param  { color: var(--accent3);  border-color: var(--accent3);  background: rgba(54,201,160,0.1); }
  .reg-temp   { color: var(--accent4);  border-color: var(--accent4);  background: rgba(245,166,35,0.1); }
  .reg-local  { color: var(--purple);   border-color: var(--purple);   background: rgba(201,122,245,0.1); }
  .reg-special{ color: var(--accent2);  border-color: var(--accent2);  background: rgba(224,92,122,0.1); }
  .reg-sys    { color: var(--accent);   border-color: var(--accent);   background: rgba(91,141,238,0.1); }

  /* VIZ TOOL */
  .viz-tool {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; padding: 1.4rem; margin: 1rem 0;
  }
  .viz-tool h4 { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 700; color: var(--accent4); margin-bottom: 1.1rem; }
  .viz-input-row { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .viz-input {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px;
    color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
    padding: 0.45rem 0.65rem; width: 140px; outline: none; transition: border-color 0.2s;
  }
  .viz-input:focus { border-color: var(--accent); }
  .viz-btn {
    background: rgba(91,141,238,0.15); border: 1px solid rgba(91,141,238,0.35);
    color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
    padding: 0.45rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
  }
  .viz-btn:hover { background: rgba(91,141,238,0.28); }

  /* ENDIAN VISUALIZER */
  .endian-strip { display: flex; align-items: stretch; gap: 0; overflow-x: auto; }
  .endian-cell {
    min-width: 60px; padding: 0.5rem 0.3rem; border: 1px solid var(--border);
    background: var(--surface2); font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem; text-align: center; flex-shrink: 0;
  }
  .endian-cell:first-child { border-radius: 6px 0 0 6px; }
  .endian-cell:last-child  { border-radius: 0 6px 6px 0; }
  .endian-cell .e-addr { font-size: 0.6rem; color: var(--muted); margin-bottom: 3px; }
  .endian-cell .e-val  { font-size: 0.88rem; }
  .endian-cell .e-sig  { font-size: 0.58rem; color: var(--muted); margin-top: 3px; }
  .endian-cell.msb { background: rgba(91,141,238,0.18); border-color: var(--accent); }
  .endian-cell.msb .e-val { color: var(--accent); }
  .endian-cell.lsb { background: rgba(245,166,35,0.18); border-color: var(--accent4); }
  .endian-cell.lsb .e-val { color: var(--accent4); }

  /* QUIZ */
  .quiz-wrap { margin-top: 2.5rem; }
  .quiz-wrap h3 { font-family: 'Syne', sans-serif; font-size: 1rem; margin-bottom: 1rem; color: var(--accent); }
  .quiz-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1.2rem 1.4rem; margin-bottom: 1rem; }
  .quiz-q { font-size: 0.92rem; margin-bottom: 0.75rem; }
  .quiz-opts { display: flex; flex-direction: column; gap: 0.4rem; }
  .quiz-opt {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 6px;
    padding: 0.55rem 0.85rem; cursor: pointer; font-size: 0.88rem; transition: all 0.15s;
    font-family: 'Lato', sans-serif; color: var(--text); text-align: left;
  }
  .quiz-opt:hover { border-color: var(--accent); }
  .quiz-opt:disabled { cursor: default; }
  .quiz-opt.correct { border-color: var(--accent3); background: rgba(54,201,160,0.1); color: var(--accent3); }
  .quiz-opt.wrong { border-color: var(--accent2); background: rgba(224,92,122,0.1); color: var(--accent2); }
  .quiz-feedback { font-size: 0.83rem; margin-top: 0.6rem; color: var(--muted); font-style: italic; }

  .step-indicator {
    display: flex; gap: 0.5rem; flex-wrap: wrap; margin: 1rem 0;
  }
  .step-badge {
    font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
    padding: 4px 12px; border-radius: 20px; border: 1px solid;
    cursor: pointer; transition: all 0.2s;
  }
  .step-badge:hover { opacity: 0.85; }
  .active-step { box-shadow: 0 0 0 2px var(--bg), 0 0 0 4px currentColor; }

  select.viz-input { width: auto; cursor: pointer; }
`,
    body: `<header>
  <div class="chip">INF â€” Assembleur</div>
  <h1>Chapitre 2 â€” <span>Architecture des ordinateurs</span></h1>
  <p class="subtitle">Von Neumann, mÃ©moire, processeur, pipeline, ARM Â· Notes de cours interactives</p>
</header>

<nav class="toc-bar">
  <a class="toc-btn" href="#s1">01 Architecture</a>
  <a class="toc-btn" href="#s2">02 Von Neumann</a>
  <a class="toc-btn" href="#s3">03 RISC vs CISC</a>
  <a class="toc-btn" href="#s4">04 MÃ©moire centrale</a>
  <a class="toc-btn" href="#s5">05 Endianness</a>
  <a class="toc-btn" href="#s6">06 Processeur</a>
  <a class="toc-btn" href="#s7">07 Nb d'opÃ©randes</a>
  <a class="toc-btn" href="#s8">08 Pipeline</a>
  <a class="toc-btn" href="#s9">09 Architecture ARM</a>
  <a class="toc-btn" href="#s10">10 Registres ARM</a>
  <a class="toc-btn" href="#quiz">ğŸ§  Quiz</a>
</nav>

<main>

<!-- S1 -->
<div class="section" id="s1">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">01</span>
    <span class="section-title">Architecture â€” externe vs interne</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Le terme Â« architecture Â» dÃ©signe deux niveaux distincts d'une machine. Un mÃªme jeu d'instructions (architecture externe) peut Ãªtre implÃ©mentÃ© de multiples faÃ§ons diffÃ©rentes (architectures internes).</p>
    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Architecture externe (spÃ©cification)</div>
        <div style="font-size:0.88rem; line-height:2;">
          âœ¦ Services fournis Ã  l'utilisateur<br>
          âœ¦ Types de donnÃ©es et reprÃ©sentation<br>
          âœ¦ Modes d'adressage<br>
          âœ¦ Instructions machine<br>
          âœ¦ MÃ©canismes d'entrÃ©e/sortie
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Architecture interne (organisation)</div>
        <div style="font-size:0.88rem; line-height:2;">
          âœ¦ Description physique des composants<br>
          âœ¦ Interconnexions (bus, cachesâ€¦)<br>
          âœ¦ Organisation interne du processeur<br>
          âœ¦ Gestion des conflits de ressources
        </div>
      </div>
    </div>
    <div class="highlight-box">
      <div class="box-label label-blue">Principe clÃ©</div>
      Il peut exister <strong>plusieurs implÃ©mentations</strong> d'une mÃªme architecture. Par exemple, diffÃ©rents modÃ¨les de puces ARM partagent la mÃªme spÃ©cification mais diffÃ¨rent par leur organisation interne.
    </div>
  </div>
</div>

<!-- S2 -->
<div class="section" id="s2">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">02</span>
    <span class="section-title">Architecture de von Neumann</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>ProposÃ©e dans les annÃ©es 1940, cette architecture est le fondement de presque tous les ordinateurs modernes. Cliquez sur un composant pour en savoir plus.</p>

    <!-- INTERACTIVE VON NEUMANN DIAGRAM -->
    <div class="vn-diagram">
      <div class="vn-cpu" onclick="showVnInfo('cpu')">
        <div class="vn-cpu-title">Processeur (CPU)</div>
        <div class="vn-cpu-inner">
          <div class="vn-unit" onclick="event.stopPropagation(); showVnInfo('uc')">UnitÃ© de contrÃ´le</div>
          <div class="vn-unit" onclick="event.stopPropagation(); showVnInfo('ual')">UAL</div>
          <div class="vn-unit" onclick="event.stopPropagation(); showVnInfo('reg')">Registres</div>
        </div>
      </div>
      <div class="vn-bus"></div>
      <div class="vn-bus-label">BUS (n lignes Ã©lectriques parallÃ¨les)</div>
      <div class="vn-bus"></div>
      <div class="vn-row">
        <div class="vn-box" onclick="showVnInfo('mem')">
          <div class="vn-box-title">MÃ©moire principale</div>
          Programme + DonnÃ©es
        </div>
        <div class="vn-box" onclick="showVnInfo('io1')">
          <div class="vn-box-title">EntrÃ©e / Sortie</div>
          PÃ©riphÃ©riques
        </div>
        <div class="vn-box" onclick="showVnInfo('io2')">
          <div class="vn-box-title">EntrÃ©e / Sortie</div>
          PÃ©riphÃ©riques
        </div>
      </div>
      <div class="vn-info" id="vn-info">
        â† Cliquez sur un composant du diagramme pour afficher sa description.
      </div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Cycle complet d'une instruction (von Neumann)</div>
      <ol style="padding-left: 1.2rem; line-height: 2; font-size: 0.88rem;">
        <li>Extraction de l'instruction Ã  l'adresse contenue dans le <strong>PC</strong> â†’ dÃ©pÃ´t dans le <strong>RI</strong></li>
        <li>DÃ©codage de l'instruction et accÃ¨s Ã  ses <strong>opÃ©randes</strong></li>
        <li>Mise Ã  jour du <strong>PC</strong> (PC â† PC + taille instruction)</li>
        <li>ExÃ©cution de l'instruction</li>
        <li>Stockage des <strong>rÃ©sultats</strong></li>
      </ol>
    </div>
  </div>
</div>

<!-- S3 -->
<div class="section" id="s3">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">03</span>
    <span class="section-title">RISC vs CISC</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Il existe deux grandes philosophies de conception de processeurs, aux compromis opposÃ©s :</p>
    <table>
      <thead>
        <tr><th>CaractÃ©ristique</th><th style="color:var(--accent3)">RISC</th><th style="color:var(--accent2)">CISC</th></tr>
      </thead>
      <tbody>
        <tr><td>Registres</td><td style="color:var(--accent3)">Grand nombre</td><td style="color:var(--accent2)">Petit nombre</td></tr>
        <tr><td>Instructions</td><td style="color:var(--accent3)">Petit nombre</td><td style="color:var(--accent2)">Grand nombre</td></tr>
        <tr><td>Modes d'adressage</td><td style="color:var(--accent3)">Peu de modes</td><td style="color:var(--accent2)">Beaucoup de modes</td></tr>
        <tr><td>Longueur des instructions</td><td style="color:var(--accent3)">Unique (fixe)</td><td style="color:var(--accent2)">Variable</td></tr>
        <tr><td>AccÃ¨s mÃ©moire</td><td style="color:var(--accent3)">LimitÃ© (load/store)</td><td style="color:var(--accent2)">Toutes les instructions</td></tr>
        <tr><td>Exemples</td><td style="color:var(--accent3)">ARM, SPARC</td><td style="color:var(--accent2)">Intel x86</td></tr>
      </tbody>
    </table>
    <div class="tip-box">
      <div class="box-label label-green">Tendance actuelle</div>
      L'ARM (RISC) domine les appareils mobiles et embarquÃ©s (tÃ©lÃ©phones, tablettes, Apple Silicon). L'Intel/AMD (CISC) reste prÃ©dominant sur les PC et serveurs, bien que les processeurs modernes exÃ©cutent en interne des micro-opÃ©rations de style RISC.
    </div>
  </div>
</div>

<!-- S4 -->
<div class="section" id="s4">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">04</span>
    <span class="section-title">MÃ©moire centrale</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>La mÃ©moire principale est un vecteur de cellules adressables. Chaque cellule contient des bits, et la plus petite unitÃ© adressable est habituellement l'<strong>octet</strong> (8 bits).</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">UnitÃ©s adressables</div>
        <div style="font-size:0.88rem; line-height:2; font-family:'JetBrains Mono',monospace;">
          Octet &nbsp;&nbsp;&nbsp;â†’ 8 bits (1 B)<br>
          Demi-mot â†’ 16 bits (2 B)<br>
          Mot &nbsp;&nbsp;&nbsp;&nbsp;â†’ 32 bits (4 B)<br>
          Mot Ã©tendu â†’ 64 bits (8 B)
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Contraintes de frontiÃ¨res</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âœ¦ <strong>Avec contrainte :</strong> adresse divisible par la taille (ex: mot 32 bits doit Ãªtre Ã  une adresse multiple de 4)<br>
          âœ¦ <strong>Sans contrainte :</strong> toute suite d'octets peut Ãªtre interprÃ©tÃ©e librement
        </div>
      </div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Adressage d'un mot</div>
      Un mot de 32 bits Ã  l'adresse <em>m</em> occupe les octets aux adresses :<br>
      <code style="color:var(--accent4)">m, m+1, m+2, m+3</code><br><br>
      Les bits sont numÃ©rotÃ©s : bit 0 = poids faible (LSB), bit 31 = poids fort (MSB).
    </div>

    <div class="warn-box">
      <div class="box-label label-red">AccÃ¨s mÃ©moire vs Registres</div>
      L'accÃ¨s Ã  la mÃ©moire est <strong>beaucoup plus lent</strong> que l'accÃ¨s aux registres. C'est pourquoi en RISC (comme ARM), seules des instructions spÃ©cialisÃ©es (<code>ldr</code> / <code>str</code>) accÃ¨dent Ã  la mÃ©moire â€” toutes les autres opÃ©rations travaillent sur des registres.
    </div>
  </div>
</div>

<!-- S5 -->
<div class="section" id="s5">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">05</span>
    <span class="section-title">Endianness â€” ordre des octets</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Quand un mot de plusieurs octets est stockÃ© en mÃ©moire, dans quel ordre place-t-on ses octets ? Il existe deux conventions :</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Big Endian</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          L'adresse de la donnÃ©e = adresse de la partie <strong>la plus significative</strong> (MSB en premier)<br>
          Exemple : SPARC, rÃ©seau TCP/IP
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Little Endian</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          L'adresse de la donnÃ©e = adresse de la partie <strong>la moins significative</strong> (LSB en premier)<br>
          Exemple : Intel x86, ARM (par dÃ©faut)
        </div>
      </div>
    </div>

    <!-- ENDIAN VISUALIZER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Visualiseur d'endianness</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Valeur hexadÃ©cimale (32 bits) :</label>
        <input class="viz-input" type="text" id="endian-val" value="A0B1C2D3" placeholder="ex: A0B1C2D3" style="width:150px;" oninput="renderEndian()">
        <label style="font-size:0.85rem; color:var(--muted);">Adresse de base :</label>
        <input class="viz-input" type="number" id="endian-addr" value="100" min="0" oninput="renderEndian()">
      </div>
      <div style="margin-bottom:0.5rem; font-size:0.82rem; color:var(--accent); font-family:'JetBrains Mono',monospace;">Big Endian :</div>
      <div id="endian-big" class="endian-strip"></div>
      <div style="margin: 0.8rem 0 0.5rem; font-size:0.82rem; color:var(--accent4); font-family:'JetBrains Mono',monospace;">Little Endian :</div>
      <div id="endian-little" class="endian-strip"></div>
    </div>

    <div class="warn-box">
      <div class="box-label label-red">Quand l'endianness pose problÃ¨me</div>
      âœ¦ Transfert de donnÃ©es entre deux machines d'endianness diffÃ©rentes<br>
      âœ¦ Lecture octet par octet d'une valeur stockÃ©e en mot (ou vice-versa)
    </div>
  </div>
</div>

<!-- S6 -->
<div class="section" id="s6">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">06</span>
    <span class="section-title">Le processeur â€” registres et instructions</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Le processeur exÃ©cute des instructions. Il possÃ¨de deux types de mÃ©moire locale trÃ¨s rapide : les <strong>registres gÃ©nÃ©raux</strong> et les <strong>registres spÃ©cialisÃ©s</strong>.</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Registres gÃ©nÃ©raux</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âœ¦ Stockent temporairement les opÃ©randes<br>
          âœ¦ AccÃ¨s trÃ¨s rapide (pas de bus)<br>
          âœ¦ Certains dÃ©diÃ©s : pointeur de pile (SP), valeur 0 (xzr)â€¦
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Registres spÃ©cialisÃ©s</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âœ¦ <strong>PC</strong> â€” Program Counter (adresse prochaine instruction)<br>
          âœ¦ <strong>RI</strong> â€” Registre d'instruction (instruction courante)<br>
          âœ¦ <strong>PS/CPSR</strong> â€” Registre d'Ã©tat (flags n, z, v, c)
        </div>
      </div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Jeu d'instructions â€” caractÃ©ristiques</div>
      Un jeu d'instructions est dÃ©crit par :<br>
      âœ¦ Son <strong>nombre</strong> et sa <strong>variÃ©tÃ©</strong> (arithmÃ©tique, logique, contrÃ´leâ€¦)<br>
      âœ¦ Sa <strong>longueur</strong> : toutes Ã©gales (RISC) ou variables (CISC)<br>
      âœ¦ Son <strong>nombre d'opÃ©randes</strong> : 3, 2, 1, ou 0 (pile)
    </div>
  </div>
</div>

<!-- S7 -->
<div class="section" id="s7">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">07</span>
    <span class="section-title">Nombre d'opÃ©randes â€” comparaison</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Pour calculer <strong>E = A Ã· B âˆ’ (C Ã— D)</strong>, voyons comment le nombre d'opÃ©randes affecte le code. Cliquez sur un onglet :</p>

    <div class="step-indicator" id="operand-tabs">
      <span class="step-badge reg-param active-step" onclick="showOperand(0)" style="color:var(--accent3); border-color:var(--accent3)">3 opÃ©randes</span>
      <span class="step-badge reg-temp" onclick="showOperand(1)" style="color:var(--accent4); border-color:var(--accent4)">2 opÃ©randes</span>
      <span class="step-badge reg-local" onclick="showOperand(2)" style="color:var(--purple); border-color:var(--purple)">1 opÃ©rande (acc.)</span>
      <span class="step-badge reg-special" onclick="showOperand(3)" style="color:var(--accent2); border-color:var(--accent2)">0 opÃ©rande (pile)</span>
    </div>

    <div id="operand-panels">
      <div id="op-0">
        <p style="font-size:0.85rem; color:var(--muted); margin-bottom:0.5rem;">La destination est le <strong>premier opÃ©rande</strong>. Propre et lisible, utilisÃ© dans ARM.</p>
        <pre><code><span class="kw">DIV</span>  <span class="reg">T1</span>, <span class="reg">A</span>, <span class="reg">B</span>   <span class="cmt">! T1 = A / B</span>
<span class="kw">MUL</span>  <span class="reg">T2</span>, <span class="reg">C</span>, <span class="reg">D</span>   <span class="cmt">! T2 = C Ã— D</span>
<span class="kw">SUB</span>  <span class="reg">E</span>,  <span class="reg">T1</span>, <span class="reg">T2</span> <span class="cmt">! E  = T1 âˆ’ T2</span></code></pre>
        <div class="tip-box"><div class="box-label label-green">Avantage</div>3 instructions, rÃ©sultat directement dans E. Aucune valeur perdue.</div>
      </div>
      <div id="op-1" style="display:none">
        <p style="font-size:0.85rem; color:var(--muted); margin-bottom:0.5rem;">La destination est le <strong>deuxiÃ¨me opÃ©rande</strong>. Des valeurs originales sont Ã©crasÃ©es.</p>
        <pre><code><span class="kw">DIV</span>  <span class="reg">A</span>, <span class="reg">B</span>   <span class="cmt">! B = A / B  (A est perdu !)</span>
<span class="kw">MUL</span>  <span class="reg">C</span>, <span class="reg">D</span>   <span class="cmt">! D = C Ã— D  (C est perdu !)</span>
<span class="kw">SUB</span>  <span class="reg">B</span>, <span class="reg">D</span>   <span class="cmt">! D = B âˆ’ D</span>
<span class="kw">MOV</span>  <span class="reg">D</span>, <span class="reg">E</span>   <span class="cmt">! E = D</span></code></pre>
        <div class="warn-box"><div class="box-label label-red">InconvÃ©nient</div>4 instructions et perte des valeurs A et C originales.</div>
      </div>
      <div id="op-2" style="display:none">
        <p style="font-size:0.85rem; color:var(--muted); margin-bottom:0.5rem;">On utilise un <strong>accumulateur implicite</strong>. L'ordre des opÃ©rations est rÃ©organisÃ©.</p>
        <pre><code><span class="kw">LOAD</span>   <span class="reg">C</span>  <span class="cmt">! Acc = C</span>
<span class="kw">MUL</span>    <span class="reg">D</span>  <span class="cmt">! Acc = Acc Ã— D</span>
<span class="kw">STORE</span>  <span class="reg">T</span>  <span class="cmt">! T   = Acc  (sauvegarde CÃ—D)</span>
<span class="kw">LOAD</span>   <span class="reg">A</span>  <span class="cmt">! Acc = A</span>
<span class="kw">DIV</span>    <span class="reg">B</span>  <span class="cmt">! Acc = Acc / B</span>
<span class="kw">SUB</span>    <span class="reg">T</span>  <span class="cmt">! Acc = Acc âˆ’ T</span>
<span class="kw">STORE</span>  <span class="reg">E</span>  <span class="cmt">! E   = Acc</span></code></pre>
        <div class="warn-box"><div class="box-label label-red">InconvÃ©nient</div>7 instructions, besoin d'un stockage intermÃ©diaire T.</div>
      </div>
      <div id="op-3" style="display:none">
        <p style="font-size:0.85rem; color:var(--muted); margin-bottom:0.5rem;">Toutes les opÃ©rations utilisent le <strong>sommet de pile</strong> (PUSH/POP).</p>
        <pre><code><span class="kw">PUSH</span>  <span class="reg">A</span>   <span class="cmt">! Empiler A</span>
<span class="kw">PUSH</span>  <span class="reg">B</span>   <span class="cmt">! Empiler B</span>
<span class="kw">DIV</span>        <span class="cmt">! DÃ©piler B et A â†’ empiler A/B</span>
<span class="kw">PUSH</span>  <span class="reg">C</span>   <span class="cmt">! Empiler C</span>
<span class="kw">PUSH</span>  <span class="reg">D</span>   <span class="cmt">! Empiler D</span>
<span class="kw">MUL</span>        <span class="cmt">! DÃ©piler D et C â†’ empiler CÃ—D</span>
<span class="kw">SUB</span>        <span class="cmt">! DÃ©piler T2 et T1 â†’ empiler T1âˆ’T2</span>
<span class="kw">POP</span>   <span class="reg">E</span>   <span class="cmt">! E = dessus de pile</span></code></pre>
        <div class="purple-box"><div class="box-label label-purple">Note</div>8 instructions, mais aucun registre explicite. UtilisÃ© notamment sur la JVM (Java).</div>
      </div>
    </div>
  </div>
</div>

<!-- S8 -->
<div class="section" id="s8">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">08</span>
    <span class="section-title">Technique de pipeline</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Le pipeline permet d'exÃ©cuter plusieurs instructions <em>simultanÃ©ment</em> en les dÃ©calant d'un Ã©tage, comme une chaÃ®ne de montage. Le cycle comporte <strong>5 Ã©tapes</strong> :</p>

    <!-- STAGE DETAIL CARDS -->
    <div class="stage-cards">

      <!-- EI -->
      <div class="stage-card ei-card" onclick="toggleStageCard(this)">
        <div class="stage-card-header">
          <span class="stage-badge" style="color:var(--accent);border-color:var(--accent);background:rgba(91,141,238,0.15);">EI</span>
          <span class="stage-card-title" style="color:var(--accent);">Extraction de l'instruction</span>
          <span style="font-size:0.75rem;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-right:0.5rem;">Instruction Fetch</span>
          <span class="stage-card-chevron">â–¼</span>
        </div>
        <div class="stage-card-body">
          <div class="stage-detail-grid">
            <div class="stage-detail-item">
              <div class="di-label">Ce qui se passe</div>
              <div class="di-val">Le processeur lit l'instruction pointÃ©e par le <strong>PC</strong> (Program Counter) depuis la mÃ©moire d'instructions, puis la dÃ©pose dans le registre d'instruction <strong>RI</strong>.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Composants impliquÃ©s</div>
              <div class="di-val"><strong>PC</strong> â†’ fournit l'adresse Â· <strong>Bus d'adresses</strong> â†’ transmet l'adresse Â· <strong>MÃ©moire</strong> â†’ renvoie l'instruction Â· <strong>RI</strong> â†’ reÃ§oit et stocke l'instruction.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Mise Ã  jour du PC</div>
              <div class="di-val">Le PC est <em>incrÃ©mentÃ©</em> Ã  la fin de cette Ã©tape (PC â† PC + 4 en ARM 32 bits) pour pointer vers l'instruction suivante. Sauf si un branchement modifie le PC Ã  l'Ã©tape MEM.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Exemple concret</div>
              <div class="di-val">Pour l'instruction Ã  l'adresse <code>0x1000</code>, on lit 4 octets Ã  cette adresse, on les place dans RI, et PC passe Ã  <code>0x1004</code>.</div>
            </div>
          </div>
          <div class="stage-always-mem">âš¡ AccÃ¨s mÃ©moire <strong>systÃ©matique</strong> â€” toute instruction doit Ãªtre lue en mÃ©moire</div>
        </div>
      </div>

      <!-- DI -->
      <div class="stage-card di-card" onclick="toggleStageCard(this)">
        <div class="stage-card-header">
          <span class="stage-badge" style="color:var(--accent3);border-color:var(--accent3);background:rgba(54,201,160,0.15);">DI</span>
          <span class="stage-card-title" style="color:var(--accent3);">DÃ©codage de l'instruction & lecture des opÃ©randes</span>
          <span style="font-size:0.75rem;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-right:0.5rem;">Instruction Decode</span>
          <span class="stage-card-chevron">â–¼</span>
        </div>
        <div class="stage-card-body">
          <div class="stage-detail-grid">
            <div class="stage-detail-item">
              <div class="di-label">Ce qui se passe</div>
              <div class="di-val">L'unitÃ© de contrÃ´le dÃ©code le contenu de RI pour identifier l'opÃ©ration Ã  effectuer (type d'instruction, registres sources, registre destination, valeur immÃ©diate Ã©ventuelle).</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Lecture des opÃ©randes</div>
              <div class="di-val">Les registres sources indiquÃ©s dans l'instruction sont <strong>lus simultanÃ©ment</strong> dans le banc de registres. Les valeurs sont placÃ©es dans des registres tampons internes (ex: <code>A</code>, <code>B</code>).</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Extension du signe</div>
              <div class="di-val">Si l'instruction contient une valeur immÃ©diate (constante encodÃ©e dans le code machine), elle est extraite et Ã©tendue au signe pour atteindre la largeur complÃ¨te du bus de donnÃ©es (32 ou 64 bits).</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Exemple concret</div>
              <div class="di-val">Pour <code>ADD R3, R1, R2</code> : on identifie l'opcode ADD, on lit R1 et R2 dans le banc de registres, et on note que R3 sera le registre destination Ã  l'Ã©tape ER.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- EX -->
      <div class="stage-card ex-card" onclick="toggleStageCard(this)">
        <div class="stage-card-header">
          <span class="stage-badge" style="color:var(--accent4);border-color:var(--accent4);background:rgba(245,166,35,0.15);">EX</span>
          <span class="stage-card-title" style="color:var(--accent4);">ExÃ©cution de l'instruction</span>
          <span style="font-size:0.75rem;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-right:0.5rem;">Execute</span>
          <span class="stage-card-chevron">â–¼</span>
        </div>
        <div class="stage-card-body">
          <div class="stage-detail-grid">
            <div class="stage-detail-item">
              <div class="di-label">Ce qui se passe</div>
              <div class="di-val">L'<strong>UAL</strong> (UnitÃ© ArithmÃ©tique et Logique) effectue le calcul : opÃ©ration arithmÃ©tique, logique, dÃ©calage, ou calcul d'adresse effective pour un accÃ¨s mÃ©moire.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Types d'opÃ©rations</div>
              <div class="di-val">
                <strong>ArithmÃ©tiques :</strong> ADD, SUB, MUL, DIV<br>
                <strong>Logiques :</strong> AND, ORR, EOR, BIC<br>
                <strong>DÃ©calages :</strong> LSL, LSR, ASR, ROR<br>
                <strong>Comparaison :</strong> CMP, TST (met Ã  jour les flags NZCV)
              </div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Calcul d'adresse (LDR/STR)</div>
              <div class="di-val">Pour les instructions mÃ©moire, l'UAL calcule l'adresse effective : <code>adresse = Rbase + offset</code>. Ce rÃ©sultat sera utilisÃ© Ã  l'Ã©tape MEM.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Flags de condition</div>
              <div class="di-val">Certaines instructions (suffixe <code>S</code> en ARM, ex: <code>ADDS</code>) mettent Ã  jour les flags : <strong>N</strong> (nÃ©gatif), <strong>Z</strong> (zÃ©ro), <strong>C</strong> (retenue), <strong>V</strong> (dÃ©bordement).</div>
            </div>
          </div>
        </div>
      </div>

      <!-- MEM -->
      <div class="stage-card mem-card" onclick="toggleStageCard(this)">
        <div class="stage-card-header">
          <span class="stage-badge" style="color:var(--accent2);border-color:var(--accent2);background:rgba(224,92,122,0.15);">MEM</span>
          <span class="stage-card-title" style="color:var(--accent2);">AccÃ¨s mÃ©moire & mise Ã  jour du PC (branchement)</span>
          <span style="font-size:0.75rem;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-right:0.5rem;">Memory Access</span>
          <span class="stage-card-chevron">â–¼</span>
        </div>
        <div class="stage-card-body">
          <div class="stage-detail-grid">
            <div class="stage-detail-item">
              <div class="di-label">Chargement (LDR)</div>
              <div class="di-val">L'adresse calculÃ©e Ã  l'Ã©tape EX est utilisÃ©e pour <strong>lire une donnÃ©e en mÃ©moire</strong>. La valeur lue sera Ã©crite dans le registre destination Ã  l'Ã©tape ER.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Stockage (STR)</div>
              <div class="di-val">La valeur d'un registre source est <strong>Ã©crite en mÃ©moire</strong> Ã  l'adresse calculÃ©e Ã  EX. Il n'y a pas d'Ã©criture dans un registre Ã  l'Ã©tape ER pour cette instruction.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Branchement (B, BL, BXâ€¦)</div>
              <div class="di-val">Le <strong>PC est mis Ã  jour</strong> avec la nouvelle adresse cible calculÃ©e Ã  EX. C'est ici que le pipeline dÃ©tecte si le branchement est pris ou non, causant un possible alÃ©a de contrÃ´le.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Instructions sans accÃ¨s mÃ©moire</div>
              <div class="di-val">Pour les instructions arithmÃ©tiques ou logiques (ADD, SUBâ€¦), cette Ã©tape est <em>inactive</em> : aucun accÃ¨s mÃ©moire ni modification du PC n'est effectuÃ©.</div>
            </div>
          </div>
          <div class="stage-mem-note">âš  AccÃ¨s mÃ©moire <strong>conditionnel</strong> â€” uniquement pour LDR et STR</div>
        </div>
      </div>

      <!-- ER -->
      <div class="stage-card er-card" onclick="toggleStageCard(this)">
        <div class="stage-card-header">
          <span class="stage-badge" style="color:var(--purple);border-color:var(--purple);background:rgba(201,122,245,0.15);">ER</span>
          <span class="stage-card-title" style="color:var(--purple);">Ã‰criture du rÃ©sultat dans un registre</span>
          <span style="font-size:0.75rem;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-right:0.5rem;">Write Back</span>
          <span class="stage-card-chevron">â–¼</span>
        </div>
        <div class="stage-card-body">
          <div class="stage-detail-grid">
            <div class="stage-detail-item">
              <div class="di-label">Ce qui se passe</div>
              <div class="di-val">Le rÃ©sultat produit par l'Ã©tape EX (calcul UAL) ou MEM (valeur chargÃ©e depuis la mÃ©moire) est <strong>Ã©crit dans le registre destination</strong> spÃ©cifiÃ© par l'instruction.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Source du rÃ©sultat</div>
              <div class="di-val">Un multiplexeur sÃ©lectionne la bonne source : <strong>sortie de l'UAL</strong> (pour ADD, SUB, ANDâ€¦) ou <strong>donnÃ©e lue en mÃ©moire</strong> (pour LDR). La valeur est ensuite Ã©crite dans le banc de registres.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">Instructions sans ER actif</div>
              <div class="di-val">Les instructions <strong>STR</strong> (stockage) et de <strong>branchement</strong> n'Ã©crivent pas dans un registre destination : l'Ã©tape ER est inopÃ©rante pour elles.</div>
            </div>
            <div class="stage-detail-item">
              <div class="di-label">AlÃ©a de donnÃ©es (RAW)</div>
              <div class="di-val">Si une instruction suivante a besoin du rÃ©sultat avant que ER ne soit terminÃ©, on a un alÃ©a de donnÃ©es (<em>Read After Write</em>). Le matÃ©riel peut injecter des bulles (<em>stalls</em>) ou utiliser le <em>forwarding</em>.</div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- end stage-cards -->

    <!-- PIPELINE VISUALIZER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Visualiseur de pipeline â€” 3 instructions</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Mode :</label>
        <select class="viz-input" id="pl-mode" onchange="renderPipeline()">
          <option value="with">Avec pipeline</option>
          <option value="without">Sans pipeline</option>
        </select>
      </div>
      <div class="pipeline-wrap">
        <div id="pl-grid"></div>
      </div>
      <div id="pl-summary" style="margin-top:0.75rem; font-family:'JetBrains Mono',monospace; font-size:0.85rem; color:var(--accent4);"></div>
    </div>

    <div class="warn-box">
      <div class="box-label label-red">Conflits dans le pipeline</div>
      <strong>1. AccÃ¨s mÃ©moire simultanÃ©s</strong> â€” ex: instructions 1 et 4 accÃ¨dent Ã  la mÃ©moire en mÃªme temps â†’ rÃ©solu par le matÃ©riel.<br>
      <strong>2. DÃ©pendance de donnÃ©es</strong> â€” une instruction a besoin du rÃ©sultat de la prÃ©cÃ©dente encore dans le pipeline â†’ rÃ©solu majoritairement par le matÃ©riel.<br>
      <strong>3. Branchements (hasards)</strong> â€” le pipeline ne sait pas quelle instruction charger â†’ suspendu jusqu'Ã  rÃ©solution (Ã©tape MEM). Une instruction incorrecte peut Ãªtre partiellement exÃ©cutÃ©e.
    </div>
  </div>
</div>

<!-- S9 -->
<div class="section" id="s9">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">09</span>
    <span class="section-title">Architecture ARM v8 â€” spÃ©cificitÃ©s</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>ARM v8 est une architecture <strong>RISC 64 bits</strong>. Voici ses caractÃ©ristiques mÃ©moire et de cycle d'instruction :</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">MÃ©moire ARM</div>
        <div style="font-size:0.88rem; line-height:2;">
          âœ¦ Supporte octets, demi-mots, mots (32b), mots Ã©tendus (64b)<br>
          âœ¦ Adresses reprÃ©sentÃ©es sur <strong>64 bits</strong><br>
          âœ¦ GÃ©nÃ©ralement <strong>pas de contraintes de frontiÃ¨res</strong><br>
          âœ¦ Bit 0 = bit le moins significatif (LSB)<br>
          âœ¦ Format <strong>little-endian</strong> par dÃ©faut
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Cycle d'instruction ARM</div>
        <div style="font-size:0.88rem; line-height:2;">
          âœ¦ Extraction instruction (adresse = PC) â†’ RI<br>
          âœ¦ DÃ©codage + accÃ¨s opÃ©randes<br>
          âœ¦ ExÃ©cution (si pas de reset/interruption)<br>
          âœ¦ PC â† nPC &nbsp;Â·&nbsp; nPC â† nPC + 4<br>
          âœ¦ Si branchement : nPC â† adresse cible
        </div>
      </div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Registres spÃ©cialisÃ©s ARM</div>
      âœ¦ <strong>PC</strong> (64 bits) â€” adresse de l'instruction en cours d'exÃ©cution<br>
      âœ¦ <strong>CPSR</strong> â€” registre de codes de condition : <code>n</code> (nÃ©gatif), <code>z</code> (zÃ©ro), <code>v</code> (dÃ©bordement), <code>c</code> (report) â€” prÃ©sents en version 32 bits et 64 bits<br>
      âœ¦ <strong>Registres virgule flottante</strong> : s0â€“s31 (32b), d0â€“d31 (64b), q0â€“q31 (128b)
    </div>

    <div class="purple-box">
      <div class="box-label label-purple">Sauvegarde des registres (SAVE / RESTORE)</div>
      Les registres ARM sont fondamentalement des <strong>variables globales</strong>. Par convention :<br>
      âœ¦ Un sous-programme <strong>DOIT sauvegarder</strong> x19â€“x30 avant de les utiliser<br>
      âœ¦ Il <strong>DOIT les restaurer</strong> avant de retourner au programme appelant<br>
      âœ¦ La sauvegarde se fait sur la <strong>pile systÃ¨me</strong> (adresse dans <code>sp</code>)<br>
      âœ¦ Les macros <code>SAVE</code> et <code>RESTORE</code> automatisent cette opÃ©ration
    </div>

    <pre><code><span class="lbl">mon_sous_prog:</span>
    <span class="kw">SAVE</span>      <span class="cmt">! Sauvegarde x19â€“x30 sur la pile, avance sp</span>
    â‹®
    <span class="cmt">! Corps du sous-programme</span>
    â‹®
    <span class="kw">RESTORE</span>   <span class="cmt">! Restaure x19â€“x30, recule sp</span>
    <span class="kw">RET</span>       <span class="cmt">! Retour au programme appelant</span></code></pre>
  </div>
</div>

<!-- S10 -->
<div class="section" id="s10">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">10</span>
    <span class="section-title">Registres ARM â€” tableau de rÃ©fÃ©rence</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>ARM v8 possÃ¨de <strong>32 registres gÃ©nÃ©raux 64 bits</strong> (x0â€“x30 + xzr). Chaque registre peut Ãªtre utilisÃ© en version 32 bits en remplaÃ§ant le prÃ©fixe <code>x</code> par <code>w</code>.</p>

    <div style="display:flex; gap:0.5rem; flex-wrap:wrap; margin-bottom:1rem; font-size:0.82rem;">
      <span class="reg-badge reg-param">x0â€“x7 : paramÃ¨tres / retour</span>
      <span class="reg-badge reg-sys">x8 : retour indirect</span>
      <span class="reg-badge reg-temp">x9â€“x15 : temporaires</span>
      <span class="reg-badge reg-local">x16â€“x17 : bibliothÃ¨ques partagÃ©es</span>
      <span class="reg-badge reg-local" style="color:var(--purple)">x19â€“x28 : locaux (Ã  sauvegarder)</span>
      <span class="reg-badge reg-special">x29/fp, x30/lr, sp, xzr/pc</span>
    </div>

    <table>
      <thead>
        <tr><th>Registre</th><th>Alias</th><th>Usage</th><th>SauvegardÃ© ?</th></tr>
      </thead>
      <tbody>
        <tr><td class="mono">x0 â€“ x7</td><td>â€”</td><td>ParamÃ¨tres d'entrÃ©e et valeur de retour</td><td style="color:var(--accent2)">Non</td></tr>
        <tr><td class="mono">x8</td><td>â€”</td><td>Retour indirect (type complexe)</td><td style="color:var(--accent2)">Non</td></tr>
        <tr><td class="mono">x9 â€“ x15</td><td>â€”</td><td>Registres temporaires</td><td style="color:var(--accent2)">Non</td></tr>
        <tr><td class="mono">x16 â€“ x17</td><td>ip1, ip2</td><td>BibliothÃ¨ques partagÃ©es (libCâ€¦)</td><td style="color:var(--accent2)">Non</td></tr>
        <tr><td class="mono">x18</td><td>â€”</td><td>DÃ©pend de l'implÃ©mentation ARM</td><td style="color:var(--muted)">Variable</td></tr>
        <tr><td class="mono">x19 â€“ x28</td><td>â€”</td><td>Registres locaux</td><td style="color:var(--accent3)">Oui âœ¦</td></tr>
        <tr><td class="mono">x29</td><td>fp</td><td>Frame pointer (pointeur de portÃ©e)</td><td style="color:var(--accent3)">Oui âœ¦</td></tr>
        <tr><td class="mono">x30</td><td>lr</td><td>Link register (adresse de retour)</td><td style="color:var(--accent3)">Oui âœ¦</td></tr>
        <tr><td class="mono">sp</td><td>â€”</td><td>Stack pointer (pointeur de pile)</td><td style="color:var(--muted)">SpÃ©cial</td></tr>
        <tr><td class="mono">xzr</td><td>â€”</td><td>Contient toujours 0 (lecture = 0, Ã©criture = ignorÃ©e)</td><td style="color:var(--muted)">â€”</td></tr>
        <tr><td class="mono">pc</td><td>â€”</td><td>Program Counter (non assignable directement)</td><td style="color:var(--muted)">â€”</td></tr>
      </tbody>
    </table>
    <p style="font-size:0.8rem; color:var(--muted);">âœ¦ SauvegardÃ©s automatiquement par les macros SAVE / RESTORE.</p>

    <!-- REGISTER QUIZ TOOL -->
    <div class="viz-tool">
      <h4>ğŸ”§ Quel registre utiliser ?</h4>
      <p style="font-size:0.83rem; color:var(--muted); margin-bottom:0.75rem;">Entrez un nom de registre pour voir son rÃ´le :</p>
      <div class="viz-input-row">
        <input class="viz-input" type="text" id="reg-query" placeholder="ex: x0, sp, x29, lr..." style="width:130px;" oninput="lookupReg()">
      </div>
      <div id="reg-info" style="font-family:'JetBrains Mono',monospace; font-size:0.84rem; color:var(--muted); min-height:40px;"></div>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="quiz-wrap" id="quiz">
  <h3>ğŸ§  Quiz de rÃ©vision â€” Chapitre 2</h3>

  <div class="quiz-card" id="q1">
    <p class="quiz-q"><strong>Q1.</strong> Dans l'architecture de von Neumann, quel registre contient l'adresse de la prochaine instruction Ã  exÃ©cuter ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” le RI (registre d\\'instruction) contient l\\'instruction en cours de dÃ©codage, pas l\\'adresse.')">RI (Registre d'instruction)</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q1','Exact ! Le PC (Program Counter / compteur ordinal) pointe toujours vers la prochaine instruction Ã  extraire.')">PC (Program Counter)</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” le SP (Stack Pointer) pointe vers le sommet de la pile, pas les instructions.')">SP (Stack Pointer)</button>
    </div>
    <p class="quiz-feedback" id="q1-fb"></p>
  </div>

  <div class="quiz-card" id="q2">
    <p class="quiz-q"><strong>Q2.</strong> Quelle est la principale diffÃ©rence entre RISC et CISC concernant l'accÃ¨s mÃ©moire ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','C\\'est l\\'inverse : le RISC a plus de registres, le CISC en a moins.')">RISC a moins de registres que CISC</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q2','Exact ! En RISC, seules les instructions load/store accÃ¨dent Ã  la mÃ©moire. Toutes les autres opÃ¨rent sur des registres.')">En RISC, seules certaines instructions (load/store) accÃ¨dent Ã  la mÃ©moire</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” c\\'est l\\'inverse : RISC a des instructions de longueur fixe, CISC de longueur variable.')">RISC utilise des instructions de longueur variable</button>
    </div>
    <p class="quiz-feedback" id="q2-fb"></p>
  </div>

  <div class="quiz-card" id="q3">
    <p class="quiz-q"><strong>Q3.</strong> On stocke la valeur <code>0xA0B1C2D3</code> en mÃ©moire Ã  l'adresse N sur un systÃ¨me <strong>little-endian</strong>. Quel octet se trouve Ã  l'adresse N ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” A0 est le byte le plus significatif. En little-endian, c\\'est le moins significatif qui est placÃ© en premier.')">0xA0 (octet le plus significatif)</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q3','Correct ! En little-endian, l\\'octet le moins significatif (0xD3) est Ã  l\\'adresse de base N.')">0xD3 (octet le moins significatif)</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” C2 est l\\'avant-dernier octet. En little-endian, D3 est en N, C2 en N+1, B1 en N+2, A0 en N+3.')">0xC2</button>
    </div>
    <p class="quiz-feedback" id="q3-fb"></p>
  </div>

  <div class="quiz-card" id="q4">
    <p class="quiz-q"><strong>Q4.</strong> Combien de cycles faut-il pour exÃ©cuter 3 instructions <strong>avec</strong> un pipeline Ã  5 Ã©tages (sans conflit) ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” 15 cycles c\\'est le coÃ»t sans pipeline (3 Ã— 5). Le pipeline rÃ©duit considÃ©rablement ce nombre.')">15 cycles</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q4','Exact ! Avec pipeline : 5 (remplissage) + 2 (instructions suivantes) = 7 cycles. Formule gÃ©nÃ©rale : n_Ã©tages + (n_instructions âˆ’ 1).')">7 cycles</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” 5 cycles suffiraient pour une seule instruction. Avec 3 instructions, il faut 7 cycles.')">5 cycles</button>
    </div>
    <p class="quiz-feedback" id="q4-fb"></p>
  </div>

  <div class="quiz-card" id="q5">
    <p class="quiz-q"><strong>Q5.</strong> En ARM, si vous Ã©crivez une valeur dans le registre <code>xzr</code>, que se passe-t-il ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” xzr est un registre spÃ©cial : toute Ã©criture est simplement ignorÃ©e.')">Une exception est levÃ©e</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” xzr vaut TOUJOURS 0, mÃªme aprÃ¨s une Ã©criture. La valeur Ã©crite n\\'est pas conservÃ©e.')">La valeur est stockÃ©e et remplace le 0</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q5','Exact ! L\\'Ã©criture dans xzr n\\'a aucun effet. En lecture, xzr retourne toujours 0. Utile pour ignorer un rÃ©sultat ou initialiser Ã  0.')">L'Ã©criture est ignorÃ©e â€” xzr vaut toujours 0</button>
    </div>
    <p class="quiz-feedback" id="q5-fb"></p>
  </div>

  <div class="quiz-card" id="q6">
    <p class="quiz-q"><strong>Q6.</strong> Pourquoi un sous-programme ARM <strong>doit-il</strong> sauvegarder les registres x19â€“x30 avant de les utiliser ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q6','Non â€” il n\\'y a pas de protection matÃ©rielle. C\\'est une convention logicielle qui garantit l\\'intÃ©gritÃ© du programme appelant.')">Le processeur empÃªche physiquement leur modification</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q6','Exact ! Les registres ARM sont des variables globales. Le programme appelant s\\'attend Ã  retrouver x19â€“x30 intacts aprÃ¨s l\\'appel. La convention garantit cela.')">Ce sont des variables globales partagÃ©es â€” le programme appelant doit les retrouver intacts</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q6','Non â€” tous les registres x0â€“x30 sont des registres physiques de 64 bits. La diffÃ©rence est une convention d\\'usage, pas de taille.')">Ils sont plus petits que les autres registres</button>
    </div>
    <p class="quiz-feedback" id="q6-fb"></p>
  </div>

</div>
</main>`,
    script: `// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggle(header) {
  header.closest('.section').classList.toggle('collapsed');
}
function ans(btn, result, qid, feedback) {
  const card = document.getElementById(qid);
  card.querySelectorAll('.quiz-opt').forEach(o => { o.disabled = true; o.style.opacity = '0.5'; });
  btn.style.opacity = '1';
  btn.classList.add(result);
  document.getElementById(qid + '-fb').textContent = (result === 'correct' ? 'âœ… ' : 'âŒ ') + feedback;
}
document.querySelectorAll('.toc-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    e.preventDefault();
    const t = document.querySelector(btn.getAttribute('href'));
    if (t) { t.scrollIntoView({ behavior: 'smooth', block: 'start' }); if (t.classList.contains('collapsed')) t.classList.remove('collapsed'); }
  });
});

// â”€â”€ VON NEUMANN INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const vnInfos = {
  cpu:  '<strong style="color:var(--accent)">Processeur (CPU)</strong> â€” GÃ¨re l\\'allocation du bus, dÃ©code et exÃ©cute les instructions. PossÃ¨de une petite mÃ©moire locale ultra-rapide : les <em>registres</em>.',
  uc:   '<strong style="color:var(--accent)">UnitÃ© de ContrÃ´le</strong> â€” Extrait les instructions de la mÃ©moire, les dÃ©code, coordonne les autres unitÃ©s. Maintient le PC et le RI.',
  ual:  '<strong style="color:var(--accent)">UAL (UnitÃ© ArithmÃ©tique et Logique)</strong> â€” Effectue les calculs : additions, soustractions, opÃ©rations boolÃ©ennes (AND, OR, XORâ€¦), comparaisons.',
  reg:  '<strong style="color:var(--accent)">Registres</strong> â€” MÃ©moire locale du processeur. AccÃ¨s en une fraction de nanoseconde. Contiennent temporairement les opÃ©randes et rÃ©sultats des instructions.',
  mem:  '<strong style="color:var(--accent4)">MÃ©moire principale (RAM)</strong> â€” Stocke le programme <em>et</em> ses donnÃ©es. AccÃ¨s beaucoup plus lent que les registres (passage par le bus). Chaque cellule a une adresse unique.',
  io1:  '<strong style="color:var(--accent4)">UnitÃ© d\\'EntrÃ©e/Sortie</strong> â€” ContrÃ´le les pÃ©riphÃ©riques (clavier, Ã©cran, disque, rÃ©seauâ€¦). Programmation complexe, communication par protocole. TrÃ¨s lent comparÃ© aux registres et Ã  la RAM.',
  io2:  '<strong style="color:var(--accent4)">UnitÃ© d\\'EntrÃ©e/Sortie</strong> â€” Un deuxiÃ¨me contrÃ´leur de pÃ©riphÃ©riques. Les systÃ¨mes modernes en ont de nombreux (PCIe, USB, SATAâ€¦).',
};
function showVnInfo(key) {
  document.getElementById('vn-info').innerHTML = vnInfos[key] || '';
}

// â”€â”€ OPERAND TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tabColors = [
  {c:'var(--accent3)', bg:'rgba(54,201,160,0.1)'},
  {c:'var(--accent4)', bg:'rgba(245,166,35,0.1)'},
  {c:'var(--purple)',  bg:'rgba(201,122,245,0.1)'},
  {c:'var(--accent2)', bg:'rgba(224,92,122,0.1)'},
];
function showOperand(idx) {
  [0,1,2,3].forEach(i => {
    document.getElementById('op-' + i).style.display = i === idx ? 'block' : 'none';
  });
  document.querySelectorAll('#operand-tabs .step-badge').forEach((b,i) => {
    b.classList.toggle('active-step', i === idx);
  });
}

// â”€â”€ ENDIAN VISUALIZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderEndian() {
  let raw = document.getElementById('endian-val').value.replace(/\\s/g, '').toUpperCase();
  const addr = parseInt(document.getElementById('endian-addr').value) || 100;

  // Keep only valid hex chars, cap at 16 bytes (128 bits)
  raw = raw.replace(/[^0-9A-F]/g, '').slice(0, 32);

  // If odd number of chars, pad left with 0 to form complete bytes
  if (raw.length % 2 !== 0) raw = '0' + raw;

  // Build array of byte strings from the cleaned input (no forced padding)
  const bytes = [];
  for (let i = 0; i < raw.length; i += 2) bytes.push(raw.slice(i, i + 2));

  const n = bytes.length;

  // Show an error/hint if empty
  const bigEl    = document.getElementById('endian-big');
  const littleEl = document.getElementById('endian-little');
  if (n === 0) {
    bigEl.innerHTML = littleEl.innerHTML =
      '<span style="color:var(--muted);font-family:\\'JetBrains Mono\\',monospace;font-size:0.8rem;padding:0.5rem;">â€” entrez une valeur hexadÃ©cimale â€”</span>';
    return;
  }

  function buildStrip(order, containerEl, littleEndian) {
    let html = '';
    order.forEach((byteVal, pos) => {
      const a = addr + pos;
      // In big-endian: pos 0 = MSB, pos n-1 = LSB
      // In little-endian: pos 0 = LSB (least significant stored first), pos n-1 = MSB
      const isMSB = littleEndian ? pos === n - 1 : pos === 0;
      const isLSB = littleEndian ? pos === 0      : pos === n - 1;
      html += \`<div class="endian-cell \${isMSB ? 'msb' : ''} \${isLSB && n > 1 ? 'lsb' : ''}">
        <div class="e-addr">0x\${a.toString(16).toUpperCase().padStart(2,'0')}</div>
        <div class="e-val">0x\${byteVal}</div>
        <div class="e-sig">\${isMSB ? 'MSB' : (isLSB && n > 1) ? 'LSB' : ''}</div>
      </div>\`;
    });
    containerEl.innerHTML = html;
  }

  // Big endian: MSB first â†’ bytes in original order
  buildStrip(bytes, bigEl, false);
  // Little endian: LSB first â†’ bytes reversed
  buildStrip([...bytes].reverse(), littleEl, true);
}
renderEndian();

// â”€â”€ PIPELINE STAGE CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleStageCard(card) {
  card.classList.toggle('open');
}

// â”€â”€ PIPELINE VISUALIZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STAGES = ['EI','DI','EX','MEM','ER'];
const STAGE_CLASS = {EI:'ei', DI:'di', EX:'ex', MEM:'mem', ER:'er'};
const STAGE_COLORS = {EI:'var(--accent)', DI:'var(--accent3)', EX:'var(--accent4)', MEM:'var(--accent2)', ER:'var(--purple)'};

function renderPipeline() {
  const mode = document.getElementById('pl-mode').value;
  const N = 3; // instructions
  const S = 5; // stages

  let grid = document.getElementById('pl-grid');
  let totalCycles, layout;

  if (mode === 'with') {
    // With pipeline: instruction i starts at cycle i
    totalCycles = S + N - 1; // 7
    layout = [];
    // Header row
    const headerRow = [''].concat(Array.from({length: totalCycles}, (_,i) => 'Cycle ' + (i+1)));
    layout.push(headerRow);
    for (let inst = 0; inst < N; inst++) {
      const row = ['I' + (inst+1)];
      for (let c = 0; c < totalCycles; c++) {
        const stageIdx = c - inst;
        if (stageIdx >= 0 && stageIdx < S) {
          row.push(STAGES[stageIdx]);
        } else {
          row.push('');
        }
      }
      layout.push(row);
    }
  } else {
    // Without pipeline: each instruction must complete all S stages before next starts
    totalCycles = N * S; // 15
    layout = [];
    const headerRow = [''].concat(Array.from({length: totalCycles}, (_,i) => 'C' + (i+1)));
    layout.push(headerRow);
    for (let inst = 0; inst < N; inst++) {
      const row = ['I' + (inst+1)];
      for (let c = 0; c < totalCycles; c++) {
        const stageIdx = c - inst * S;
        if (stageIdx >= 0 && stageIdx < S) {
          row.push(STAGES[stageIdx]);
        } else {
          row.push('');
        }
      }
      layout.push(row);
    }
  }

  grid.style.gridTemplateColumns = \`40px repeat(\${totalCycles}, 1fr)\`;
  let html = '';
  layout.forEach((row, ri) => {
    row.forEach((cell, ci) => {
      if (ri === 0) {
        html += \`<div class="pl-cell hdr">\${cell}</div>\`;
      } else if (ci === 0) {
        html += \`<div class="pl-cell lbl">\${cell}</div>\`;
      } else if (!cell) {
        html += \`<div class="pl-cell empty"></div>\`;
      } else {
        html += \`<div class="pl-cell \${STAGE_CLASS[cell]}">\${cell}</div>\`;
      }
    });
  });
  grid.className = 'pipeline-grid';
  grid.innerHTML = html;
  document.getElementById('pl-summary').textContent =
    mode === 'with'
      ? \`âœ¦ Avec pipeline : \${N} instructions en \${totalCycles} cycles  (gain : \${N * S - totalCycles} cycles)\`
      : \`âœ¦ Sans pipeline : \${N} instructions en \${totalCycles} cycles  (\${S} cycles/instruction Ã— \${N})\`;
}
renderPipeline();

// â”€â”€ REGISTER LOOKUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const regDB = {
  'x0':  {desc: 'ParamÃ¨tre #1 et valeur de retour. Non sauvegardÃ© par les sous-programmes.', color: 'var(--accent3)'},
  'x1':  {desc: 'ParamÃ¨tre #2. Non sauvegardÃ©.', color: 'var(--accent3)'},
  'x2':  {desc: 'ParamÃ¨tre #3. Non sauvegardÃ©.', color: 'var(--accent3)'},
  'x3':  {desc: 'ParamÃ¨tre #4. Non sauvegardÃ©.', color: 'var(--accent3)'},
  'x4':  {desc: 'ParamÃ¨tre #5. Non sauvegardÃ©.', color: 'var(--accent3)'},
  'x5':  {desc: 'ParamÃ¨tre #6. Non sauvegardÃ©.', color: 'var(--accent3)'},
  'x6':  {desc: 'ParamÃ¨tre #7. Non sauvegardÃ©.', color: 'var(--accent3)'},
  'x7':  {desc: 'ParamÃ¨tre #8. Non sauvegardÃ©.', color: 'var(--accent3)'},
  'x8':  {desc: 'Retour indirect â€” pour retourner un type de donnÃ©es complexe.', color: 'var(--accent)'},
  'x9':  {desc: 'Registre temporaire. Non sauvegardÃ© par les sous-programmes.', color: 'var(--accent4)'},
  'x10': {desc: 'Registre temporaire. Non sauvegardÃ©.', color: 'var(--accent4)'},
  'x11': {desc: 'Registre temporaire. Non sauvegardÃ©.', color: 'var(--accent4)'},
  'x12': {desc: 'Registre temporaire. Non sauvegardÃ©.', color: 'var(--accent4)'},
  'x13': {desc: 'Registre temporaire. Non sauvegardÃ©.', color: 'var(--accent4)'},
  'x14': {desc: 'Registre temporaire. Non sauvegardÃ©.', color: 'var(--accent4)'},
  'x15': {desc: 'Registre temporaire. Non sauvegardÃ©.', color: 'var(--accent4)'},
  'x16': {desc: 'ip1 â€” UtilisÃ© par les bibliothÃ¨ques partagÃ©es (libC). Temporaire sinon.', color: 'var(--purple)'},
  'x17': {desc: 'ip2 â€” UtilisÃ© par les bibliothÃ¨ques partagÃ©es (libC). Temporaire sinon.', color: 'var(--purple)'},
  'x18': {desc: 'Usage dÃ©pendant de l\\'implÃ©mentation ARM. Peut Ãªtre rÃ©servÃ© pour le systÃ¨me.', color: 'var(--muted)'},
  'x19': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ© (SAVE/RESTORE) si utilisÃ© dans un sous-programme.', color: 'var(--purple)'},
  'x20': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x21': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x22': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x23': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x24': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x25': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x26': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x27': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x28': {desc: 'Registre local. DOIT Ãªtre sauvegardÃ©.', color: 'var(--purple)'},
  'x29': {desc: 'fp â€” Frame Pointer (pointeur de portÃ©e). DOIT Ãªtre sauvegardÃ©.', color: 'var(--accent2)'},
  'x30': {desc: 'lr â€” Link Register (adresse de retour). DOIT Ãªtre sauvegardÃ©.', color: 'var(--accent2)'},
  'xzr': {desc: 'Zero Register â€” Contient TOUJOURS 0. Toute Ã©criture est ignorÃ©e.', color: 'var(--accent2)'},
  'sp':  {desc: 'Stack Pointer â€” Adresse du sommet de la pile systÃ¨me. AvancÃ© lors de SAVE, reculÃ© lors de RESTORE.', color: 'var(--accent2)'},
  'pc':  {desc: 'Program Counter â€” Adresse de l\\'instruction en cours d\\'exÃ©cution. Non assignable directement.', color: 'var(--accent2)'},
  'lr':  {desc: 'Alias de x30 â€” Link Register. Contient l\\'adresse de retour aprÃ¨s un BL (branch-and-link).', color: 'var(--accent2)'},
  'fp':  {desc: 'Alias de x29 â€” Frame Pointer. Pointe sur le cadre de pile du sous-programme courant.', color: 'var(--accent2)'},
};

function lookupReg() {
  const q = document.getElementById('reg-query').value.trim().toLowerCase();
  const el = document.getElementById('reg-info');
  const info = regDB[q];
  if (!q) { el.textContent = ''; return; }
  if (info) {
    el.innerHTML = \`<span style="color:\${info.color}">\${q.toUpperCase()}</span> â€” \${info.desc}\`;
  } else {
    el.innerHTML = \`<span style="color:var(--accent2)">Registre inconnu : \${q}</span>\`;
  }
}`
  },
  {
    title: `Chapitre 3`,
    subtitle: `L'accÃ¨s aux donnÃ©es`,
    desc: `HiÃ©rarchie mÃ©moire, adressage ARM`,
    accent: `#36c9a0`,
    css: `
  :root {
    --bg: #0d0f14;
    --surface: #141720;
    --surface2: #1c2030;
    --border: #252a3a;
    --accent: #5b8dee;
    --accent2: #e05c7a;
    --accent3: #36c9a0;
    --accent4: #f5a623;
    --purple: #c97af5;
    --text: #e0e4f0;
    --muted: #7a8099;
    --code-bg: #0a0c11;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Lato', sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; }

  header {
    background: linear-gradient(135deg, #0d1220 0%, #111827 100%);
    border-bottom: 1px solid var(--border);
    padding: 3rem 2rem 2rem; position: relative; overflow: hidden;
  }
  header::before {
    content: ''; position: absolute; top: -60px; right: -60px;
    width: 350px; height: 350px;
    background: radial-gradient(circle, rgba(91,141,238,0.1) 0%, transparent 70%);
    pointer-events: none;
  }
  .chip {
    display: inline-block; background: rgba(91,141,238,0.12);
    border: 1px solid rgba(91,141,238,0.3); color: var(--accent);
    font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
    padding: 3px 10px; border-radius: 4px; letter-spacing: 0.1em;
    text-transform: uppercase; margin-bottom: 1rem;
  }
  h1 { font-family: 'Syne', sans-serif; font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 800; line-height: 1.15; margin-bottom: 0.5rem; }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 1rem; font-weight: 300; }

  .toc-bar {
    background: var(--surface); border-bottom: 1px solid var(--border);
    padding: 0.75rem 2rem; display: flex; gap: 0.5rem; flex-wrap: wrap;
    position: sticky; top: 0; z-index: 100;
  }
  .toc-btn {
    font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
    padding: 4px 12px; border-radius: 4px; border: 1px solid var(--border);
    background: transparent; color: var(--muted); cursor: pointer;
    transition: all 0.2s; text-decoration: none;
  }
  .toc-btn:hover { background: var(--surface2); color: var(--text); border-color: var(--accent); }

  main { max-width: 980px; margin: 0 auto; padding: 2.5rem 1.5rem 5rem; }

  .section {
    margin-bottom: 2rem; border: 1px solid var(--border); border-radius: 12px;
    overflow: hidden; background: var(--surface); transition: border-color 0.3s;
  }
  .section:hover { border-color: rgba(91,141,238,0.25); }
  .section-header {
    padding: 1.1rem 1.5rem; display: flex; align-items: center; gap: 0.9rem;
    cursor: pointer; user-select: none; background: var(--surface2); transition: background 0.2s;
  }
  .section-header:hover { background: #1f2538; }
  .section-num {
    font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--accent);
    background: rgba(91,141,238,0.1); border: 1px solid rgba(91,141,238,0.25);
    border-radius: 4px; padding: 2px 7px;
  }
  .section-title { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700; flex: 1; }
  .chevron { color: var(--muted); font-size: 0.75rem; transition: transform 0.25s; }
  .section.collapsed .chevron { transform: rotate(-90deg); }
  .section-body { padding: 1.5rem; }
  .section.collapsed .section-body { display: none; }

  p { font-size: 0.94rem; margin-bottom: 0.75rem; }

  .highlight-box { border-left: 3px solid var(--accent); background: rgba(91,141,238,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .warn-box      { border-left: 3px solid var(--accent2); background: rgba(224,92,122,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .tip-box       { border-left: 3px solid var(--accent3); background: rgba(54,201,160,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .purple-box    { border-left: 3px solid var(--purple);  background: rgba(201,122,245,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .box-label { font-family: 'JetBrains Mono', monospace; font-size: 0.63rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.35rem; font-weight: 700; }
  .label-blue   { color: var(--accent); }
  .label-red    { color: var(--accent2); }
  .label-green  { color: var(--accent3); }
  .label-orange { color: var(--accent4); }
  .label-purple { color: var(--purple); }

  pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px; padding: 1rem 1.2rem; overflow-x: auto; margin: 1rem 0; }
  code { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; line-height: 1.85; color: #c9d0e8; }
  .cmt  { color: #636e8c; font-style: italic; }
  .kw   { color: var(--accent); }
  .reg  { color: var(--accent3); }
  .num  { color: var(--accent4); }

  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; margin: 1rem 0; }
  th { background: var(--surface2); color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.07em; padding: 0.6rem 0.9rem; border: 1px solid var(--border); text-align: left; }
  td { padding: 0.55rem 0.9rem; border: 1px solid var(--border); vertical-align: middle; font-size: 0.85rem; }
  tr:hover td { background: rgba(255,255,255,0.02); }
  .mono { font-family: 'JetBrains Mono', monospace; color: var(--accent3); font-size: 0.82rem; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0; }
  @media (max-width: 600px) { .two-col { grid-template-columns: 1fr; } }
  .mini-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 0.9rem 1rem; }
  .mini-card .mc-title { font-family: 'JetBrains Mono', monospace; color: var(--accent4); font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem; }

  /* VIZ TOOL */
  .viz-tool { background: var(--surface2); border: 1px solid var(--border); border-radius: 12px; padding: 1.4rem; margin: 1rem 0; }
  .viz-tool h4 { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 700; color: var(--accent4); margin-bottom: 1.1rem; }
  .viz-input-row { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .viz-input {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px;
    color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
    padding: 0.45rem 0.65rem; width: 130px; outline: none; transition: border-color 0.2s;
  }
  .viz-input:focus { border-color: var(--accent); }
  .viz-btn {
    background: rgba(91,141,238,0.15); border: 1px solid rgba(91,141,238,0.35);
    color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
    padding: 0.45rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
  }
  .viz-btn:hover { background: rgba(91,141,238,0.28); }
  .viz-result {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px;
    padding: 0.85rem 1rem; margin-top: 0.75rem;
    font-family: 'JetBrains Mono', monospace; font-size: 0.84rem; line-height: 2;
  }
  .viz-result .step { display: flex; gap: 0.6rem; align-items: baseline; flex-wrap: wrap; margin-bottom: 0.1rem; }
  .viz-result .step-label { color: var(--muted); font-size: 0.75rem; min-width: 200px; }
  .viz-result .step-val { color: var(--text); }
  .viz-result .step-val em { color: var(--accent4); font-style: normal; }

  /* MEMORY HIERARCHY */
  .mem-pyramid { display: flex; flex-direction: column; align-items: center; gap: 0.35rem; margin: 1.5rem 0; }
  .mem-level {
    display: flex; align-items: center; justify-content: space-between;
    border-radius: 6px; border: 1px solid var(--border); padding: 0.5rem 1rem;
    cursor: pointer; transition: all 0.2s; position: relative;
    font-family: 'JetBrains Mono', monospace;
  }
  .mem-level:hover { border-color: var(--accent); }
  .mem-level .ml-name  { font-size: 0.82rem; font-weight: 700; }
  .mem-level .ml-speed { font-size: 0.68rem; }
  .mem-level .ml-size  { font-size: 0.68rem; text-align: right; }
  .mem-info {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px;
    padding: 0.75rem 1rem; font-size: 0.84rem; color: var(--muted); min-height: 48px;
    transition: all 0.3s; margin-top: 0.5rem; font-family: 'Lato', sans-serif; line-height: 1.6;
  }

  /* ADDRESSING MODE DIAGRAM */
  .addr-diagram {
    display: flex; flex-direction: column; gap: 0.4rem;
    font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; margin: 1rem 0;
  }
  .addr-row { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
  .addr-box {
    padding: 0.35rem 0.7rem; border-radius: 5px; border: 1px solid; font-size: 0.78rem;
    text-align: center; white-space: nowrap;
  }
  .addr-instr { background: rgba(91,141,238,0.15); border-color: var(--accent); color: var(--accent); }
  .addr-reg   { background: rgba(54,201,160,0.15);  border-color: var(--accent3); color: var(--accent3); }
  .addr-mem   { background: rgba(245,166,35,0.15);  border-color: var(--accent4); color: var(--accent4); }
  .addr-op    { background: rgba(201,122,245,0.15); border-color: var(--purple);  color: var(--purple); }
  .addr-arrow { color: var(--muted); font-size: 1rem; }
  .addr-plus  { color: var(--accent2); font-weight: 700; }

  /* MODE TABS */
  .mode-tabs { display: flex; gap: 0.4rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .mode-tab {
    font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;
    padding: 5px 12px; border-radius: 5px; border: 1px solid var(--border);
    background: var(--surface2); color: var(--muted); cursor: pointer; transition: all 0.18s;
  }
  .mode-tab:hover { border-color: var(--accent); color: var(--text); }
  .mode-tab.active { background: rgba(91,141,238,0.18); border-color: var(--accent); color: var(--accent); }

  /* LDR/STR TABLE */
  .instr-badge {
    display: inline-block; font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem; padding: 2px 8px; border-radius: 4px;
    border: 1px solid var(--accent); background: rgba(91,141,238,0.1); color: var(--accent);
    margin: 2px;
  }

  /* LIFE OF PROGRAM */
  .prog-life { display: flex; flex-direction: column; gap: 0; margin: 1rem 0; }
  .prog-step {
    display: flex; align-items: stretch; gap: 0; cursor: pointer;
    transition: all 0.2s;
  }
  .prog-step-left {
    width: 160px; flex-shrink: 0;
    background: var(--surface2); border: 1px solid var(--border);
    padding: 0.6rem 0.9rem; font-family: 'JetBrains Mono', monospace;
    font-size: 0.76rem; display: flex; flex-direction: column; justify-content: center;
    transition: all 0.2s;
  }
  .prog-step:hover .prog-step-left { border-color: var(--accent4); background: rgba(245,166,35,0.08); }
  .prog-step-arrow {
    width: 30px; flex-shrink: 0; display: flex; align-items: center; justify-content: center;
    background: var(--surface2); border-top: 1px solid var(--border); border-bottom: 1px solid var(--border);
    color: var(--accent4); font-size: 1rem;
  }
  .prog-step-right {
    flex: 1; background: var(--code-bg); border: 1px solid var(--border);
    padding: 0.6rem 0.9rem; font-size: 0.78rem; color: var(--muted);
    font-family: 'JetBrains Mono', monospace;
  }
  .prog-step:first-child .prog-step-left,
  .prog-step:first-child .prog-step-arrow,
  .prog-step:first-child .prog-step-right { border-radius: 8px 0 0 0; border-radius: 0; }
  .prog-step:first-child .prog-step-left  { border-radius: 8px 0 0 0; }
  .prog-step:first-child .prog-step-right { border-radius: 0 8px 0 0; }
  .prog-step:last-child  .prog-step-left  { border-radius: 0 0 0 8px; }
  .prog-step:last-child  .prog-step-right { border-radius: 0 0 8px 0; }
  .prog-step-name  { color: var(--accent4); font-weight: 700; margin-bottom: 2px; }
  .prog-step-tool  { color: var(--muted); font-size: 0.65rem; }

  /* QUIZ */
  .quiz-wrap { margin-top: 2.5rem; }
  .quiz-wrap h3 { font-family: 'Syne', sans-serif; font-size: 1rem; margin-bottom: 1rem; color: var(--accent); }
  .quiz-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1.2rem 1.4rem; margin-bottom: 1rem; }
  .quiz-q { font-size: 0.92rem; margin-bottom: 0.75rem; }
  .quiz-opts { display: flex; flex-direction: column; gap: 0.4rem; }
  .quiz-opt {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 6px;
    padding: 0.55rem 0.85rem; cursor: pointer; font-size: 0.88rem; transition: all 0.15s;
    font-family: 'Lato', sans-serif; color: var(--text); text-align: left;
  }
  .quiz-opt:hover { border-color: var(--accent); }
  .quiz-opt:disabled { cursor: default; }
  .quiz-opt.correct { border-color: var(--accent3); background: rgba(54,201,160,0.1); color: var(--accent3); }
  .quiz-opt.wrong   { border-color: var(--accent2); background: rgba(224,92,122,0.1); color: var(--accent2); }
  .quiz-feedback { font-size: 0.83rem; margin-top: 0.6rem; color: var(--muted); font-style: italic; }

  select.viz-input { width: auto; cursor: pointer; }
`,
    body: `<header>
  <div class="chip">INF â€” Assembleur</div>
  <h1>Chapitre 3 â€” <span>L'accÃ¨s aux donnÃ©es</span></h1>
  <p class="subtitle">HiÃ©rarchie mÃ©moire, modes d'adressage, instructions ARM Â· Notes de cours interactives</p>
</header>

<nav class="toc-bar">
  <a class="toc-btn" href="#s1">01 HiÃ©rarchie mÃ©moire</a>
  <a class="toc-btn" href="#s2">02 Types de donnÃ©es</a>
  <a class="toc-btn" href="#s3">03 Les adresses</a>
  <a class="toc-btn" href="#s4">04 Vie d'un programme</a>
  <a class="toc-btn" href="#s5">05 Modes d'adressage</a>
  <a class="toc-btn" href="#s6">06 ARM â€” modes</a>
  <a class="toc-btn" href="#s7">07 LDR / STR</a>
  <a class="toc-btn" href="#s8">08 Instruction MOV</a>
  <a class="toc-btn" href="#quiz">ğŸ§  Quiz</a>
</nav>

<main>

<!-- S1 -->
<div class="section" id="s1">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">01</span>
    <span class="section-title">HiÃ©rarchie des mÃ©moires</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Toute information utilisable par un programme doit transiter par plusieurs niveaux de stockage. Plus on monte dans la hiÃ©rarchie, plus c'est rapide, petit et coÃ»teux. Cliquez sur un niveau pour en savoir plus.</p>

    <div class="viz-tool" style="padding: 1rem;">
      <div class="mem-pyramid" id="mem-pyramid">
        <div class="mem-level" style="width:220px; background:rgba(91,141,238,0.12); border-color:var(--accent);" onclick="showMemInfo('reg')">
          <span class="ml-name" style="color:var(--accent)">Registres</span>
          <span class="ml-speed" style="color:var(--accent3)">~0,3 ns</span>
          <span class="ml-size" style="color:var(--muted)">~1 Ko</span>
        </div>
        <div class="mem-level" style="width:310px; background:rgba(54,201,160,0.08); border-color:var(--accent3);" onclick="showMemInfo('cache')">
          <span class="ml-name" style="color:var(--accent3)">Cache (L1/L2/L3)</span>
          <span class="ml-speed" style="color:var(--accent3)">1â€“10 ns</span>
          <span class="ml-size" style="color:var(--muted)">Ko â†’ Mo</span>
        </div>
        <div class="mem-level" style="width:400px; background:rgba(245,166,35,0.08); border-color:var(--accent4);" onclick="showMemInfo('ram')">
          <span class="ml-name" style="color:var(--accent4)">MÃ©moire centrale (RAM)</span>
          <span class="ml-speed" style="color:var(--accent4)">~100 ns</span>
          <span class="ml-size" style="color:var(--muted)">Go</span>
        </div>
        <div class="mem-level" style="width:490px; background:rgba(224,92,122,0.08); border-color:var(--accent2);" onclick="showMemInfo('disk')">
          <span class="ml-name" style="color:var(--accent2)">Disque / SSD / CD / DVD</span>
          <span class="ml-speed" style="color:var(--accent2)">Î¼s â†’ ms</span>
          <span class="ml-size" style="color:var(--muted)">To</span>
        </div>
      </div>
      <div class="mem-info" id="mem-info">â† Cliquez sur un niveau de la pyramide pour afficher sa description.</div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">RÃ¨gle fondamentale</div>
      Les donnÃ©es en mÃ©moire secondaire (disque, SSDâ€¦) <strong>doivent passer par la mÃ©moire centrale</strong> pour Ãªtre utilisÃ©es. Elles transitent par le <strong>bus</strong>. La mÃ©moire cache accÃ©lÃ¨re les accÃ¨s rÃ©pÃ©tÃ©s Ã  la RAM, mais n'est <strong>pas directement programmable</strong>.
    </div>
  </div>
</div>

<!-- S2 -->
<div class="section" id="s2">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">02</span>
    <span class="section-title">Types de donnÃ©es en mÃ©moire</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Chaque cellule mÃ©moire ne contient que des bits. C'est le <strong>programme</strong> qui dÃ©cide comment les interprÃ©ter. Une mÃªme sÃ©quence de bits peut reprÃ©senter des choses complÃ¨tement diffÃ©rentes.</p>
    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Types possibles</div>
        <div style="font-size:0.88rem; line-height:2.1;">
          âœ¦ <strong>Entier</strong> (signÃ© ou non signÃ©)<br>
          âœ¦ <strong>Nombre virgule flottante</strong><br>
          âœ¦ <strong>CaractÃ¨re</strong> (ASCII, UTF-8â€¦)<br>
          âœ¦ <strong>Bits / chaÃ®nes de bits</strong><br>
          âœ¦ <strong>Adresse</strong> (pointeur)<br>
          âœ¦ <strong>Instruction machine</strong>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Exemple â€” mÃªme octet, 3 interprÃ©tations</div>
        <div style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; line-height:2.2;">
          Bits : <span style="color:var(--accent3)">01000001</span><br>
          â†’ Entier non signÃ© : <span style="color:var(--accent4)">65</span><br>
          â†’ CaractÃ¨re ASCII : <span style="color:var(--accent2)">'A'</span><br>
          â†’ Entier signÃ© : <span style="color:var(--accent)">+65</span>
        </div>
      </div>
    </div>
    <div class="warn-box">
      <div class="box-label label-red">Attention</div>
      Il n'y a <strong>aucune diffÃ©rence intrinsÃ¨que</strong> entre un caractÃ¨re et un nombre en mÃ©moire. La distinction est uniquement faite par le programmeur ou le langage de haut niveau.
    </div>
  </div>
</div>

<!-- S3 -->
<div class="section" id="s3">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">03</span>
    <span class="section-title">Les adresses</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Chaque cellule de mÃ©moire est dÃ©signÃ©e par une <strong>adresse</strong>. Une adresse sur <em>n</em> bits permet d'accÃ©der Ã  2<sup>n</sup> cellules (de l'adresse 0 Ã  2<sup>n</sup>âˆ’1).</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Dans le code source</div>
        <div style="font-size:0.88rem; line-height:2;">
          âœ¦ <strong>Adresse numÃ©rique</strong> â€” valeur entiÃ¨re (rare)<br>
          âœ¦ <strong>Adresse symbolique</strong> â€” Ã©tiquette (label) reprÃ©sentant une adresse
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Adresse effective</div>
        <div style="font-size:0.88rem; line-height:2;">
          Obtenue par transformation d'une adresse initiale :<br>
          âœ¦ Adresse indexÃ©e<br>
          âœ¦ Adresse indirecte<br>
          âœ¦ Adresse relative<br>
          âœ¦ Adresse virtuelle (mÃ©moire virtuelle)
        </div>
      </div>
    </div>

    <div class="viz-tool">
      <h4>ğŸ”§ Calcul d'espace adressable</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Taille de l'adresse (bits) :</label>
        <input class="viz-input" type="number" id="addr-bits" value="64" min="1" max="64" oninput="calcAddrSpace()">
      </div>
      <div class="viz-result" id="addr-result"></div>
    </div>
  </div>
</div>

<!-- S4 -->
<div class="section" id="s4">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">04</span>
    <span class="section-title">Vie d'un programme</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Un programme source passe par plusieurs transformations avant d'Ãªtre exÃ©cutÃ©. Ã€ chaque Ã©tape, les adresses Ã©voluent. Cliquez sur une Ã©tape pour voir les dÃ©tails.</p>

    <div class="prog-life" id="prog-life">
      <div class="prog-step" onclick="showProgStep(0)">
        <div class="prog-step-left">
          <div class="prog-step-name">CrÃ©ation</div>
          <div class="prog-step-tool">Ã‰diteur de texte</div>
        </div>
        <div class="prog-step-arrow">â†’</div>
        <div class="prog-step-right" id="ps-0">Adresses <strong style="color:var(--accent3)">symboliques</strong> (labels), quelques adresses numÃ©riques, modes d'adressage.</div>
      </div>
      <div class="prog-step" onclick="showProgStep(1)">
        <div class="prog-step-left">
          <div class="prog-step-name">Compilation</div>
          <div class="prog-step-tool">Assembleur</div>
        </div>
        <div class="prog-step-arrow">â†’</div>
        <div class="prog-step-right" id="ps-1">Adresses <strong style="color:var(--accent4)">numÃ©riques</strong> dans le code objet, adresses symboliques rÃ©siduelles (rares), modes d'adressage.</div>
      </div>
      <div class="prog-step" onclick="showProgStep(2)">
        <div class="prog-step-left">
          <div class="prog-step-name">Ã‰dition des liens</div>
          <div class="prog-step-tool">Ã‰diteur de liens</div>
        </div>
        <div class="prog-step-arrow">â†’</div>
        <div class="prog-step-right" id="ps-2">RÃ©solution des rÃ©fÃ©rences externes (librairies statiques). Adresses numÃ©riques, modes d'adressage. Module chargeable produit.</div>
      </div>
      <div class="prog-step" onclick="showProgStep(3)">
        <div class="prog-step-left">
          <div class="prog-step-name">Chargement</div>
          <div class="prog-step-tool">Chargeur (loader)</div>
        </div>
        <div class="prog-step-arrow">â†’</div>
        <div class="prog-step-right" id="ps-3">Relocalisation des adresses numÃ©riques. Le programme est placÃ© en mÃ©moire Ã  une adresse de base <code style="color:var(--accent4)">c</code>. Adresses finales = <code>a + l + c</code>.</div>
      </div>
      <div class="prog-step" onclick="showProgStep(4)">
        <div class="prog-step-left">
          <div class="prog-step-name">ExÃ©cution</div>
          <div class="prog-step-tool">Processeur + MMU</div>
        </div>
        <div class="prog-step-arrow">â†’</div>
        <div class="prog-step-right" id="ps-4">Les modes d'adressage sont rÃ©solus en <strong style="color:var(--accent2)">adresses effectives</strong>. L'unitÃ© de gestion mÃ©moire (MMU) traduit les adresses virtuelles en adresses physiques.</div>
      </div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Relocalisation â€” formule</div>
      Adresse finale en mÃ©moire = <code style="color:var(--accent4)">a + l + c</code><br>
      oÃ¹ <code>a</code> = adresse dans le code objet, <code>l</code> = dÃ©calage dans le module chargeable, <code>c</code> = adresse de chargement en mÃ©moire physique.
    </div>
  </div>
</div>

<!-- S5 -->
<div class="section" id="s5">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">05</span>
    <span class="section-title">Modes d'adressage</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Un <strong>mode d'adressage</strong> dÃ©crit comment l'instruction identifie l'opÃ©rande. SÃ©lectionnez un mode pour voir son schÃ©ma et sa description :</p>

    <div class="mode-tabs" id="addr-mode-tabs">
      <button class="mode-tab active" onclick="showMode('imm',this)">ImmÃ©diat</button>
      <button class="mode-tab" onclick="showMode('reg',this)">Registre</button>
      <button class="mode-tab" onclick="showMode('direct',this)">Direct</button>
      <button class="mode-tab" onclick="showMode('indexed',this)">IndexÃ©</button>
      <button class="mode-tab" onclick="showMode('relative',this)">Relatif</button>
      <button class="mode-tab" onclick="showMode('basedisp',this)">Base+DÃ©pl.</button>
      <button class="mode-tab" onclick="showMode('regdeferred',this)">Reg. diffÃ©rÃ©</button>
      <button class="mode-tab" onclick="showMode('indirect',this)">Indirect</button>
      <button class="mode-tab" onclick="showMode('autoinc',this)">Auto-incr.</button>
      <button class="mode-tab" onclick="showMode('autodec',this)">Auto-dÃ©cr.</button>
    </div>

    <div id="mode-display" style="min-height: 200px;"></div>
  </div>
</div>

<!-- S6 -->
<div class="section" id="s6">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">06</span>
    <span class="section-title">Modes d'adressage ARM</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>ARM v8 supporte <strong>7 modes d'adressage</strong> pour accÃ©der aux donnÃ©es. Une contrainte importante : les instructions sont encodÃ©es sur <strong>32 bits</strong>, mais les adresses font <strong>64 bits</strong>.</p>

    <table>
      <thead>
        <tr><th>Mode</th><th>Description</th><th>Exemple ARM</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><strong style="color:var(--accent)">ImmÃ©diat</strong></td>
          <td>OpÃ©rande inclus dans l'instruction (constante â‰¤ 12 bits)</td>
          <td class="mono">mov x0, #42</td>
        </tr>
        <tr>
          <td><strong style="color:var(--accent3)">Registre</strong></td>
          <td>OpÃ©rande dans un registre gÃ©nÃ©ral</td>
          <td class="mono">add x0, x1, x2</td>
        </tr>
        <tr>
          <td><strong style="color:var(--accent4)">Registre diffÃ©rÃ©</strong></td>
          <td>Le registre contient l'<em>adresse</em> de l'opÃ©rande en mÃ©moire</td>
          <td class="mono">ldr x0, [x1]</td>
        </tr>
        <tr>
          <td><strong style="color:var(--purple)">IndexÃ©</strong></td>
          <td>Adresse de base dans un registre + index (registre ou constante)</td>
          <td class="mono">ldr x0, [x1, x2]<br>ldr x0, [x1, #8]</td>
        </tr>
        <tr>
          <td><strong style="color:var(--accent2)">IndexÃ© prÃ©-incrÃ©mentÃ©</strong></td>
          <td>Adresse = base + dÃ©placement, puis base â† adresse calculÃ©e</td>
          <td class="mono">ldr x0, [x1, #8]!</td>
        </tr>
        <tr>
          <td><strong style="color:var(--accent2)">IndexÃ© post-incrÃ©mentÃ©</strong></td>
          <td>Adresse = base, puis base â† base + dÃ©placement</td>
          <td class="mono">ldr x0, [x1], #8</td>
        </tr>
        <tr>
          <td><strong style="color:var(--accent3)">Relatif (PC)</strong></td>
          <td>Adresse = PC + dÃ©placement (Â±1 Mo max, 21 bits)</td>
          <td class="mono">adr x0, label<br>b label</td>
        </tr>
      </tbody>
    </table>

    <div class="highlight-box">
      <div class="box-label label-blue">Pourquoi le mode relatif pour les adresses ?</div>
      Les instructions ARM font 32 bits, mais les adresses font 64 bits â€” impossible de mettre une adresse complÃ¨te dans une instruction. Le mode relatif contourne ce problÃ¨me : on stocke un <strong>dÃ©placement de 21 bits</strong> (Â±1 Mo) par rapport au PC, qui contient dÃ©jÃ  une adresse valide.
    </div>

    <!-- PRE/POST INCREMENT VISUALIZER -->
    <div class="viz-tool">
      <h4>ğŸ”§ PrÃ©-incrÃ©mentation vs Post-incrÃ©mentation</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Adresse de base (x1) :</label>
        <input class="viz-input" type="number" id="inc-base" value="1000" min="0">
        <label style="font-size:0.85rem; color:var(--muted);">DÃ©placement :</label>
        <input class="viz-input" type="number" id="inc-disp" value="8" min="1" style="width:80px;">
        <button class="viz-btn" onclick="renderIncrement()">Calculer</button>
      </div>
      <div id="inc-result"></div>
    </div>
  </div>
</div>

<!-- S7 -->
<div class="section" id="s7">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">07</span>
    <span class="section-title">Instructions LDR et STR</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>ARM utilise un modÃ¨le <strong>load-store</strong> : seules des instructions dÃ©diÃ©es accÃ¨dent Ã  la mÃ©moire. Toutes les autres opÃ©rations travaillent exclusivement sur des registres.</p>

    <p style="color:var(--accent); font-family:'JetBrains Mono',monospace; font-size:0.82rem; margin-bottom:0.3rem;">CHARGEMENT (mÃ©moire â†’ registre)</p>
    <table>
      <thead><tr><th>Instruction</th><th>Taille lue</th><th>Extension</th><th>Bits de poids fort</th></tr></thead>
      <tbody>
        <tr><td class="mono">ldrb</td><td>8 bits (octet)</td><td>Non signÃ©</td><td>56 bits mis Ã  <strong>0</strong></td></tr>
        <tr><td class="mono">ldrsb</td><td>8 bits (octet)</td><td>SignÃ©</td><td>Extension de signe (0 ou 1)</td></tr>
        <tr><td class="mono">ldrh</td><td>16 bits (demi-mot)</td><td>Non signÃ©</td><td>48 bits mis Ã  <strong>0</strong></td></tr>
        <tr><td class="mono">ldrsh</td><td>16 bits (demi-mot)</td><td>SignÃ©</td><td>Extension de signe</td></tr>
        <tr><td class="mono">ldr w0â€“w30</td><td>32 bits (mot)</td><td>Non signÃ©</td><td>32 bits mis Ã  <strong>0</strong></td></tr>
        <tr><td class="mono">ldrsw</td><td>32 bits (mot)</td><td>SignÃ©</td><td>Extension de signe</td></tr>
        <tr><td class="mono">ldr x0â€“x30</td><td>64 bits (mot Ã©tendu)</td><td>â€”</td><td>Registre complet chargÃ©</td></tr>
      </tbody>
    </table>

    <p style="color:var(--accent2); font-family:'JetBrains Mono',monospace; font-size:0.82rem; margin-bottom:0.3rem; margin-top:1rem;">STOCKAGE (registre â†’ mÃ©moire)</p>
    <table>
      <thead><tr><th>Instruction</th><th>Bits copiÃ©s</th><th>Destination</th></tr></thead>
      <tbody>
        <tr><td class="mono">strb</td><td>8 bits de poids faible</td><td>1 octet en mÃ©moire</td></tr>
        <tr><td class="mono">strh</td><td>16 bits de poids faible</td><td>1 demi-mot en mÃ©moire</td></tr>
        <tr><td class="mono">str w0â€“w30</td><td>32 bits de poids faible</td><td>1 mot en mÃ©moire</td></tr>
        <tr><td class="mono">str x0â€“x30</td><td>64 bits</td><td>1 mot Ã©tendu en mÃ©moire</td></tr>
      </tbody>
    </table>

    <!-- SIGN EXTENSION VISUALIZER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Visualiseur d'extension de signe</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Instruction :</label>
        <select class="viz-input" id="ldr-instr" onchange="renderSignExt()">
          <option value="ldrb">ldrb  (8 bits, non signÃ©)</option>
          <option value="ldrsb">ldrsb (8 bits, signÃ©)</option>
          <option value="ldrh">ldrh  (16 bits, non signÃ©)</option>
          <option value="ldrsh">ldrsh (16 bits, signÃ©)</option>
          <option value="ldr32">ldr w (32 bits, non signÃ©)</option>
          <option value="ldrsw">ldrsw (32 bits, signÃ©)</option>
          <option value="ldr64">ldr x (64 bits)</option>
        </select>
        <label style="font-size:0.85rem; color:var(--muted);">Valeur hex :</label>
        <input class="viz-input" type="text" id="ldr-val" value="FF" placeholder="ex: FF" style="width:100px;" oninput="renderSignExt()">
      </div>
      <div id="ldr-result"></div>
    </div>
  </div>
</div>

<!-- S8 -->
<div class="section" id="s8">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">08</span>
    <span class="section-title">L'instruction MOV</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p><code>MOV</code> est une <strong>instruction synthÃ©tique</strong> : l'assembleur la traduit automatiquement en une ou plusieurs instructions machine rÃ©elles selon la valeur de la constante.</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Valeur positive (â‰¤ 12 bits)</div>
        <div style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; line-height:2.1;">
          <code>mov x20, 153</code><br>
          â†“ traduit en<br>
          <span style="color:var(--accent3)">add x20, xzr, 153</span>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">Valeur nÃ©gative</div>
        <div style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; line-height:2.1;">
          <code>mov x20, -153</code><br>
          â†“ traduit en<br>
          <span style="color:var(--accent3)">sub x20, xzr, 153</span>
        </div>
      </div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Valeur dÃ©passant 12 bits â€” dÃ©calage logique</div>
      Pour les grandes constantes, l'assembleur utilise des opÃ©rations binaires.<br><br>
      Exemple : <code>mov x20, 8960</code><br>
      8960 = 35 Ã— 256 = 35 Ã— 2<sup>8</sup><br>
      35 en binaire = <code>100101</code><br>
      8960 en binaire = <code>10010100000000</code> (dÃ©calÃ© de 8 Ã  gauche)<br>
      â†“ traduit en : <span style="color:var(--accent3)">add x20, xzr, 35, lsl 8</span>
    </div>

    <div class="warn-box">
      <div class="box-label label-red">Limitation</div>
      <strong>Toutes les constantes ne peuvent pas Ãªtre gÃ©nÃ©rÃ©es</strong> avec cette technique. Si l'assembleur ne trouve pas de combinaison d'opÃ©rations binaires pour produire la valeur demandÃ©e, il retourne une <strong>erreur</strong>.
    </div>

    <!-- MOV ANALYZER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Analyseur d'instruction MOV</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Constante (dÃ©cimal) :</label>
        <input class="viz-input" type="number" id="mov-val" value="8960" oninput="analyzeMov()">
      </div>
      <div id="mov-result"></div>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="quiz-wrap" id="quiz">
  <h3>ğŸ§  Quiz de rÃ©vision â€” Chapitre 3</h3>

  <div class="quiz-card" id="q1">
    <p class="quiz-q"><strong>Q1.</strong> Dans la hiÃ©rarchie mÃ©moire, quelle unitÃ© est la plus rapide mais aussi la plus coÃ»teuse et la plus petite ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” la mÃ©moire cache est rapide mais reste plus lente et plus grande que les registres.')">MÃ©moire cache (L1)</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q1','Exact ! Les registres sont intÃ©grÃ©s au processeur, accessibles en moins d\\'un cycle. Ils forment le sommet de la hiÃ©rarchie.')">Registres du processeur</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” la RAM est bien plus lente (~100 ns) et bien plus grande que les registres.')">RAM (mÃ©moire centrale)</button>
    </div>
    <p class="quiz-feedback" id="q1-fb"></p>
  </div>

  <div class="quiz-card" id="q2">
    <p class="quiz-q"><strong>Q2.</strong> Quel mode d'adressage utilise le contenu du <strong>PC</strong> comme repÃ¨re pour calculer l'adresse effective ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” le mode indexÃ© utilise un registre gÃ©nÃ©ral comme base, pas le PC.')">Adressage indexÃ©</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” le mode base+dÃ©placement utilise un registre gÃ©nÃ©ral, qui peut Ãªtre n\\'importe quel registre.')">Adressage base et dÃ©placement</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q2','Exact ! En mode relatif, l\\'adresse effective = PC + dÃ©placement. Le dÃ©placement est encodÃ© dans l\\'instruction. TrÃ¨s pratique pour les branchements et les accÃ¨s indÃ©pendants de l\\'emplacement.')">Adressage relatif</button>
    </div>
    <p class="quiz-feedback" id="q2-fb"></p>
  </div>

  <div class="quiz-card" id="q3">
    <p class="quiz-q"><strong>Q3.</strong> On exÃ©cute <code>ldr x0, [x1], #8</code> avec x1 = 1000. Quelle adresse est lue en mÃ©moire, et quelle est la valeur de x1 aprÃ¨s l'exÃ©cution ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” c\\'est le comportement du mode prÃ©-incrÃ©mentÃ© (ldr x0, [x1, #8]!). Ici c\\'est post-incrÃ©mentÃ©.')">Adresse lue : 1008 Â· x1 aprÃ¨s : 1008</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q3','Correct ! En post-incrÃ©mentation, on lit d\\'abord Ã  l\\'adresse actuelle (1000), puis on incrÃ©mente le registre de base (x1 â† 1008).')">Adresse lue : 1000 Â· x1 aprÃ¨s : 1008</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” x1 est bien mis Ã  jour aprÃ¨s l\\'accÃ¨s mÃ©moire. La notation [x1], #8 signifie post-incrÃ©mentation.')">Adresse lue : 1000 Â· x1 aprÃ¨s : 1000 (inchangÃ©)</button>
    </div>
    <p class="quiz-feedback" id="q3-fb"></p>
  </div>

  <div class="quiz-card" id="q4">
    <p class="quiz-q"><strong>Q4.</strong> Quelle instruction ARM chargerait un <strong>octet signÃ©</strong> depuis la mÃ©moire et l'Ã©tendrait correctement sur 64 bits ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” ldrb charge un octet non signÃ© : les 56 bits de poids fort sont mis Ã  0, donc une valeur nÃ©gative comme 0xFF serait lue comme 255 et non -1.')">ldrb</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q4','Exact ! ldrsb charge un octet et effectue une extension de signe : si le bit 7 vaut 1 (valeur nÃ©gative), les 56 bits de poids fort sont mis Ã  1.')">ldrsb</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” ldrh charge un demi-mot (16 bits), pas un octet (8 bits).')">ldrh</button>
    </div>
    <p class="quiz-feedback" id="q4-fb"></p>
  </div>

  <div class="quiz-card" id="q5">
    <p class="quiz-q"><strong>Q5.</strong> Pourquoi ARM utilise-t-il le mode relatif (PC+dÃ©placement) pour charger des adresses plutÃ´t que de mettre l'adresse directement dans l'instruction ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” la performance n\\'est pas la raison principale. C\\'est un problÃ¨me d\\'encodage.')">C'est plus rapide Ã  l'exÃ©cution</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q5','Exact ! Les instructions ARM font 32 bits, mais les adresses font 64 bits â€” impossible de faire tenir une adresse complÃ¨te dans une instruction. Le dÃ©placement relatif (21 bits, Â±1 Mo) rÃ©sout ce problÃ¨me.')">Les instructions font 32 bits mais les adresses font 64 bits â€” une adresse complÃ¨te ne tient pas dans une instruction</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” le mode relatif est justement indÃ©pendant de l\\'emplacement du programme, ce qui est un avantage.')">Pour que le programme soit toujours placÃ© Ã  la mÃªme adresse en mÃ©moire</button>
    </div>
    <p class="quiz-feedback" id="q5-fb"></p>
  </div>

  <div class="quiz-card" id="q6">
    <p class="quiz-q"><strong>Q6.</strong> L'instruction <code>mov x0, 8960</code> est traduite par l'assembleur en <code>add x0, xzr, 35, lsl 8</code>. Pourquoi 35 et 8 ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q6','Non â€” 35 et 8 ne sont pas obtenus par division. Le dÃ©calage Ã  gauche correspond Ã  une multiplication par une puissance de 2.')">8960 Ã· 35 = 8 et 35 est le reste</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q6','Exact ! 8960 = 35 Ã— 2â¸ = 35 Ã— 256. En binaire, dÃ©caler 35 (100101) de 8 positions Ã  gauche donne 10010100000000 = 8960. Le dÃ©calage lsl 8 multiplie par 2â¸.')">8960 = 35 Ã— 2â¸ â€” on dÃ©cale 35 de 8 bits Ã  gauche (multiplication par 256)</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q6','Non â€” 35 est bien la mantisse et 8 le dÃ©calage, mais ce sont des puissances de 2 (binaire), pas des puissances de 10.')">8960 = 35 Ã— 10â¸ en base 10</button>
    </div>
    <p class="quiz-feedback" id="q6-fb"></p>
  </div>

</div>
</main>`,
    script: `// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggle(header) { header.closest('.section').classList.toggle('collapsed'); }
function ans(btn, result, qid, feedback) {
  const card = document.getElementById(qid);
  card.querySelectorAll('.quiz-opt').forEach(o => { o.disabled = true; o.style.opacity = '0.5'; });
  btn.style.opacity = '1'; btn.classList.add(result);
  document.getElementById(qid + '-fb').textContent = (result === 'correct' ? 'âœ… ' : 'âŒ ') + feedback;
}
document.querySelectorAll('.toc-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    e.preventDefault();
    const t = document.querySelector(btn.getAttribute('href'));
    if (t) { t.scrollIntoView({ behavior: 'smooth', block: 'start' }); if (t.classList.contains('collapsed')) t.classList.remove('collapsed'); }
  });
});

// â”€â”€ MEMORY HIERARCHY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const memInfos = {
  reg:   '<strong style="color:var(--accent)">Registres</strong> â€” IntÃ©grÃ©s directement dans le processeur. AccÃ¨s en ~0,3 ns (moins d\\'un cycle). CapacitÃ© totale trÃ¨s limitÃ©e (~quelques Ko). Directement adressables par les instructions. Indispensables pour tout calcul.',
  cache: '<strong style="color:var(--accent3)">MÃ©moire cache</strong> â€” Plusieurs niveaux (L1, L2, L3). Jusqu\\'Ã  10Ã— plus rapide que la RAM. Non directement programmable : c\\'est le matÃ©riel qui dÃ©cide quelles donnÃ©es mettre en cache. AmÃ©liore automatiquement les performances en stockant les donnÃ©es rÃ©cemment utilisÃ©es.',
  ram:   '<strong style="color:var(--accent4)">MÃ©moire centrale (RAM)</strong> â€” Stocke le programme en cours et ses donnÃ©es. Volatile (perdue Ã  l\\'extinction). AccÃ¨s ~100Ã— plus lent que les registres. Le transit RAM â†” registres passe par le bus et les instructions load/store.',
  disk:  '<strong style="color:var(--accent2)">Disque / SSD / CD / DVD</strong> â€” MÃ©moire secondaire, persistante (garde les donnÃ©es sans alimentation). CapacitÃ© trÃ¨s grande (To) Ã  coÃ»t trÃ¨s faible. ExtrÃªmement lent (ms). Les donnÃ©es DOIVENT transiter par la RAM pour Ãªtre traitÃ©es.',
};
function showMemInfo(key) { document.getElementById('mem-info').innerHTML = memInfos[key] || ''; }

// â”€â”€ ADDRESS SPACE CALCULATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcAddrSpace() {
  const n = parseInt(document.getElementById('addr-bits').value);
  const el = document.getElementById('addr-result');
  if (isNaN(n) || n < 1 || n > 64) { el.innerHTML = ''; return; }
  const cells = n < 53 ? Math.pow(2, n) : '2<sup>' + n + '</sup>';
  const maxAddr = n < 53 ? (Math.pow(2, n) - 1).toLocaleString('fr-FR') : '2<sup>' + n + '</sup>âˆ’1';
  let sizeStr = '';
  if (n >= 40) sizeStr = \`â‰ˆ \${(Math.pow(2, n) / Math.pow(2,40)).toFixed(1)} To\`;
  else if (n >= 30) sizeStr = \`â‰ˆ \${(Math.pow(2, n) / Math.pow(2,30)).toFixed(1)} Go\`;
  else if (n >= 20) sizeStr = \`â‰ˆ \${(Math.pow(2, n) / Math.pow(2,20)).toFixed(1)} Mo\`;
  else if (n >= 10) sizeStr = \`â‰ˆ \${(Math.pow(2, n) / Math.pow(2,10)).toFixed(1)} Ko\`;
  else sizeStr = Math.pow(2, n) + ' octets';
  el.innerHTML = \`
    <div class="step"><span class="step-label">Taille de l'adresse :</span><span class="step-val">\${n} bits</span></div>
    <div class="step"><span class="step-label">Nb de cellules adressables :</span><span class="step-val">2<sup>\${n}</sup> = <em>\${n < 53 ? Math.pow(2,n).toLocaleString('fr-FR') : '2^'+n}</em></span></div>
    <div class="step"><span class="step-label">Adresses :</span><span class="step-val">0 Ã  <em>\${maxAddr}</em></span></div>
    <div class="step"><span class="step-label">Espace total (1 octet/cellule) :</span><span class="step-val"><em>\${sizeStr}</em></span></div>\`;
}
calcAddrSpace();

// â”€â”€ PROG LIFE STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showProgStep(idx) {
  // Just highlight â€” content is already visible
  document.querySelectorAll('.prog-step').forEach((s, i) => {
    s.querySelectorAll('.prog-step-left, .prog-step-arrow, .prog-step-right').forEach(el => {
      el.style.background = '';
      el.style.borderColor = '';
    });
    if (i === idx) {
      s.querySelector('.prog-step-left').style.background = 'rgba(245,166,35,0.15)';
      s.querySelector('.prog-step-left').style.borderColor = 'var(--accent4)';
      s.querySelector('.prog-step-right').style.background = 'rgba(245,166,35,0.05)';
    }
  });
}

// â”€â”€ ADDRESSING MODES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const modes = {
  imm: {
    title: 'Adressage immÃ©diat',
    desc: "L'opÃ©rande est directement inclus dans l'instruction. UtilisÃ© pour les <strong>constantes</strong>. En RISC, la valeur est gÃ©nÃ©ralement petite (12 bits max pour ARM).",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-op">OpÃ©rande (valeur)</div>
      </div>
      <div class="addr-row" style="margin-top:0.5rem; color:var(--accent3); font-size:0.78rem;">
        â†³ Pas d'accÃ¨s mÃ©moire nÃ©cessaire â€” la valeur est dans l'instruction elle-mÃªme.
      </div>\`,
    example: 'mov x0, #42   ! x0 â† 42',
  },
  reg: {
    title: 'Adressage par registre',
    desc: "L'opÃ©rande se trouve dans un <strong>registre</strong>. L'instruction contient le numÃ©ro du registre. TrÃ¨s rapide â€” aucun accÃ¨s mÃ©moire. IdÃ©al quand un mÃªme opÃ©rande est utilisÃ© plusieurs fois.",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">NÂ° registre</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-reg">Registre â†’ OpÃ©rande</div>
      </div>\`,
    example: 'add x0, x1, x2   ! x0 â† x1 + x2',
  },
  direct: {
    title: 'Adressage direct',
    desc: "L'instruction contient directement l'<strong>adresse mÃ©moire</strong> de l'opÃ©rande. Simple, mais limitÃ© en RISC car l'adresse complÃ¨te ne tient pas dans une instruction 32 bits.",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">Adresse</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-mem">MÃ©moire[adresse] â†’ OpÃ©rande</div>
      </div>\`,
    example: 'ldr x0, =var   ! x0 â† valeur Ã  l\\'adresse "var"',
  },
  indexed: {
    title: 'Adressage indexÃ©',
    desc: "L'adresse effective = <strong>adresse de base + index</strong>. La base et/ou l'index sont dans des registres. TrÃ¨s utilisÃ© pour parcourir des tableaux.",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">Base</div>
        <div class="addr-box addr-instr">Index</div>
      </div>
      <div class="addr-row" style="margin-top:0.4rem;">
        <div class="addr-box addr-reg">Registre base</div>
        <div class="addr-plus">+</div>
        <div class="addr-box addr-reg">Registre index</div>
        <div class="addr-arrow">=</div>
        <div class="addr-box addr-mem">MÃ©moire[base+index]</div>
      </div>\`,
    example: 'ldr x0, [x1, x2]   ! x0 â† MÃ©moire[x1 + x2]',
  },
  relative: {
    title: 'Adressage relatif',
    desc: "L'adresse effective = <strong>PC + dÃ©placement</strong>. Le dÃ©placement (signÃ©) est encodÃ© dans l'instruction. IndÃ©pendant de l'emplacement du programme en mÃ©moire. En ARM, le dÃ©placement fait 21 bits (Â±1 Mo).",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">DÃ©placement</div>
      </div>
      <div class="addr-row" style="margin-top:0.4rem;">
        <div class="addr-box addr-reg">PC</div>
        <div class="addr-plus">+</div>
        <div class="addr-box addr-instr">DÃ©placement</div>
        <div class="addr-arrow">=</div>
        <div class="addr-box addr-mem">MÃ©moire[PC+dÃ©pl] â†’ OpÃ©rande</div>
      </div>\`,
    example: 'adr x0, label   ! x0 â† adresse de "label"',
  },
  basedisp: {
    title: 'Adressage base + dÃ©placement',
    desc: "L'adresse effective = <strong>contenu d'un registre de base + dÃ©placement</strong> (constante dans l'instruction). Pratique pour accÃ©der Ã  des champs d'une structure ou aux variables locales via le frame pointer.",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">NÂ° registre</div>
        <div class="addr-box addr-instr">DÃ©placement</div>
      </div>
      <div class="addr-row" style="margin-top:0.4rem;">
        <div class="addr-box addr-reg">Registre[base]</div>
        <div class="addr-plus">+</div>
        <div class="addr-box addr-instr">DÃ©placement</div>
        <div class="addr-arrow">=</div>
        <div class="addr-box addr-mem">MÃ©moire[base+dÃ©pl]</div>
      </div>\`,
    example: 'ldr x0, [x1, #8]   ! x0 â† MÃ©moire[x1 + 8]',
  },
  regdeferred: {
    title: 'Adressage par registre diffÃ©rÃ©',
    desc: "Le registre ne contient <strong>pas</strong> l'opÃ©rande mais son <strong>adresse</strong>. On fait un niveau d'indirection supplÃ©mentaire. C'est le mode standard en ARM pour les accÃ¨s mÃ©moire.",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">NÂ° registre</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-reg">Registre â†’ Adresse</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-mem">MÃ©moire[adresse] â†’ OpÃ©rande</div>
      </div>\`,
    example: 'ldr x0, [x1]   ! x0 â† MÃ©moire[x1]',
  },
  indirect: {
    title: 'Adressage indirect',
    desc: "L'instruction contient une adresse qui pointe vers <strong>une autre adresse</strong>, qui elle-mÃªme pointe vers l'opÃ©rande. Double dÃ©rÃ©fÃ©rencement. Peut Ãªtre Ã©tendu Ã  n niveaux d'indirection.",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">Adresse</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-mem">MÃ©moire[adresse] â†’ Adresse2</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-op">MÃ©moire[adresse2] â†’ OpÃ©rande</div>
      </div>\`,
    example: '! Pointeur sur pointeur\\n! ldr x0, [x1]   ; x0 â† adresse2\\n! ldr x0, [x0]   ; x0 â† opÃ©rande',
  },
  autoinc: {
    title: 'Adressage auto-incrÃ©mentÃ©',
    desc: "Le registre contient l'adresse de l'opÃ©rande. <strong>AprÃ¨s</strong> l'accÃ¨s, l'adresse dans le registre est automatiquement incrÃ©mentÃ©e de <em>i</em> octets. TrÃ¨s pratique pour parcourir un tableau.",
    diagram: \`
      <div class="addr-row">
        <div class="addr-box addr-instr">Code Op</div>
        <div class="addr-box addr-instr">NÂ° registre</div>
      </div>
      <div class="addr-row" style="margin-top:0.4rem;">
        <div class="addr-box addr-reg">Registre â†’ Adresse eff.</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-mem">MÃ©moire[adresse]</div>
      </div>
      <div class="addr-row" style="margin-top:0.4rem; color:var(--accent4); font-size:0.78rem;">
        AprÃ¨s : Registre â† Registre + i
      </div>\`,
    example: 'ldr x0, [x1], #8   ! post-incrÃ©mentation : x1 += 8 aprÃ¨s lecture',
  },
  autodec: {
    title: 'Adressage auto-dÃ©crÃ©mentÃ©',
    desc: "L'adresse dans le registre est <strong>dÃ©crÃ©mentÃ©e d'abord</strong>, puis utilisÃ©e pour l'accÃ¨s. Utile pour implÃ©menter une pile (push). L'opÃ©ration inverse de l'auto-incrÃ©mentation.",
    diagram: \`
      <div class="addr-row" style="color:var(--accent4); font-size:0.78rem; margin-bottom:0.4rem;">
        D'abord : Registre â† Registre âˆ’ i
      </div>
      <div class="addr-row">
        <div class="addr-box addr-reg">Registre (mis Ã  jour) â†’ Adresse eff.</div>
        <div class="addr-arrow">â†’</div>
        <div class="addr-box addr-mem">MÃ©moire[adresse]</div>
      </div>\`,
    example: 'str x0, [sp, #-8]!  ! prÃ©-dÃ©crÃ©mentation : sp -= 8 avant Ã©criture',
  },
};

function showMode(key, el) {
  document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
  if (el) el.classList.add('active');
  const m = modes[key];
  document.getElementById('mode-display').innerHTML = \`
    <div class="mini-card" style="margin-bottom:0.75rem;">
      <div class="mc-title">\${m.title}</div>
      <p style="font-size:0.88rem; margin-bottom:0.75rem;">\${m.desc}</p>
      <div class="addr-diagram">\${m.diagram}</div>
    </div>
    <pre><code><span class="cmt">! Exemple ARM</span>
<span class="kw">\${m.example.replace(/\\n/g, '\\n')}</span></code></pre>\`;
}
showMode('imm');

// â”€â”€ PRE/POST INCREMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderIncrement() {
  const base = parseInt(document.getElementById('inc-base').value) || 1000;
  const disp = parseInt(document.getElementById('inc-disp').value) || 8;
  document.getElementById('inc-result').innerHTML = \`
    <div class="viz-result">
      <div class="step" style="margin-bottom:0.5rem; color:var(--accent3); font-size:0.8rem;">ldr x0, [x1, #\${disp}]!  â€” PRÃ‰-incrÃ©mentation</div>
      <div class="step"><span class="step-label">1. x1 â† x1 + \${disp}</span><span class="step-val">x1 = \${base} + \${disp} = <em>\${base+disp}</em></span></div>
      <div class="step"><span class="step-label">2. Adresse lue :</span><span class="step-val"><em>\${base+disp}</em></span></div>
      <div class="step"><span class="step-label">x1 aprÃ¨s :</span><span class="step-val"><em>\${base+disp}</em></span></div>

      <div style="border-top:1px solid var(--border); margin: 0.75rem 0;"></div>

      <div class="step" style="margin-bottom:0.5rem; color:var(--accent4); font-size:0.8rem;">ldr x0, [x1], #\${disp}  â€” POST-incrÃ©mentation</div>
      <div class="step"><span class="step-label">1. Adresse lue :</span><span class="step-val"><em>\${base}</em> (adresse courante)</span></div>
      <div class="step"><span class="step-label">2. x1 â† x1 + \${disp}</span><span class="step-val">x1 = \${base} + \${disp} = <em>\${base+disp}</em></span></div>
      <div class="step"><span class="step-label">x1 aprÃ¨s :</span><span class="step-val"><em>\${base+disp}</em></span></div>
    </div>\`;
}
renderIncrement();

// â”€â”€ SIGN EXTENSION VISUALIZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSignExt() {
  const instr = document.getElementById('ldr-instr').value;
  const raw = document.getElementById('ldr-val').value.replace(/[^0-9a-fA-F]/g,'').toUpperCase();
  const el = document.getElementById('ldr-result');
  if (!raw) { el.innerHTML = ''; return; }

  const configs = {
    ldrb:  { bits: 8,  signed: false },
    ldrsb: { bits: 8,  signed: true  },
    ldrh:  { bits: 16, signed: false },
    ldrsh: { bits: 16, signed: true  },
    ldr32: { bits: 32, signed: false },
    ldrsw: { bits: 32, signed: true  },
    ldr64: { bits: 64, signed: false },
  };
  const cfg = configs[instr];
  const maxHexDigits = cfg.bits / 4;
  const trimmed = raw.slice(-maxHexDigits).padStart(maxHexDigits, '0');
  const val = parseInt(trimmed, 16);
  const signBit = (val >> (cfg.bits - 1)) & 1;
  const isNeg = cfg.signed && signBit === 1;

  let result64;
  if (cfg.bits === 64) {
    result64 = trimmed.padStart(16, '0');
  } else if (!cfg.signed) {
    result64 = trimmed.padStart(16, '0');
  } else {
    result64 = isNeg ? trimmed.padStart(16, 'F') : trimmed.padStart(16, '0');
  }

  const extColor = isNeg ? 'var(--accent2)' : 'var(--muted)';
  const extLen = 16 - maxHexDigits;
  const extHex = result64.slice(0, extLen);
  const dataHex = result64.slice(extLen);

  el.innerHTML = \`<div class="viz-result">
    <div class="step"><span class="step-label">Valeur lue en mÃ©moire (\${cfg.bits} bits) :</span><span class="step-val" style="color:var(--accent3)">0x\${trimmed}</span></div>
    <div class="step"><span class="step-label">Bit de signe (bit \${cfg.bits-1}) :</span><span class="step-val">\${cfg.bits < 64 ? signBit + (cfg.signed ? (isNeg ? ' â†’ extension <strong style="color:var(--accent2)">nÃ©gative</strong>' : ' â†’ extension <strong style="color:var(--muted)">positive</strong>') : ' (ignorÃ©, non signÃ©)') : 'â€”'}</span></div>
    <div class="step"><span class="step-label">RÃ©sultat dans x0 (64 bits) :</span>
      <span class="step-val">
        <span style="color:\${extColor}; font-family:'JetBrains Mono',monospace;">\${extHex}</span><span style="color:var(--accent3); font-family:'JetBrains Mono',monospace;">\${dataHex}</span>
      </span>
    </div>
    <div class="step"><span class="step-label">Extension :</span><span class="step-val">\${extLen > 0 ? (isNeg ? '<span style="color:var(--accent2)">Bits Ã  1 (extension de signe nÃ©gative)</span>' : '<span style="color:var(--muted)">Bits Ã  0</span>') : 'â€” (registre complet)'}</span></div>
  </div>\`;
}
renderSignExt();

// â”€â”€ MOV ANALYZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function analyzeMov() {
  const val = parseInt(document.getElementById('mov-val').value);
  const el = document.getElementById('mov-result');
  if (isNaN(val)) { el.innerHTML = ''; return; }

  const abs = Math.abs(val);
  const sign = val < 0 ? 'nÃ©gative' : 'positive';
  const instr = val < 0 ? 'sub' : 'add';

  let translation = '';
  let note = '';

  if (abs === 0) {
    translation = \`<span style="color:var(--accent3)">mov x0, xzr</span>  <span class="cmt">! ou add x0, xzr, #0</span>\`;
    note = 'Valeur 0 â€” utilisation directe de xzr.';
  } else if (abs <= 4095) {
    translation = \`<span style="color:var(--accent3)">\${instr} x0, xzr, #\${abs}</span>\`;
    note = \`Constante \${sign} â‰¤ 12 bits (â‰¤ 4095). Tient directement dans l'instruction.\`;
  } else {
    // Try to find a shift
    let found = false;
    for (let shift = 1; shift <= 52; shift++) {
      const mantissa = abs >> shift;
      if (mantissa > 0 && mantissa <= 4095 && (mantissa << shift) === abs) {
        translation = \`<span style="color:var(--accent3)">\${instr} x0, xzr, #\${mantissa}, lsl #\${shift}</span>\`;
        note = \`\${abs} = \${mantissa} Ã— 2<sup>\${shift}</sup>. Mantisse \${mantissa} dÃ©calÃ©e de \${shift} bits Ã  gauche.\`;
        found = true;
        break;
      }
    }
    if (!found) {
      translation = \`<span style="color:var(--accent2)">! Traduction complexe ou impossible directement</span>\`;
      note = \`La valeur \${abs} ne peut pas Ãªtre exprimÃ©e simplement comme mantisse Ã— 2â¿ avec mantisse â‰¤ 12 bits. L'assembleur tenterait d'autres combinaisons (movz/movk) ou signalerait une erreur.\`;
    }
  }

  el.innerHTML = \`<div class="viz-result">
    <div class="step"><span class="step-label">Valeur demandÃ©e :</span><span class="step-val">\${val} (\${sign})</span></div>
    <div class="step"><span class="step-label">Valeur absolue :</span><span class="step-val">\${abs} = <em>\${abs.toString(2)}</em>â‚‚</span></div>
    <div class="step"><span class="step-label">Traduction assembleur :</span><span class="step-val">\${translation}</span></div>
    <div class="step"><span class="step-label">Note :</span><span class="step-val" style="color:var(--muted); font-size:0.8rem;">\${note}</span></div>
  </div>\`;
}
analyzeMov();`
  },
  {
    title: `Chapitre 4`,
    subtitle: `ARM v8`,
    desc: `Premier programme ARM v8`,
    accent: `#f5a623`,
    css: `
  :root {
    --bg: #0d0f14;
    --surface: #141720;
    --surface2: #1c2030;
    --border: #252a3a;
    --accent: #5b8dee;
    --accent2: #e05c7a;
    --accent3: #36c9a0;
    --text: #e0e4f0;
    --muted: #7a8099;
    --code-bg: #0a0c11;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
    min-height: 100vh;
  }

  /* HEADER */
  header {
    background: linear-gradient(135deg, #0d1220 0%, #111827 100%);
    border-bottom: 1px solid var(--border);
    padding: 3rem 2rem 2rem;
    position: relative;
    overflow: hidden;
  }
  header::before {
    content: '';
    position: absolute;
    top: -40px; right: -40px;
    width: 300px; height: 300px;
    background: radial-gradient(circle, rgba(91,141,238,0.12) 0%, transparent 70%);
    pointer-events: none;
  }
  .chip {
    display: inline-block;
    background: rgba(91,141,238,0.15);
    border: 1px solid rgba(91,141,238,0.35);
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    padding: 3px 10px;
    border-radius: 4px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 1rem;
  }
  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(1.8rem, 4vw, 3rem);
    font-weight: 800;
    line-height: 1.15;
    margin-bottom: 0.5rem;
  }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 1rem; font-weight: 300; }

  /* PROGRESS / TOC */
  .toc-bar {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0.75rem 2rem;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .toc-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    padding: 4px 12px;
    border-radius: 4px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
  }
  .toc-btn:hover { background: var(--surface2); color: var(--text); border-color: var(--accent); }

  /* MAIN LAYOUT */
  main { max-width: 960px; margin: 0 auto; padding: 2.5rem 1.5rem 5rem; }

  /* SECTIONS */
  .section {
    margin-bottom: 2.5rem;
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    background: var(--surface);
    transition: border-color 0.3s;
  }
  .section:hover { border-color: rgba(91,141,238,0.3); }

  .section-header {
    padding: 1.2rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.9rem;
    cursor: pointer;
    user-select: none;
    background: var(--surface2);
    transition: background 0.2s;
  }
  .section-header:hover { background: #1f2538; }
  .section-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--accent);
    background: rgba(91,141,238,0.1);
    border: 1px solid rgba(91,141,238,0.25);
    border-radius: 4px;
    padding: 2px 7px;
  }
  .section-title {
    font-family: 'Syne', sans-serif;
    font-size: 1.05rem;
    font-weight: 700;
    flex: 1;
  }
  .chevron {
    color: var(--muted);
    font-size: 0.75rem;
    transition: transform 0.25s;
  }
  .section.collapsed .chevron { transform: rotate(-90deg); }
  .section-body { padding: 1.5rem; display: block; }
  .section.collapsed .section-body { display: none; }

  /* CONTENT ELEMENTS */
  p { color: var(--text); font-size: 0.95rem; margin-bottom: 0.75rem; }
  .highlight-box {
    border-left: 3px solid var(--accent);
    background: rgba(91,141,238,0.07);
    border-radius: 0 8px 8px 0;
    padding: 0.9rem 1.2rem;
    margin: 1rem 0;
    font-size: 0.92rem;
  }
  .warn-box {
    border-left: 3px solid var(--accent2);
    background: rgba(224,92,122,0.07);
    border-radius: 0 8px 8px 0;
    padding: 0.9rem 1.2rem;
    margin: 1rem 0;
    font-size: 0.92rem;
  }
  .tip-box {
    border-left: 3px solid var(--accent3);
    background: rgba(54,201,160,0.07);
    border-radius: 0 8px 8px 0;
    padding: 0.9rem 1.2rem;
    margin: 1rem 0;
    font-size: 0.92rem;
  }
  .box-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.35rem;
    font-weight: 700;
  }
  .label-blue { color: var(--accent); }
  .label-red { color: var(--accent2); }
  .label-green { color: var(--accent3); }

  /* CODE BLOCKS */
  pre {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.1rem 1.3rem;
    overflow-x: auto;
    margin: 1rem 0;
    position: relative;
  }
  code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    line-height: 1.8;
    color: #c9d0e8;
  }
  .cmt { color: #636e8c; font-style: italic; }
  .kw { color: var(--accent); }
  .str { color: #e8a87c; }
  .reg { color: var(--accent3); }
  .lbl { color: var(--accent2); }

  /* TABLE */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
    margin: 1rem 0;
  }
  th {
    background: var(--surface2);
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.6rem 0.9rem;
    border: 1px solid var(--border);
    text-align: left;
  }
  td {
    padding: 0.55rem 0.9rem;
    border: 1px solid var(--border);
    color: var(--text);
    vertical-align: middle;
  }
  tr:hover td { background: rgba(255,255,255,0.02); }
  .mono { font-family: 'JetBrains Mono', monospace; color: var(--accent3); font-size: 0.82rem; }

  /* REGISTER TABLE */
  .reg-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.75rem;
    margin: 1rem 0;
  }
  .reg-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
  }
  .reg-card .rname { color: var(--accent3); font-weight: 700; font-size: 0.9rem; }
  .reg-card .rdesc { color: var(--muted); margin-top: 0.25rem; font-family: 'Inter', sans-serif; font-size: 0.8rem; }
  .reg-card.danger { border-color: rgba(224,92,122,0.4); }
  .reg-card.danger .rname { color: var(--accent2); }
  .reg-card.limited { border-color: rgba(255,190,80,0.35); }
  .reg-card.limited .rname { color: #f5a623; }

  /* QUIZ */
  .quiz-wrap { margin-top: 2.5rem; }
  .quiz-wrap h3 {
    font-family: 'Syne', sans-serif;
    font-size: 1rem;
    margin-bottom: 1rem;
    color: var(--accent3);
  }
  .quiz-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.2rem 1.4rem;
    margin-bottom: 1rem;
  }
  .quiz-q { font-size: 0.92rem; margin-bottom: 0.75rem; }
  .quiz-opts { display: flex; flex-direction: column; gap: 0.4rem; }
  .quiz-opt {
    display: flex;
    align-items: center;
    gap: 0.65rem;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.55rem 0.85rem;
    cursor: pointer;
    font-size: 0.88rem;
    transition: all 0.15s;
    font-family: 'Inter', sans-serif;
    color: var(--text);
    text-align: left;
  }
  .quiz-opt:hover { border-color: var(--accent); }
  .quiz-opt.correct { border-color: var(--accent3); background: rgba(54,201,160,0.1); color: var(--accent3); }
  .quiz-opt.wrong { border-color: var(--accent2); background: rgba(224,92,122,0.1); color: var(--accent2); }
  .quiz-feedback { font-size: 0.83rem; margin-top: 0.6rem; color: var(--muted); font-style: italic; }

  /* DIAGRAM */
  .flow {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
    margin: 1rem 0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
  }
  .flow-box {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.4rem 0.75rem;
    color: var(--text);
  }
  .flow-arrow { color: var(--accent); font-size: 1.1rem; }
  .flow-box.accent { border-color: var(--accent); color: var(--accent); }
  .flow-box.green { border-color: var(--accent3); color: var(--accent3); }
`,
    body: `<header>
  <div class="chip">INF â€” Assembleur</div>
  <h1>Chapitre 4 â€” <span>ARM v8</span></h1>
  <p class="subtitle">Tour rapide d'un premier programme ARM v8 Â· Notes de cours interactives</p>
</header>

<nav class="toc-bar">
  <a class="toc-btn" href="#s1">01 ProblÃ¨me</a>
  <a class="toc-btn" href="#s2">02 Analyse</a>
  <a class="toc-btn" href="#s3">03 I/O printf</a>
  <a class="toc-btn" href="#s4">04 I/O scanf</a>
  <a class="toc-btn" href="#s5">05 Formats</a>
  <a class="toc-btn" href="#s6">06 Sections</a>
  <a class="toc-btn" href="#s7">07 Commentaires</a>
  <a class="toc-btn" href="#s8">08 Pseudo-instr.</a>
  <a class="toc-btn" href="#s9">09 Solution complÃ¨te</a>
  <a class="toc-btn" href="#s10">10 Normes</a>
  <a class="toc-btn" href="#quiz">ğŸ§  Quiz</a>
</nav>

<main>

<!-- SECTION 1 -->
<div class="section" id="s1">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">01</span>
    <span class="section-title">ProblÃ¨me â€” Rectangle dans le plan cartÃ©sien</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Ã‰tant donnÃ©s les coordonnÃ©es de deux sommets <strong>diamÃ©tralement opposÃ©s</strong> d'un rectangle (cÃ´tÃ©s parallÃ¨les aux axes), calculer le <strong>pÃ©rimÃ¨tre</strong> et la <strong>surface</strong>.</p>
    <div class="highlight-box">
      <div class="box-label label-blue">Objectif</div>
      Illustrer la structure complÃ¨te d'un programme ARM v8 : lecture d'entrÃ©es, calcul, affichage, et conventions de code.
    </div>
  </div>
</div>

<!-- SECTION 2 -->
<div class="section" id="s2">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">02</span>
    <span class="section-title">Analyse-Conception</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <table>
      <tr><th>CatÃ©gorie</th><th>Variable</th><th>Description</th></tr>
      <tr><td>EntrÃ©e</td><td class="mono">X1, Y1</td><td>CoordonnÃ©es du 1er sommet</td></tr>
      <tr><td>EntrÃ©e</td><td class="mono">X2, Y2</td><td>CoordonnÃ©es du 2e sommet</td></tr>
      <tr><td>IntermÃ©diaire</td><td class="mono">Base</td><td>|X2 âˆ’ X1|</td></tr>
      <tr><td>IntermÃ©diaire</td><td class="mono">Hauteur</td><td>|Y2 âˆ’ Y1|</td></tr>
      <tr><td>Sortie</td><td class="mono">PÃ©rimÃ¨tre</td><td>2 Ã— (Base + Hauteur)</td></tr>
      <tr><td>Sortie</td><td class="mono">Surface</td><td>Base Ã— Hauteur</td></tr>
    </table>
    <div class="flow">
      <div class="flow-box">(X1,Y1) (X2,Y2)</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-box">Base & Hauteur</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-box accent">PÃ©rimÃ¨tre</div>
      <div class="flow-arrow">+</div>
      <div class="flow-box green">Surface</div>
    </div>
  </div>
</div>

<!-- SECTION 3 -->
<div class="section" id="s3">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">03</span>
    <span class="section-title">EntrÃ©es/Sorties â€” printf</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>On utilise la fonction C <code>printf</code> depuis l'assembleur. La convention d'appel ARM passe les arguments dans les registres <code>x0</code>â€“<code>x7</code>.</p>
    <div class="highlight-box">
      <div class="box-label label-blue">Convention d'appel printf</div>
      <strong>x0</strong> = adresse du format (chaÃ®ne) Â· <strong>x1</strong> = 1er argument Â· <strong>x2</strong> = 2e argumentâ€¦
    </div>
    <pre><code><span class="kw">adr</span>   <span class="reg">x0</span>, format      <span class="cmt">// Param 1 : adresse du format</span>
<span class="kw">mov</span>   <span class="reg">x1</span>, <span class="reg">x20</span>         <span class="cmt">// Param 2 : 1Ã¨re valeur Ã  afficher</span>
<span class="kw">mov</span>   <span class="reg">x2</span>, <span class="reg">x21</span>         <span class="cmt">// Param 3 : 2e valeur Ã  afficher</span>
<span class="kw">bl</span>    printf          <span class="cmt">// Appel de printf</span>

<span class="lbl">format:</span>  <span class="kw">.asciz</span> <span class="str">"Valeur de 2 nombres: %d %d "</span></code></pre>
    <div class="tip-box">
      <div class="box-label label-green">Rappel C</div>
      <code>printf("Allo, je m'appelle %s et j'ai %u ans", nom, age);</code>
    </div>
  </div>
</div>

<!-- SECTION 4 -->
<div class="section" id="s4">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">04</span>
    <span class="section-title">EntrÃ©es/Sorties â€” scanf</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p><code>scanf</code> lit une valeur et l'Ã©crit Ã  une <strong>adresse mÃ©moire</strong> passÃ©e en paramÃ¨tre.</p>
    <div class="highlight-box">
      <div class="box-label label-blue">Convention d'appel scanf</div>
      <strong>x0</strong> = adresse du format Â· <strong>x1</strong> = adresse oÃ¹ stocker la valeur lue
    </div>
    <pre><code><span class="kw">adr</span>   <span class="reg">x0</span>, format    <span class="cmt">// Param 1 : adresse du format</span>
<span class="kw">adr</span>   <span class="reg">x1</span>, var       <span class="cmt">// Param 2 : adresse de la variable</span>
<span class="kw">bl</span>    scanf         <span class="cmt">// Appel de scanf</span>

<span class="lbl">format:</span> <span class="kw">.asciz</span> <span class="str">"%u"</span>
<span class="lbl">var:</span>
        <span class="kw">.align</span> 4
        <span class="kw">.skip</span>  4</code></pre>
    <div class="warn-box">
      <div class="box-label label-red">DiffÃ©rence clÃ© vs printf</div>
      printf reÃ§oit la <em>valeur</em> ; scanf reÃ§oit l'<em>adresse</em> (&amp;variable en C â†” <code>adr x1, var</code> en ASM).
    </div>
  </div>
</div>

<!-- SECTION 5 -->
<div class="section" id="s5">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">05</span>
    <span class="section-title">Formats printf/scanf</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Les mÃªmes codes de format s'utilisent pour la lecture et l'Ã©criture.</p>
    <table>
      <tr><th>Format</th><th>Type</th><th>Lecture (scanf)</th><th>Ã‰criture (printf)</th></tr>
      <tr><td class="mono">%c</td><td>CaractÃ¨re</td><td>Code ASCII â†’ char</td><td>Code ASCII â†’ char</td></tr>
      <tr><td class="mono">%s</td><td>ChaÃ®ne</td><td>Suite de codes ASCII</td><td>Suite de codes ASCII</td></tr>
      <tr><td class="mono">%d</td><td>Entier signÃ©</td><td>DÃ©cimal â†’ binaire</td><td>Binaire â†’ dÃ©cimal</td></tr>
      <tr><td class="mono">%u</td><td>Entier non signÃ©</td><td>DÃ©cimal â†’ binaire</td><td>Binaire â†’ dÃ©cimal</td></tr>
      <tr><td class="mono">%o</td><td>Octal</td><td>Octal â†’ binaire</td><td>Binaire â†’ octal</td></tr>
      <tr><td class="mono">%x</td><td>HexadÃ©cimal</td><td>Hex â†’ binaire</td><td>Binaire â†’ hex</td></tr>
      <tr><td class="mono">%f</td><td>Virgule flottante</td><td>DÃ©cimal â†’ binaire IEEE</td><td>Binaire IEEE â†’ dÃ©cimal</td></tr>
    </table>
  </div>
</div>

<!-- SECTION 6 -->
<div class="section" id="s6">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">06</span>
    <span class="section-title">Sections du programme</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <table>
      <tr><th>Section</th><th>Usage</th><th>AccÃ¨s</th></tr>
      <tr><td class="mono">.text</td><td>Instructions (code)</td><td>Lecture seulement</td></tr>
      <tr><td class="mono">.rodata</td><td>Constantes (formats, chaÃ®nes)</td><td>Lecture seulement</td></tr>
      <tr><td class="mono">.data</td><td>DonnÃ©es initialisÃ©es</td><td>Lecture / Ã‰criture</td></tr>
      <tr><td class="mono">.bss</td><td>DonnÃ©es <em>non</em> initialisÃ©es (variables)</td><td>Lecture / Ã‰criture</td></tr>
    </table>
    <div class="tip-box">
      <div class="box-label label-green">Astuce mÃ©mo</div>
      Les chaÃ®nes de format vont dans <code>.rodata</code> ; les variables lues au clavier vont dans <code>.bss</code>.
    </div>
  </div>
</div>

<!-- SECTION 7 -->
<div class="section" id="s7">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">07</span>
    <span class="section-title">Commentaires</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <pre><code><span class="cmt">/* Commentaire
   multi-lignes */</span>

<span class="cmt">// Commentaire sur une seule ligne</span></code></pre>
    <p>Les deux styles (comme en C/C++/Java) sont supportÃ©s. Le cours recommande de commenter <strong>le plus possible</strong> aprÃ¨s chaque instruction.</p>
  </div>
</div>

<!-- SECTION 8 -->
<div class="section" id="s8">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">08</span>
    <span class="section-title">Pseudo-instructions</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Les pseudo-instructions guident l'assembleur (elles commencent par <code>.</code>). Elles ne gÃ©nÃ¨rent pas directement du code machine.</p>
    <table>
      <tr><th>Pseudo-instr.</th><th>RÃ´le</th></tr>
      <tr><td class="mono">.align 2 / 4 / 8</td><td>Aligner sur frontiÃ¨re 2/4/8 octets</td></tr>
      <tr><td class="mono">.skip N</td><td>RÃ©server N octets (non initialisÃ©s)</td></tr>
      <tr><td class="mono">.ascii "..."</td><td>ChaÃ®ne sans null-terminateur automatique</td></tr>
      <tr><td class="mono">.asciz "..."</td><td>ChaÃ®ne <strong>avec</strong> null-terminateur ('\\0')</td></tr>
      <tr><td class="mono">.byte n</td><td>1 octet initialisÃ© Ã  n</td></tr>
      <tr><td class="mono">.half n</td><td>Demi-mot (2 octets) initialisÃ© Ã  n</td></tr>
      <tr><td class="mono">.word n</td><td>Mot (4 octets) initialisÃ© Ã  n</td></tr>
      <tr><td class="mono">.single n</td><td>Flottant simple prÃ©cision (4 octets)</td></tr>
      <tr><td class="mono">.double n</td><td>Flottant double prÃ©cision (8 octets)</td></tr>
    </table>
    <div class="highlight-box">
      <div class="box-label label-blue">Exemple .skip</div>
      <code>.skip 4*4</code> â†’ rÃ©serve 16 octets (4 mots) pour X1, Y1, X2, Y2
    </div>
  </div>
</div>

<!-- SECTION 9 -->
<div class="section" id="s9">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">09</span>
    <span class="section-title">Solution complÃ¨te â€” Rectangle</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p style="color:var(--muted); font-size:0.88rem; margin-bottom:0.5rem;">Phase 1 â€” Lecture des coordonnÃ©es</p>
    <pre><code><span class="lbl">Rectangle:</span>
    <span class="kw">SAVE</span>                          <span class="cmt">// Sauvegarde l'environnement de l'appelant</span>
    <span class="kw">adr</span>  <span class="reg">x19</span>, points             <span class="cmt">// Adresse du tableau points</span>
    <span class="kw">mov</span>  <span class="reg">x20</span>, 2                  <span class="cmt">// Compteur : 2 points Ã  lire</span>

<span class="lbl">rect00:</span>
    <span class="kw">adr</span>  <span class="reg">x0</span>, ptfmt1              <span class="cmt">// Format "Entrez X du point %u"</span>
    <span class="kw">mov</span>  <span class="reg">x1</span>, 3
    <span class="kw">sub</span>  <span class="reg">x1</span>, <span class="reg">x1</span>, <span class="reg">x20</span>           <span class="cmt">// NumÃ©ro du point (1 ou 2)</span>
    <span class="kw">bl</span>   printf
    <span class="kw">adr</span>  <span class="reg">x0</span>, scfmt1
    <span class="kw">mov</span>  <span class="reg">x1</span>, <span class="reg">x19</span>               <span class="cmt">// Adresse oÃ¹ stocker X</span>
    <span class="kw">bl</span>   scanf
    <span class="kw">add</span>  <span class="reg">x19</span>, <span class="reg">x19</span>, 4           <span class="cmt">// Avancer au prochain mot</span>

    <span class="cmt">// ... (mÃªme chose pour Y) ...</span>

    <span class="kw">sub</span>  <span class="reg">x20</span>, <span class="reg">x20</span>, 1           <span class="cmt">// DÃ©crÃ©mente compteur</span>
    <span class="kw">cmp</span>  <span class="reg">x20</span>, 0
    <span class="kw">b.gt</span> rect00                 <span class="cmt">// Boucle si x20 > 0</span></code></pre>

    <p style="color:var(--muted); font-size:0.88rem; margin: 1rem 0 0.5rem;">Phase 2 â€” Calcul et affichage</p>
    <pre><code>    <span class="kw">adr</span>   <span class="reg">x19</span>, points
    <span class="kw">ldrsw</span> <span class="reg">x20</span>, [<span class="reg">x19</span>]           <span class="cmt">// X1</span>
    <span class="kw">ldrsw</span> <span class="reg">x21</span>, [<span class="reg">x19</span>, 4]         <span class="cmt">// Y1</span>
    <span class="kw">ldrsw</span> <span class="reg">x22</span>, [<span class="reg">x19</span>, 8]         <span class="cmt">// X2</span>
    <span class="kw">ldrsw</span> <span class="reg">x23</span>, [<span class="reg">x19</span>, 12]        <span class="cmt">// Y2</span>

    <span class="kw">subs</span>  <span class="reg">x24</span>, <span class="reg">x22</span>, <span class="reg">x20</span>         <span class="cmt">// Base = X2-X1</span>
    <span class="kw">b.gt</span>  rect10
    <span class="kw">neg</span>   <span class="reg">x24</span>, <span class="reg">x24</span>              <span class="cmt">// Valeur absolue</span>
<span class="lbl">rect10:</span>
    <span class="kw">subs</span>  <span class="reg">x25</span>, <span class="reg">x23</span>, <span class="reg">x21</span>         <span class="cmt">// Hauteur = Y2-Y1</span>
    <span class="kw">b.gt</span>  rect20
    <span class="kw">neg</span>   <span class="reg">x25</span>, <span class="reg">x25</span>              <span class="cmt">// Valeur absolue</span>
<span class="lbl">rect20:</span>
    <span class="kw">mul</span>   <span class="reg">x26</span>, <span class="reg">x24</span>, <span class="reg">x25</span>         <span class="cmt">// Aire = Base Ã— Hauteur</span>
    <span class="kw">add</span>   <span class="reg">x24</span>, <span class="reg">x24</span>, <span class="reg">x25</span>         <span class="cmt">// Base + Hauteur</span>
    <span class="kw">add</span>   <span class="reg">x24</span>, <span class="reg">x24</span>, <span class="reg">x24</span>         <span class="cmt">// Ã— 2 = PÃ©rimÃ¨tre</span>

    <span class="kw">adr</span>   <span class="reg">x0</span>, ptfmt3
    <span class="kw">mov</span>   <span class="reg">x1</span>, <span class="reg">x24</span>               <span class="cmt">// PÃ©rimÃ¨tre</span>
    <span class="kw">mov</span>   <span class="reg">x2</span>, <span class="reg">x26</span>               <span class="cmt">// Aire</span>
    <span class="kw">bl</span>    printf

    <span class="kw">mov</span>   <span class="reg">x0</span>, 0
    <span class="kw">bl</span>    exit</code></pre>
  </div>
</div>

<!-- SECTION 10 -->
<div class="section" id="s10">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">10</span>
    <span class="section-title">Normes de programmation</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p><strong>Format d'une ligne</strong> : 4 colonnes alignÃ©es :</p>
    <pre><code><span class="cmt">// Ã‰tiquette  |  MnÃ©monique  |  OpÃ©randes  |  Commentaires</span>
<span class="lbl">rect00:</span>
             <span class="kw">add</span>    <span class="reg">x19</span>, <span class="reg">x19</span>, 4     <span class="cmt">// Avancer au prochain octet</span></code></pre>

    <p style="margin-top:1rem;"><strong>Registres</strong> :</p>
    <div class="reg-grid">
      <div class="reg-card">
        <div class="rname">x19 â€“ x28</div>
        <div class="rdesc">âœ… Usage libre, intensif</div>
      </div>
      <div class="reg-card limited">
        <div class="rname">x0 â€“ x7</div>
        <div class="rdesc">âš ï¸ ParamÃ¨tres et retours seulement</div>
      </div>
      <div class="reg-card limited">
        <div class="rname">x9 â€“ x15</div>
        <div class="rdesc">âš ï¸ Ã€ Ã©viter le plus possible</div>
      </div>
      <div class="reg-card danger">
        <div class="rname">x16,x17,x18, x29,x30</div>
        <div class="rdesc">ğŸš« Ne pas utiliser</div>
      </div>
    </div>

    <div class="highlight-box" style="margin-top:1rem;">
      <div class="box-label label-blue">Conventions Ã©tiquettes</div>
      <ul style="list-style:none; line-height:2;">
        <li>â€¢ Seule sur sa ligne (pour code) / mÃªme ligne (pour donnÃ©es)</li>
        <li>â€¢ Nom significatif pour les donnÃ©es</li>
        <li>â€¢ Code : 3-4 lettres du point d'entrÃ©e + numÃ©ro croissant (<code>rect00</code>, <code>rect10</code>â€¦)</li>
        <li>â€¢ Les numÃ©ros croissants reflÃ¨tent l'ordre d'exÃ©cution</li>
      </ul>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="quiz-wrap" id="quiz">
  <h3>ğŸ§  Quiz de rÃ©vision â€” Chapitre 4</h3>

  <div class="quiz-card" id="q1">
    <p class="quiz-q"><strong>Q1.</strong> Pour appeler <code>scanf</code> en ARM, que place-t-on dans <code>x1</code> ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="answer(this,'wrong','q1','La valeur Ã  lire directement.')">La valeur Ã  lire directement</button>
      <button class="quiz-opt" onclick="answer(this,'correct','q1','Oui ! scanf a besoin de l\\'adresse mÃ©moire pour y Ã©crire le rÃ©sultat.')">L'adresse mÃ©moire de la variable</button>
      <button class="quiz-opt" onclick="answer(this,'wrong','q1','Non â€” le format va dans x0.')">L'adresse du format</button>
    </div>
    <p class="quiz-feedback" id="q1-fb"></p>
  </div>

  <div class="quiz-card" id="q2">
    <p class="quiz-q"><strong>Q2.</strong> Quelle section utilise-t-on pour les chaÃ®nes de format (constantes) ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="answer(this,'wrong','q2','.data est pour les donnÃ©es initialisÃ©es modifiables.')">.data</button>
      <button class="quiz-opt" onclick="answer(this,'correct','q2','Correct ! .rodata = Read-Only Data. Les constantes y vivent.')">.rodata</button>
      <button class="quiz-opt" onclick="answer(this,'wrong','q2','.bss est rÃ©servÃ© aux variables non initialisÃ©es.')">.bss</button>
      <button class="quiz-opt" onclick="answer(this,'wrong','q2','.text contient les instructions, pas les donnÃ©es.')">.text</button>
    </div>
    <p class="quiz-feedback" id="q2-fb"></p>
  </div>

  <div class="quiz-card" id="q3">
    <p class="quiz-q"><strong>Q3.</strong> Quelle est la diffÃ©rence entre <code>.ascii</code> et <code>.asciz</code> ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="answer(this,'wrong','q3','Non â€” les deux stockent des chaines de caracteres.')"><code>.ascii</code> stocke des entiers, <code>.asciz</code> des chaÃ®nes</button>
      <button class="quiz-opt" onclick="answer(this,'correct','q3','Exactement ! Le z dans .asciz signifie null-termine (zero final).')"><code>.asciz</code> ajoute automatiquement un caractÃ¨re nul final (' ')</button>
      <button class="quiz-opt" onclick="answer(this,'wrong','q3','Non, les deux peuvent contenir nimporte quelle chaine.')"><code>.ascii</code> est pour le franÃ§ais, <code>.asciz</code> pour l'anglais</button>
    </div>
    <p class="quiz-feedback" id="q3-fb"></p>
  </div>

  <div class="quiz-card" id="q4">
    <p class="quiz-q"><strong>Q4.</strong> Quels registres peut-on utiliser librement et intensivement ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="answer(this,'wrong','q4','x0â€“x7 sont rÃ©servÃ©s aux paramÃ¨tres et retours de fonctions.')">x0 â€“ x7</button>
      <button class="quiz-opt" onclick="answer(this,'wrong','q4','x9â€“x15 sont Ã  Ã©viter le plus possible.')">x9 â€“ x15</button>
      <button class="quiz-opt" onclick="answer(this,'correct','q4','Oui ! x19â€“x28 sont les registres de travail Ã  usage intensif.')">x19 â€“ x28</button>
      <button class="quiz-opt" onclick="answer(this,'wrong','q4','x29 et x30 ne doivent pas Ãªtre utilisÃ©s.')">x29 â€“ x30</button>
    </div>
    <p class="quiz-feedback" id="q4-fb"></p>
  </div>

</div>

</main>`,
    script: `function toggle(header) {
    const section = header.closest('.section');
    section.classList.toggle('collapsed');
  }

  function answer(btn, result, qid, feedback) {
    const card = document.getElementById(qid);
    const opts = card.querySelectorAll('.quiz-opt');
    opts.forEach(o => { o.disabled = true; o.style.opacity = '0.5'; });
    btn.style.opacity = '1';
    btn.classList.add(result);
    document.getElementById(qid + '-fb').textContent = (result === 'correct' ? 'âœ… ' : 'âŒ ') + feedback;
  }

  // Smooth scroll for TOC
  document.querySelectorAll('.toc-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();
      const target = document.querySelector(btn.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        if (target.classList.contains('collapsed')) {
          target.classList.remove('collapsed');
        }
      }
    });
  });`
  },
  {
    title: `Chapitre 5`,
    subtitle: `Les nombres entiers`,
    desc: `ReprÃ©sentation, arithmÃ©tique`,
    accent: `#c97af5`,
    css: `
  :root {
    --bg: #0d0f14;
    --surface: #141720;
    --surface2: #1c2030;
    --border: #252a3a;
    --accent: #5b8dee;
    --accent2: #e05c7a;
    --accent3: #36c9a0;
    --accent4: #f5a623;
    --text: #e0e4f0;
    --muted: #7a8099;
    --code-bg: #0a0c11;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Lato', sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; }

  header {
    background: linear-gradient(135deg, #0d1220 0%, #111827 100%);
    border-bottom: 1px solid var(--border);
    padding: 3rem 2rem 2rem;
    position: relative; overflow: hidden;
  }
  header::before {
    content: ''; position: absolute; top: -60px; right: -60px;
    width: 350px; height: 350px;
    background: radial-gradient(circle, rgba(54,201,160,0.1) 0%, transparent 70%);
    pointer-events: none;
  }
  .chip {
    display: inline-block;
    background: rgba(54,201,160,0.12);
    border: 1px solid rgba(54,201,160,0.3);
    color: var(--accent3);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem; padding: 3px 10px; border-radius: 4px;
    letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 1rem;
  }
  h1 { font-family: 'Syne', sans-serif; font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 800; line-height: 1.15; margin-bottom: 0.5rem; }
  h1 span { color: var(--accent3); }
  .subtitle { color: var(--muted); font-size: 1rem; font-weight: 300; }

  .toc-bar {
    background: var(--surface); border-bottom: 1px solid var(--border);
    padding: 0.75rem 2rem; display: flex; gap: 0.5rem; flex-wrap: wrap;
    position: sticky; top: 0; z-index: 100;
  }
  .toc-btn {
    font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
    padding: 4px 12px; border-radius: 4px; border: 1px solid var(--border);
    background: transparent; color: var(--muted); cursor: pointer;
    transition: all 0.2s; text-decoration: none;
  }
  .toc-btn:hover { background: var(--surface2); color: var(--text); border-color: var(--accent3); }

  main { max-width: 980px; margin: 0 auto; padding: 2.5rem 1.5rem 5rem; }

  .section {
    margin-bottom: 2rem; border: 1px solid var(--border); border-radius: 12px;
    overflow: hidden; background: var(--surface); transition: border-color 0.3s;
  }
  .section:hover { border-color: rgba(54,201,160,0.25); }
  .section-header {
    padding: 1.1rem 1.5rem; display: flex; align-items: center; gap: 0.9rem;
    cursor: pointer; user-select: none; background: var(--surface2); transition: background 0.2s;
  }
  .section-header:hover { background: #1f2538; }
  .section-num {
    font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--accent3);
    background: rgba(54,201,160,0.1); border: 1px solid rgba(54,201,160,0.25);
    border-radius: 4px; padding: 2px 7px;
  }
  .section-title { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700; flex: 1; }
  .chevron { color: var(--muted); font-size: 0.75rem; transition: transform 0.25s; }
  .section.collapsed .chevron { transform: rotate(-90deg); }
  .section-body { padding: 1.5rem; }
  .section.collapsed .section-body { display: none; }

  p { font-size: 0.94rem; margin-bottom: 0.75rem; }

  .highlight-box { border-left: 3px solid var(--accent); background: rgba(91,141,238,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .warn-box { border-left: 3px solid var(--accent2); background: rgba(224,92,122,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .tip-box { border-left: 3px solid var(--accent3); background: rgba(54,201,160,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .box-label { font-family: 'JetBrains Mono', monospace; font-size: 0.63rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.35rem; font-weight: 700; }
  .label-blue { color: var(--accent); } .label-red { color: var(--accent2); } .label-green { color: var(--accent3); } .label-orange { color: var(--accent4); }

  pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px; padding: 1rem 1.2rem; overflow-x: auto; margin: 1rem 0; }
  code { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; line-height: 1.85; color: #c9d0e8; }
  .cmt { color: #636e8c; font-style: italic; }
  .kw { color: var(--accent); } .reg { color: var(--accent3); } .lbl { color: var(--accent2); }
  .num { color: var(--accent4); }

  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; margin: 1rem 0; }
  th { background: var(--surface2); color: var(--accent3); font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.07em; padding: 0.6rem 0.9rem; border: 1px solid var(--border); text-align: left; }
  td { padding: 0.55rem 0.9rem; border: 1px solid var(--border); vertical-align: middle; }
  tr:hover td { background: rgba(255,255,255,0.02); }
  .mono { font-family: 'JetBrains Mono', monospace; color: var(--accent3); font-size: 0.82rem; }
  .pos { color: var(--accent3); } .neg { color: var(--accent2); }

  /* BIT DISPLAY */
  .bits { display: flex; gap: 3px; font-family: 'JetBrains Mono', monospace; font-size: 0.88rem; margin: 0.4rem 0; flex-wrap: wrap; }
  .bit {
    width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
    border-radius: 4px; border: 1px solid var(--border); background: var(--surface2);
    font-weight: 600; transition: all 0.2s;
  }
  .bit.one { background: rgba(54,201,160,0.2); border-color: var(--accent3); color: var(--accent3); }
  .bit.zero { background: var(--surface2); color: var(--muted); }
  .bit.sign { background: rgba(224,92,122,0.2); border-color: var(--accent2); color: var(--accent2); }
  .bit-label { font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; color: var(--muted); text-align: center; width: 28px; }
  .bits-wrap { margin: 0.75rem 0; }
  .bits-row { display: flex; gap: 3px; align-items: center; margin-bottom: 2px; }
  .bits-desc { font-size: 0.82rem; color: var(--muted); margin-left: 0.5rem; }

  /* TWO'S COMPLEMENT INTERACTIVE */
  .tc-tool {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 10px;
    padding: 1.4rem; margin: 1rem 0;
  }
  .tc-tool h4 { font-family: 'Syne', sans-serif; font-size: 0.95rem; margin-bottom: 1rem; color: var(--accent3); }
  .tc-input-row { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .tc-input {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px;
    color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 1rem;
    padding: 0.5rem 0.75rem; width: 100px; outline: none;
    transition: border-color 0.2s;
  }
  .tc-input:focus { border-color: var(--accent3); }
  .tc-btn {
    background: rgba(54,201,160,0.15); border: 1px solid rgba(54,201,160,0.35);
    color: var(--accent3); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
    padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
  }
  .tc-btn:hover { background: rgba(54,201,160,0.25); }
  .tc-result { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; line-height: 2; }
  .tc-step { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.4rem; }
  .tc-step-label { color: var(--muted); min-width: 160px; font-size: 0.78rem; }
  .tc-step-val { color: var(--text); }
  .tc-step-val .h { color: var(--accent3); }

  /* FLAGS */
  .flags-row { display: flex; gap: 0.75rem; flex-wrap: wrap; margin: 1rem 0; }
  .flag-card {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; padding: 0.75rem 1.1rem; flex: 1; min-width: 120px;
  }
  .flag-name { font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; font-weight: 700; color: var(--accent4); }
  .flag-desc { font-size: 0.8rem; color: var(--muted); margin-top: 0.2rem; }

  /* MULT SIMULATOR */
  .mult-sim {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 10px;
    padding: 1.4rem; margin: 1rem 0;
  }
  .mult-sim h4 { font-family: 'Syne', sans-serif; font-size: 0.95rem; margin-bottom: 1rem; color: var(--accent4); }
  .mult-row { display: flex; gap: 0.6rem; align-items: center; flex-wrap: wrap; margin-bottom: 0.75rem; }
  .mult-input {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px;
    color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 1rem;
    padding: 0.45rem 0.65rem; width: 80px; outline: none; transition: border-color 0.2s;
  }
  .mult-input:focus { border-color: var(--accent4); }
  .mult-btn {
    background: rgba(245,166,35,0.15); border: 1px solid rgba(245,166,35,0.35);
    color: var(--accent4); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
    padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
  }
  .mult-btn:hover { background: rgba(245,166,35,0.25); }
  .mult-steps { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; line-height: 1.9; }
  .mult-step-row { display: flex; align-items: center; gap: 0.5rem; padding: 0.2rem 0; border-bottom: 1px solid var(--border); }
  .step-n { color: var(--muted); min-width: 55px; font-size: 0.72rem; }
  .step-msw { color: var(--accent); min-width: 55px; }
  .step-lsw { color: var(--accent3); min-width: 55px; }
  .step-c { color: var(--accent4); min-width: 25px; }
  .step-note { color: var(--muted); font-size: 0.72rem; }

  /* QUIZ */
  .quiz-wrap { margin-top: 2.5rem; }
  .quiz-wrap h3 { font-family: 'Syne', sans-serif; font-size: 1rem; margin-bottom: 1rem; color: var(--accent3); }
  .quiz-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1.2rem 1.4rem; margin-bottom: 1rem; }
  .quiz-q { font-size: 0.92rem; margin-bottom: 0.75rem; }
  .quiz-opts { display: flex; flex-direction: column; gap: 0.4rem; }
  .quiz-opt {
    display: flex; align-items: center; gap: 0.65rem; background: var(--surface2);
    border: 1px solid var(--border); border-radius: 6px; padding: 0.55rem 0.85rem;
    cursor: pointer; font-size: 0.88rem; transition: all 0.15s;
    font-family: 'Lato', sans-serif; color: var(--text); text-align: left;
  }
  .quiz-opt:hover { border-color: var(--accent3); }
  .quiz-opt:disabled { cursor: default; }
  .quiz-opt.correct { border-color: var(--accent3); background: rgba(54,201,160,0.1); color: var(--accent3); }
  .quiz-opt.wrong { border-color: var(--accent2); background: rgba(224,92,122,0.1); color: var(--accent2); }
  .quiz-feedback { font-size: 0.83rem; margin-top: 0.6rem; color: var(--muted); font-style: italic; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0; }
  @media (max-width: 600px) { .two-col { grid-template-columns: 1fr; } }
  .mini-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 0.9rem 1rem; font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; }
  .mini-card .mc-title { color: var(--accent4); font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem; }
  .mini-card .mc-val { color: var(--text); line-height: 1.9; }
`,
    body: `<header>
  <div class="chip">INF â€” Assembleur</div>
  <h1>Chapitre 5 â€” <span>Les nombres entiers</span></h1>
  <p class="subtitle">ReprÃ©sentation, arithmÃ©tique, dÃ©bordement Â· Notes de cours interactives</p>
</header>

<nav class="toc-bar">
  <a class="toc-btn" href="#s1">01 Entiers</a>
  <a class="toc-btn" href="#s2">02 Signe-magnitude</a>
  <a class="toc-btn" href="#s3">03 ComplÃ©ment Ã  2</a>
  <a class="toc-btn" href="#s4">04 Instructions arith.</a>
  <a class="toc-btn" href="#s5">05 DÃ©bordement (V)</a>
  <a class="toc-btn" href="#s6">06 Report (C)</a>
  <a class="toc-btn" href="#s7">07 Multiplication</a>
  <a class="toc-btn" href="#s8">08 Division</a>
  <a class="toc-btn" href="#quiz">ğŸ§  Quiz</a>
</nav>

<main>

<!-- S1 -->
<div class="section" id="s1">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">01</span>
    <span class="section-title">Les entiers â€” limites de reprÃ©sentation</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>â„¤ est infini, mais un ordinateur a un nombre fini de bits. On reprÃ©sente donc un <strong>sous-ensemble</strong> bornÃ© :</p>
    <div class="highlight-box">
      <div class="box-label label-blue">Intervalle reprÃ©sentable</div>
      <strong>[âˆ’m, â€¦, âˆ’1, 0, 1, â€¦, n]</strong> â€” les valeurs de m et n dÃ©pendent du nombre de bits disponibles.
    </div>
    <p>Le nombre de bits dÃ©termine la <strong>plage de valeurs</strong> : plus il y a de bits, plus on peut reprÃ©senter de grands nombres.</p>
  </div>
</div>

<!-- S2 -->
<div class="section" id="s2">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">02</span>
    <span class="section-title">ReprÃ©sentation signe-magnitude (problÃ¨mes)</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>L'idÃ©e naÃ¯ve : utiliser <strong>1 bit pour le signe</strong> (0 = positif, 1 = nÃ©gatif) et les <code>lâˆ’1</code> bits restants pour la valeur absolue.</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Table sur 3 bits</div>
        <div class="mc-val">
          <span class="pos">000 = +0 &nbsp; 001 = +1</span><br>
          <span class="pos">010 = +2 &nbsp; 011 = +3</span><br>
          <span class="neg">100 = -0 &nbsp; 101 = -1</span><br>
          <span class="neg">110 = -2 &nbsp; 111 = -3</span>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">ProblÃ¨mes</div>
        <div class="mc-val" style="font-family:'Lato',sans-serif; font-size:0.85rem; line-height:1.7;">
          âŒ Deux reprÃ©sentations pour zÃ©ro (+0 et -0)<br>
          âŒ L'addition directe donne de mauvais rÃ©sultats<br>
          âŒ NÃ©cessite une logique spÃ©ciale pour les opÃ©rations
        </div>
      </div>
    </div>

    <div class="warn-box">
      <div class="box-label label-red">Exemple du problÃ¨me</div>
      <code>110 + 000 = 111</code> soit âˆ’2 + (+0) = âˆ’3 ? C'est faux !<br>
      Il faudrait examiner les signes avant chaque opÃ©ration â€” pas pratique du tout.
    </div>
  </div>
</div>

<!-- S3 -->
<div class="section" id="s3">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">03</span>
    <span class="section-title">ComplÃ©ment Ã  2 â˜…</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Solution : reprÃ©senter les nÃ©gatifs avec l'<strong>arithmÃ©tique modulo 2<sup>l</sup></strong>.</p>
    <div class="highlight-box">
      <div class="box-label label-blue">Formule</div>
      âˆ’x = 2<sup>l</sup> âˆ’ x &nbsp;|&nbsp; Plage : de âˆ’2<sup>lâˆ’1</sup> Ã  2<sup>lâˆ’1</sup>âˆ’1
    </div>

    <p><strong>Pour calculer l'opposÃ© d'un nombre :</strong></p>
    <div class="tip-box">
      <div class="box-label label-green">Algorithme inverse (2 Ã©tapes)</div>
      1. Inverser tous les bits (NOT bitwise)<br>
      2. Ajouter 1 au rÃ©sultat
    </div>

    <!-- INTERACTIVE TOOL -->
    <div class="tc-tool">
      <h4>ğŸ”§ Convertisseur interactif â€” ComplÃ©ment Ã  2</h4>
      <div class="tc-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Nombre dÃ©cimal :</label>
        <input class="tc-input" type="number" id="tc-num" value="5" min="-128" max="127">
        <button class="tc-btn" onclick="computeTC()">Convertir</button>
        <span style="font-size:0.8rem; color:var(--muted);">sur 8 bits</span>
      </div>
      <div class="tc-result" id="tc-result"></div>
    </div>

    <p><strong>Astuce hexadÃ©cimale :</strong></p>
    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">Positif si commence par</div>
        <div class="mc-val" style="color:var(--accent3);">0, 1, 2, 3, 4, 5, 6, 7</div>
      </div>
      <div class="mini-card">
        <div class="mc-title">NÃ©gatif si commence par</div>
        <div class="mc-val" style="color:var(--accent2);">8, 9, A, B, C, D, E, F</div>
      </div>
    </div>

    <p style="margin-top:1rem;"><strong>VÃ©rification :</strong> 5 + (âˆ’6) = âˆ’1</p>
    <pre><code>  <span class="num">0101</span>   (+5)
+ <span class="num">1010</span>   (-6 en complÃ©ment Ã  2)
  <span class="num">1111</span>   = -1 âœ“

  <span class="num">1011</span>   (-5)
+ <span class="num">0110</span>   (+6)
<span class="num">1 0001</span>   = +1 (le report final est ignorÃ©) âœ“</code></pre>
  </div>
</div>

<!-- S4 -->
<div class="section" id="s4">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">04</span>
    <span class="section-title">Instructions arithmÃ©tiques ARM</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p><code>add</code> et <code>sub</code> acceptent comme 2e opÃ©rande un registre ou un <strong>immÃ©diat de 12 bits</strong> (dÃ©calÃ© de 0 ou 12 bits).</p>

    <div class="flags-row">
      <div class="flag-card">
        <div class="flag-name">Z</div>
        <div class="flag-desc">RÃ©sultat = 0</div>
      </div>
      <div class="flag-card">
        <div class="flag-name">N</div>
        <div class="flag-desc">RÃ©sultat nÃ©gatif</div>
      </div>
      <div class="flag-card">
        <div class="flag-name">V</div>
        <div class="flag-desc">DÃ©bordement signÃ©</div>
      </div>
      <div class="flag-card">
        <div class="flag-name">C</div>
        <div class="flag-desc">Report (carry)</div>
      </div>
    </div>

    <div class="tip-box">
      <div class="box-label label-green">Suffixe "s"</div>
      Ajouter <code>s</code> Ã  l'instruction (<code>adds</code>, <code>subs</code>) pour <strong>mettre Ã  jour les drapeaux Z, N, V, C</strong>. Sans ce suffixe, les drapeaux ne changent pas.
    </div>

    <pre><code><span class="kw">adds</span>  <span class="reg">x25</span>, <span class="reg">x21</span>, <span class="reg">x23</span>   <span class="cmt">// Addition + mise Ã  jour drapeaux</span>
<span class="kw">adcs</span>  <span class="reg">x24</span>, <span class="reg">x20</span>, <span class="reg">x22</span>   <span class="cmt">// Addition avec report entrant</span>
<span class="kw">b.vc</span>  label            <span class="cmt">// Branche si pas de dÃ©bordement</span></code></pre>
  </div>
</div>

<!-- S5 -->
<div class="section" id="s5">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">05</span>
    <span class="section-title">DÃ©bordement de capacitÃ© (bit V)</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Le dÃ©bordement se produit quand le rÃ©sultat ne tient pas sur <code>l</code> bits.</p>

    <table>
      <tr><th>OpÃ©ration</th><th>Condition de dÃ©bordement</th><th>Impossible siâ€¦</th></tr>
      <tr><td>Addition</td><td>OpÃ©randes <strong>mÃªme signe</strong>, rÃ©sultat de <strong>signe contraire</strong></td><td>OpÃ©randes de signes contraires</td></tr>
      <tr><td>Soustraction</td><td>OpÃ©randes <strong>signes diffÃ©rents</strong>, rÃ©sultat de <strong>signe contraire</strong> au 1er opÃ©rande</td><td>OpÃ©randes de mÃªme signe</td></tr>
      <tr><td>Division signÃ©e</td><td>sdiv(âˆ’2<sup>lâˆ’1</sup>, âˆ’1) â†’ rÃ©sultat = âˆ’2<sup>lâˆ’1</sup> (non dÃ©tectÃ©!)</td><td>Cas gÃ©nÃ©ral</td></tr>
    </table>

    <div class="warn-box">
      <div class="box-label label-red">Exemple classique sur 4 bits</div>
      <code>0111 (7) + 0110 (6) = 1101 â†’ interprÃ©tÃ© comme âˆ’3 !</code><br>
      Les deux opÃ©randes sont positifs mais le rÃ©sultat semble nÃ©gatif â†’ dÃ©bordement V = 1.
    </div>

    <div class="tip-box">
      <div class="box-label label-green">Multiplication</div>
      Pour Ã©viter le dÃ©bordement, on suppose que les opÃ©randes tiennent sur 32 bits. Pire cas : âˆ’2<sup>31</sup> Ã— âˆ’2<sup>31</sup> = 2<sup>62</sup> &lt; 2<sup>63</sup>âˆ’1 â†’ tient sur 64 bits.
    </div>
  </div>
</div>

<!-- S6 -->
<div class="section" id="s6">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">06</span>
    <span class="section-title">Report (bit C) â€” opÃ©rations multi-mots</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Le report (carry) sert aux <strong>additions sur plus de l bits</strong>. On calcule les rÃ©sultats sur <code>l+1</code> bits : si le bit le plus significatif vaut 1 aprÃ¨s une addition, il y a report.</p>

    <div class="highlight-box">
      <div class="box-label label-blue">RÃ¨gle</div>
      Addition : report si bit MSB du rÃ©sultat Ã©tendu = 1<br>
      Soustraction : report (absence d'emprunt) si bit MSB = 0
    </div>

    <table>
      <tr><th>Instruction</th><th>RÃ´le</th></tr>
      <tr><td class="mono">adds / subs</td><td>1Ã¨re opÃ©ration â€” gÃ©nÃ¨re C et V</td></tr>
      <tr><td class="mono">adcs / sbcs</td><td>OpÃ©rations suivantes â€” utilise et gÃ©nÃ¨re C</td></tr>
      <tr><td class="mono">b.vs</td><td>Branche si dÃ©bordement (V=1)</td></tr>
      <tr><td class="mono">b.vc</td><td>Branche si pas de dÃ©bordement (V=0)</td></tr>
    </table>

    <p style="margin-top:0.75rem;"><strong>Exemple â€” addition 128 bits (par groupes de 64 bits) :</strong></p>
    <pre><code><span class="kw">mov</span>   <span class="reg">x26</span>, xzr           <span class="cmt">// Pas d'overflow par dÃ©faut</span>
<span class="kw">adds</span>  <span class="reg">x25</span>, <span class="reg">x21</span>, <span class="reg">x23</span>    <span class="cmt">// bits [0..63] des deux entiers</span>
<span class="kw">adcs</span>  <span class="reg">x24</span>, <span class="reg">x20</span>, <span class="reg">x22</span>    <span class="cmt">// bits [64..127] + report entrant</span>
<span class="kw">b.vc</span>  bigint10           <span class="cmt">// Si pas de dÃ©bordement, continuer</span>
<span class="kw">mov</span>   <span class="reg">x26</span>, 1             <span class="cmt">// Overflow dÃ©tectÃ©</span>
<span class="lbl">bigint10:</span>
<span class="kw">adcs</span>  <span class="reg">x27</span>, xzr, xzr      <span class="cmt">// Copie le bit C dans x27</span></code></pre>

    <div class="tip-box">
      <div class="box-label label-green">Formules report final (double-mot)</div>
      C<sub>final</sub> = C<sub>2</sub> âˆ¨ C<sub>3</sub> &nbsp;&nbsp;|&nbsp;&nbsp; V<sub>final</sub> = V<sub>2</sub> âŠ• V<sub>3</sub>
    </div>
  </div>
</div>

<!-- S7 -->
<div class="section" id="s7">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">07</span>
    <span class="section-title">Multiplication par dÃ©calage</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Deux approches pour multiplier sans instruction dÃ©diÃ©e :</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">MÃ©thode naÃ¯ve</div>
        <div class="mc-val" style="font-family:'Lato',sans-serif; font-size:0.84rem;">
          Additionner le multiplicande n fois.<br>
          <span style="color:var(--accent2);">Simple mais trÃ¨s lente.</span>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">DÃ©calage droite</div>
        <div class="mc-val" style="font-family:'Lato',sans-serif; font-size:0.84rem;">
          Examine les bits du multiplicateur un Ã  un.<br>
          <span style="color:var(--accent3);">Rapide, utilisÃ©e en pratique.</span>
        </div>
      </div>
    </div>

    <!-- LÃ‰GENDE -->
    <div style="background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:1.1rem 1.3rem; margin:1rem 0;">
      <div style="font-family:'JetBrains Mono',monospace; font-size:0.68rem; color:var(--muted); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:0.75rem;">ğŸ“– LÃ©gende des abrÃ©viations</div>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:0.6rem;">
        <div style="display:flex; align-items:flex-start; gap:0.6rem;">
          <span style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; color:var(--accent); background:rgba(91,141,238,0.12); border:1px solid rgba(91,141,238,0.3); border-radius:4px; padding:2px 8px; white-space:nowrap;">MSW</span>
          <span style="font-size:0.84rem; color:var(--text);">Most Significant Word â€” <strong>mot de poids fort</strong> (la moitiÃ© haute du produit)</span>
        </div>
        <div style="display:flex; align-items:flex-start; gap:0.6rem;">
          <span style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; color:var(--accent3); background:rgba(54,201,160,0.12); border:1px solid rgba(54,201,160,0.3); border-radius:4px; padding:2px 8px; white-space:nowrap;">LSW</span>
          <span style="font-size:0.84rem; color:var(--text);">Least Significant Word â€” <strong>mot de poids faible</strong> (la moitiÃ© basse, initialisÃ©e avec le multiplicateur)</span>
        </div>
        <div style="display:flex; align-items:flex-start; gap:0.6rem;">
          <span style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; color:var(--accent2); background:rgba(224,92,122,0.12); border:1px solid rgba(224,92,122,0.3); border-radius:4px; padding:2px 8px; white-space:nowrap;">LSB</span>
          <span style="font-size:0.84rem; color:var(--text);">Least Significant Bit â€” <strong>bit de poids faible</strong> (le bit le plus Ã  droite)</span>
        </div>
        <div style="display:flex; align-items:flex-start; gap:0.6rem;">
          <span style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; color:var(--accent4); background:rgba(245,166,35,0.12); border:1px solid rgba(245,166,35,0.3); border-radius:4px; padding:2px 8px; white-space:nowrap;">C</span>
          <span style="font-size:0.84rem; color:var(--text);">Carry â€” <strong>report</strong> gÃ©nÃ©rÃ© par l'addition (bit qui "dÃ©borde" du MSW)</span>
        </div>
        <div style="display:flex; align-items:flex-start; gap:0.6rem;">
          <span style="font-family:'JetBrains Mono',monospace; font-size:0.82rem; color:#c97af5; background:rgba(201,122,245,0.12); border:1px solid rgba(201,122,245,0.3); border-radius:4px; padding:2px 8px; white-space:nowrap;">B</span>
          <span style="font-size:0.84rem; color:var(--text);">Bit perdu â€” <strong>bit Ã©jectÃ©</strong> du MSW lors du dÃ©calage droite, rÃ©insÃ©rÃ© Ã  gauche du LSW</span>
        </div>
      </div>
    </div>

    <div class="highlight-box">
      <div class="box-label label-blue">Algorithme non signÃ© â€” rÃ©pÃ©ter n fois (n = nombre de bits)</div>
      <strong>Ã‰tape 1 :</strong> Si <span style="color:var(--accent2)">LSB</span> du <span style="color:var(--accent3)">LSW</span> = 1 â†’ ajouter le multiplicande au <span style="color:var(--accent)">MSW</span> (garder <span style="color:var(--accent4)">C</span>)<br>
      <strong>Ã‰tape 2 :</strong> DÃ©caler le <span style="color:var(--accent)">MSW</span> d'une position vers la droite â€” insÃ©rer <span style="color:var(--accent4)">C</span> Ã  gauche, garder bit perdu <span style="color:#c97af5">B</span><br>
      <strong>Ã‰tape 3 :</strong> DÃ©caler le <span style="color:var(--accent3)">LSW</span> d'une position vers la droite â€” insÃ©rer <span style="color:#c97af5">B</span> Ã  gauche
    </div>

    <!-- ANIMATED STEP-BY-STEP VISUALIZER -->
    <div id="mult-viz" style="background:var(--surface2); border:1px solid var(--border); border-radius:12px; padding:1.4rem; margin:1rem 0;">
      <div style="font-family:'Syne',sans-serif; font-size:0.95rem; font-weight:700; color:var(--accent4); margin-bottom:1.1rem;">ğŸ¬ Visualiseur pas-Ã -pas</div>

      <!-- Inputs -->
      <div style="display:flex; align-items:center; gap:0.75rem; flex-wrap:wrap; margin-bottom:1.2rem;">
        <label style="font-size:0.85rem; color:var(--muted);">Multiplicande A :</label>
        <input class="mult-input" type="number" id="va" value="13" min="0" max="15">
        <label style="font-size:0.85rem; color:var(--muted);">Ã— Multiplicateur B :</label>
        <input class="mult-input" type="number" id="vb" value="11" min="0" max="15">
        <button class="mult-btn" onclick="initViz()" style="background:rgba(245,166,35,0.2); border-color:rgba(245,166,35,0.5);">â–¶ DÃ©marrer</button>
        <span style="font-size:0.75rem; color:var(--muted);">valeurs 0â€“15</span>
      </div>

      <!-- Current state display -->
      <div id="viz-state" style="display:none;">
        <!-- Register visual -->
        <div style="margin-bottom:1.2rem;">
          <div style="font-family:'JetBrains Mono',monospace; font-size:0.7rem; color:var(--muted); margin-bottom:0.4rem; text-transform:uppercase; letter-spacing:0.08em;">Registres (8 bits = MSW + LSW)</div>
          <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">
            <!-- C bit -->
            <div style="display:flex; flex-direction:column; align-items:center; gap:3px;">
              <div id="vbit-c" style="width:26px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:5px;font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.9rem;border:2px solid rgba(245,166,35,0.5);background:rgba(245,166,35,0.1);color:var(--accent4);transition:all 0.35s;">0</div>
              <div style="font-size:0.6rem;color:var(--accent4);font-family:'JetBrains Mono',monospace;">C</div>
            </div>
            <div style="color:var(--muted); font-size:0.8rem;">|</div>
            <!-- MSW bits -->
            <div id="vbits-msw" style="display:flex; gap:3px;"></div>
            <div style="display:flex; flex-direction:column; align-items:center; margin:0 4px;">
              <div style="width:2px; height:30px; background:var(--border);"></div>
              <div style="font-size:0.58rem; color:var(--muted); margin-top:2px;">MSW|LSW</div>
            </div>
            <!-- LSW bits -->
            <div id="vbits-lsw" style="display:flex; gap:3px;"></div>
          </div>
          <!-- Labels under bits -->
          <div style="display:flex; gap:6px; margin-top:4px; align-items:center;">
            <div style="width:26px;"></div>
            <div style="width:8px;"></div>
            <div id="vbits-msw-labels" style="display:flex; gap:3px;"></div>
            <div style="width:50px;"></div>
            <div id="vbits-lsw-labels" style="display:flex; gap:3px;"></div>
          </div>
        </div>

        <!-- Explanation box -->
        <div id="viz-explain" style="background:var(--code-bg); border:1px solid var(--border); border-radius:8px; padding:0.9rem 1.1rem; margin-bottom:1rem; font-size:0.88rem; min-height:60px; line-height:1.7;"></div>

        <!-- Step counter + nav -->
        <div style="display:flex; align-items:center; gap:0.75rem; flex-wrap:wrap;">
          <button id="btn-prev" onclick="stepViz(-1)" style="background:var(--surface); border:1px solid var(--border); color:var(--text); font-family:'JetBrains Mono',monospace; font-size:0.8rem; padding:0.45rem 1rem; border-radius:6px; cursor:pointer; transition:all 0.2s;">â† PrÃ©cÃ©dent</button>
          <button id="btn-next" onclick="stepViz(1)" style="background:rgba(54,201,160,0.15); border:1px solid rgba(54,201,160,0.35); color:var(--accent3); font-family:'JetBrains Mono',monospace; font-size:0.8rem; padding:0.45rem 1rem; border-radius:6px; cursor:pointer; transition:all 0.2s;">Suivant â†’</button>
          <div id="viz-progress" style="font-family:'JetBrains Mono',monospace; font-size:0.75rem; color:var(--muted);"></div>
          <div id="viz-final" style="font-family:'JetBrains Mono',monospace; font-size:0.88rem; color:var(--accent3); font-weight:700;"></div>
        </div>
      </div>

      <div id="viz-error" style="color:var(--accent2); font-size:0.85rem; display:none;"></div>
    </div>

    <p style="margin-top:0.75rem;"><strong>Multiplication signÃ©e :</strong> mÃªme algorithme, mais Ã  la <em>derniÃ¨re itÃ©ration</em>, l'addition est remplacÃ©e par une <strong>soustraction</strong>. Le report C est remplacÃ© par N âŠ• V pour Ã©tendre correctement le bit de signe.</p>
  </div>
</div>

<!-- S8 -->
<div class="section" id="s8">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">08</span>
    <span class="section-title">Division</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>L'algorithme de division est l'<strong>inverse</strong> de la multiplication :</p>
    <table>
      <tr><th>Multiplication</th><th>Division</th></tr>
      <tr><td>DÃ©calage droite</td><td>DÃ©calage gauche</td></tr>
      <tr><td>Addition</td><td>Soustraction</td></tr>
      <tr><td>Initialisation : produit = {0, multiplicateur}</td><td>Initialisation : quotient = dividende, reste = 0</td></tr>
    </table>

    <div class="highlight-box">
      <div class="box-label label-blue">Algorithme non signÃ© â€” rÃ©pÃ©ter n fois</div>
      1. DÃ©caler le quotient d'une position vers la gauche (garder bit perdu)<br>
      2. DÃ©caler le reste vers la gauche (insÃ©rer bit perdu)<br>
      3. Soustraire le diviseur du reste<br>
      4. Si rÃ©sultat nÃ©gatif â†’ bit LSB quotient = 0, restaurer le reste ; sinon â†’ bit LSB quotient = 1
    </div>

    <div class="warn-box">
      <div class="box-label label-red">Division signÃ©e â€” controverse sur le reste</div>
      <code>17 Ã· 5 = 3</code>, reste 2 &nbsp;|&nbsp; <code>âˆ’17 Ã· 5 = âˆ’4</code>, reste 3<br>
      Le signe du reste dÃ©pend de la convention choisie. En ARM, <code>sdiv</code> tronque vers zÃ©ro.
    </div>

    <div class="tip-box">
      <div class="box-label label-green">Division signÃ©e</div>
      Travailler avec les <strong>valeurs absolues</strong>, puis appliquer le signe :<br>
      MÃªme signe â†’ quotient positif Â· Signes contraires â†’ quotient nÃ©gatif
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="quiz-wrap" id="quiz">
  <h3>ğŸ§  Quiz de rÃ©vision â€” Chapitre 5</h3>

  <div class="quiz-card" id="q1">
    <p class="quiz-q"><strong>Q1.</strong> Sur 4 bits, quelle est la plage de valeurs en complÃ©ment Ã  2 ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” en signe-magnitude on aurait -7 a +7, mais avec deux zeros.')">âˆ’7 Ã  +7</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q1','Correct ! m = 2^(l-1) = 8, n = 2^(l-1)-1 = 7.')">âˆ’8 Ã  +7</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” il y a un nombre negatif de plus que de positifs en complement a 2.')">âˆ’8 Ã  +8</button>
    </div>
    <p class="quiz-feedback" id="q1-fb"></p>
  </div>

  <div class="quiz-card" id="q2">
    <p class="quiz-q"><strong>Q2.</strong> Comment calcule-t-on le complÃ©ment Ã  2 de <code>0110</code> (6) ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” mettre juste le bit de signe a 1 donne la representation signe-magnitude, pas le complement a 2.')">Mettre le bit de signe Ã  1 â†’ <code>1110</code></button>
      <button class="quiz-opt" onclick="ans(this,'correct','q2','Oui ! On inverse tous les bits (0110 â†’ 1001), puis on ajoute 1 (1001 + 1 = 1010 = -6).')">Inverser les bits â†’ <code>1001</code>, puis +1 â†’ <code>1010</code></button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” soustraire 1 puis inverser donne un resultat different.')">Soustraire 1 â†’ <code>0101</code>, puis inverser â†’ <code>1010</code></button>
    </div>
    <p class="quiz-feedback" id="q2-fb"></p>
  </div>

  <div class="quiz-card" id="q3">
    <p class="quiz-q"><strong>Q3.</strong> Quand se produit un dÃ©bordement dans une addition ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” si les operandes sont de signes contraires, le debordement est impossible en addition.')">Toujours quand les opÃ©randes sont de signes contraires</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q3','Exact ! Deux positifs dont la somme semble negative, ou deux negatifs dont la somme semble positive.')">Quand les opÃ©randes ont le mÃªme signe mais que le rÃ©sultat est de signe contraire</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” un report ne signifie pas necessairement un debordement signe.')">Toujours quand il y a un report (C=1)</button>
    </div>
    <p class="quiz-feedback" id="q3-fb"></p>
  </div>

  <div class="quiz-card" id="q4">
    <p class="quiz-q"><strong>Q4.</strong> Quelle instruction utilise-t-on pour la 2e partie d'une addition multi-mots (avec report entrant) ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” adds est pour la premiere partie, elle genere C mais ne le consomme pas.')"><code>adds</code></button>
      <button class="quiz-opt" onclick="ans(this,'correct','q4','Correct ! adcs = Add with Carry. Elle utilise le bit C de la precedente operation.')"><code>adcs</code></button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” add sans s ne met pas a jour les drapeaux.')"><code>add</code></button>
    </div>
    <p class="quiz-feedback" id="q4-fb"></p>
  </div>

  <div class="quiz-card" id="q5">
    <p class="quiz-q"><strong>Q5.</strong> Dans l'algorithme de multiplication par dÃ©calage, que fait-on si le bit LSB du mot bas vaut 0 ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” on najoute le multiplicande que si le bit LSB vaut 1.')">On ajoute le multiplicande au mot haut</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q5','Oui ! On ajoute 0 (rien) au mot haut, puis on continue les decalages normalement.')">On ajoute 0 au mot haut (on ne fait rien), puis on dÃ©cale</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” on ne saute jamais une iteration entiere.')">On saute l'iteration entiere</button>
    </div>
    <p class="quiz-feedback" id="q5-fb"></p>
  </div>

</div>
</main>`,
    script: `function toggle(header) {
  header.closest('.section').classList.toggle('collapsed');
}

function ans(btn, result, qid, feedback) {
  const card = document.getElementById(qid);
  card.querySelectorAll('.quiz-opt').forEach(o => { o.disabled = true; o.style.opacity = '0.5'; });
  btn.style.opacity = '1';
  btn.classList.add(result);
  document.getElementById(qid + '-fb').textContent = (result === 'correct' ? 'âœ… ' : 'âŒ ') + feedback;
}

document.querySelectorAll('.toc-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    e.preventDefault();
    const t = document.querySelector(btn.getAttribute('href'));
    if (t) { t.scrollIntoView({ behavior: 'smooth', block: 'start' }); if (t.classList.contains('collapsed')) t.classList.remove('collapsed'); }
  });
});

// COMPLEMENT A 2 TOOL
function toBin(n, bits) {
  if (n < 0) n = (1 << bits) + n;
  return n.toString(2).padStart(bits, '0');
}
function computeTC() {
  const n = parseInt(document.getElementById('tc-num').value);
  const bits = 8;
  const out = document.getElementById('tc-result');
  if (isNaN(n) || n < -128 || n > 127) { out.innerHTML = '<span style="color:var(--accent2)">Valeur entre -128 et 127 svp.</span>'; return; }

  const binPos = Math.abs(n).toString(2).padStart(bits, '0');
  const inv = binPos.split('').map(b => b === '0' ? '1' : '0').join('');
  const final = toBin(n, bits);

  let html = '';
  if (n >= 0) {
    html = \`<div class="tc-step"><span class="tc-step-label">ReprÃ©sentation binaire :</span><span class="tc-step-val"><span class="h">\${final}</span></span></div>
    <div class="tc-step"><span class="tc-step-label">Valeur dÃ©cimale :</span><span class="tc-step-val" style="color:var(--accent3)">+\${n}</span></div>\`;
  } else {
    html = \`<div class="tc-step"><span class="tc-step-label">Valeur absolue binaire :</span><span class="tc-step-val">\${binPos}</span></div>
    <div class="tc-step"><span class="tc-step-label">1. Inverser les bits :</span><span class="tc-step-val"><span class="h">\${inv}</span></span></div>
    <div class="tc-step"><span class="tc-step-label">2. Ajouter 1 :</span><span class="tc-step-val"><span class="h">\${final}</span></span></div>
    <div class="tc-step"><span class="tc-step-label">RÃ©sultat :</span><span class="tc-step-val" style="color:var(--accent2)">\${n} â†’ \${final}</span></div>\`;
  }
  out.innerHTML = html;
}
computeTC();

// â”€â”€ MULTIPLICATION STEP-BY-STEP VISUALIZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pad(n, bits) { return (n >>> 0).toString(2).padStart(bits, '0'); }

let vizSteps = [];   // all computed states
let vizIdx   = 0;    // current index
const BITS   = 4;

function buildSteps(a, b) {
  const steps = [];
  let msw = 0, lsw = b, C = 0;

  steps.push({
    msw, lsw, C, B: null,
    highlight: 'init',
    title: 'Initialisation',
    explain: \`On place le <span style="color:var(--accent3)">multiplicateur B = \${b}</span> dans le <span style="color:var(--accent3)">LSW</span> et on met le <span style="color:var(--accent)">MSW</span> Ã  <strong>0</strong>. Le <span style="color:var(--accent4)">report C</span> est 0. On rÃ©pÃ¨tera \${BITS} tours (un par bit).\`
  });

  for (let i = 0; i < BITS; i++) {
    const lsb = lsw & 1;
    let newMsw = msw;

    // Step 1 â€” add or not
    if (lsb === 1) {
      const sum = msw + a;
      C = (sum >> BITS) & 1;
      newMsw = sum & ((1 << BITS) - 1);
      steps.push({
        msw: newMsw, lsw, C, B: null,
        highlight: 'add',
        lsbVal: lsb,
        title: \`Tour \${i+1} â€” Ã‰tape 1 : addition\`,
        explain: \`Le <span style="color:var(--accent2)">LSB du LSW</span> vaut <strong>1</strong> â†’ on additionne le multiplicande <strong>\${a} (\${pad(a,BITS)})</strong> au <span style="color:var(--accent)">MSW</span>.<br>
        \${pad(msw,BITS)} + \${pad(a,BITS)} = <strong>\${pad(newMsw,BITS)}</strong>, report <span style="color:var(--accent4)">C = \${C}</span>.\`
      });
    } else {
      C = 0;
      steps.push({
        msw, lsw, C: 0, B: null,
        highlight: 'skip',
        lsbVal: lsb,
        title: \`Tour \${i+1} â€” Ã‰tape 1 : pas d'addition\`,
        explain: \`Le <span style="color:var(--accent2)">LSB du LSW</span> vaut <strong>0</strong> â†’ on n'ajoute rien au <span style="color:var(--accent)">MSW</span>. Report <span style="color:var(--accent4)">C = 0</span>.\`
      });
    }

    // Step 2 â€” shift MSW right
    const B = newMsw & 1;
    const shiftedMsw = ((C << (BITS - 1)) | (newMsw >> 1)) & ((1 << BITS) - 1);
    steps.push({
      msw: shiftedMsw, lsw, C, B,
      highlight: 'shift-msw',
      title: \`Tour \${i+1} â€” Ã‰tape 2 : dÃ©calage MSW\`,
      explain: \`On dÃ©cale le <span style="color:var(--accent)">MSW</span> d'une position vers la droite.<br>
      Le bit perdu <span style="color:#c97af5">B = \${B}</span> sort Ã  droite. Le <span style="color:var(--accent4)">report C = \${C}</span> entre Ã  gauche.<br>
      MSW : \${pad(newMsw,BITS)} â†’ <strong>\${pad(shiftedMsw,BITS)}</strong>\`
    });

    // Step 3 â€” shift LSW right
    const shiftedLsw = ((B << (BITS - 1)) | (lsw >> 1)) & ((1 << BITS) - 1);
    msw = shiftedMsw;
    lsw = shiftedLsw;
    steps.push({
      msw, lsw, C, B,
      highlight: 'shift-lsw',
      title: \`Tour \${i+1} â€” Ã‰tape 3 : dÃ©calage LSW\`,
      explain: \`On dÃ©cale le <span style="color:var(--accent3)">LSW</span> d'une position vers la droite.<br>
      Le bit perdu <span style="color:#c97af5">B = \${B}</span> entre Ã  gauche du LSW.<br>
      LSW : \${pad(((B << (BITS-1)) | ((lsw << 1) & ((1<<BITS)-1)) | B) >> 1, BITS)} â†’ <strong>\${pad(lsw,BITS)}</strong><br>
      <em style="color:var(--muted); font-size:0.82rem;">Fin du tour \${i+1}/\${BITS}</em>\`
    });
  }

  const result = (msw << BITS) | lsw;
  steps.push({
    msw, lsw, C: 0, B: null,
    highlight: 'done',
    title: 'âœ… RÃ©sultat final',
    explain: \`Les \${BITS} tours sont terminÃ©s. La concatÃ©nation <span style="color:var(--accent)">MSW</span>|<span style="color:var(--accent3)">LSW</span> = <strong>\${pad(msw,BITS)} \${pad(lsw,BITS)}</strong> = <span style="color:var(--accent3); font-size:1.05em">\${result}</span>.<br>
    VÃ©rification : \${a} Ã— \${b} = <strong>\${a*b}</strong> \${result === a*b ? 'âœ“' : 'âœ— (erreur!)'}\`
  });

  return steps;
}

function renderBits(containerId, val, bits, highlightPositions, color) {
  const el = document.getElementById(containerId);
  const binary = pad(val, bits);
  el.innerHTML = binary.split('').map((bit, i) => {
    const isHighlighted = highlightPositions && highlightPositions.includes(i);
    const isLsb = (i === bits - 1);
    let bg = bit === '1' ? 'rgba(91,141,238,0.18)' : 'var(--surface)';
    let borderC = bit === '1' ? 'rgba(91,141,238,0.5)' : 'var(--border)';
    let textC = bit === '1' ? 'var(--accent)' : 'var(--muted)';
    if (color === 'green') { bg = bit==='1'?'rgba(54,201,160,0.18)':'var(--surface)'; borderC=bit==='1'?'rgba(54,201,160,0.5)':'var(--border)'; textC=bit==='1'?'var(--accent3)':'var(--muted)'; }
    if (isLsb && color === 'green') { bg='rgba(224,92,122,0.18)'; borderC='rgba(224,92,122,0.5)'; textC='var(--accent2)'; }
    return \`<div style="width:28px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:5px;font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.9rem;border:1.5px solid \${borderC};background:\${bg};color:\${textC};transition:all 0.3s;">\${bit}</div>\`;
  }).join('');
}

function renderLabels(containerId, bits, color) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = Array.from({length:bits},(_,i)=>
    \`<div style="width:28px;text-align:center;font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:\${color||'var(--muted)'};">\${bits-1-i}</div>\`
  ).join('');
}

function renderVizState(s) {
  renderBits('vbits-msw', s.msw, BITS, [], 'blue');
  renderBits('vbits-lsw', s.lsw, BITS, [], 'green');
  renderLabels('vbits-msw-labels', BITS, 'var(--accent)');
  renderLabels('vbits-lsw-labels', BITS, 'var(--accent3)');

  const cEl = document.getElementById('vbit-c');
  cEl.textContent = s.C;
  cEl.style.background = s.C ? 'rgba(245,166,35,0.3)' : 'rgba(245,166,35,0.08)';
  cEl.style.borderColor = s.C ? 'rgba(245,166,35,0.8)' : 'rgba(245,166,35,0.3)';

  document.getElementById('viz-explain').innerHTML =
    \`<span style="font-family:'Syne',sans-serif;font-weight:700;font-size:0.9rem;color:var(--accent4);">\${s.title}</span><br>\${s.explain}\`;

  document.getElementById('viz-progress').textContent =
    \`Ã‰tape \${vizIdx + 1} / \${vizSteps.length}\`;

  document.getElementById('btn-prev').style.opacity = vizIdx === 0 ? '0.35' : '1';
  document.getElementById('btn-next').style.opacity = vizIdx === vizSteps.length - 1 ? '0.35' : '1';

  const finalEl = document.getElementById('viz-final');
  if (s.highlight === 'done') {
    const a = parseInt(document.getElementById('va').value);
    const b = parseInt(document.getElementById('vb').value);
    finalEl.textContent = \`\${a} Ã— \${b} = \${(s.msw << BITS) | s.lsw}\`;
  } else {
    finalEl.textContent = '';
  }
}

function initViz() {
  const a = parseInt(document.getElementById('va').value);
  const b = parseInt(document.getElementById('vb').value);
  const errEl = document.getElementById('viz-error');
  if (isNaN(a)||isNaN(b)||a<0||a>15||b<0||b>15) {
    errEl.textContent = 'Veuillez entrer des valeurs entre 0 et 15.';
    errEl.style.display = 'block';
    document.getElementById('viz-state').style.display = 'none';
    return;
  }
  errEl.style.display = 'none';
  vizSteps = buildSteps(a, b);
  vizIdx = 0;
  document.getElementById('viz-state').style.display = 'block';
  renderVizState(vizSteps[vizIdx]);
}

function stepViz(dir) {
  vizIdx = Math.max(0, Math.min(vizSteps.length - 1, vizIdx + dir));
  renderVizState(vizSteps[vizIdx]);
}

// Auto-init on load
window.addEventListener('DOMContentLoaded', initViz);`
  },
  {
    title: `Chapitre 6`,
    subtitle: `Les tableaux`,
    desc: `Vecteurs, matrices, adressage indexÃ©`,
    accent: `#36c9a0`,
    css: `
  :root {
    --bg: #0d0f14;
    --surface: #141720;
    --surface2: #1c2030;
    --border: #252a3a;
    --accent: #5b8dee;
    --accent2: #e05c7a;
    --accent3: #36c9a0;
    --accent4: #f5a623;
    --purple: #c97af5;
    --text: #e0e4f0;
    --muted: #7a8099;
    --code-bg: #0a0c11;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Lato', sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; }

  header {
    background: linear-gradient(135deg, #0d1220 0%, #111827 100%);
    border-bottom: 1px solid var(--border);
    padding: 3rem 2rem 2rem;
    position: relative; overflow: hidden;
  }
  header::before {
    content: ''; position: absolute; top: -60px; right: -60px;
    width: 350px; height: 350px;
    background: radial-gradient(circle, rgba(91,141,238,0.1) 0%, transparent 70%);
    pointer-events: none;
  }
  .chip {
    display: inline-block;
    background: rgba(91,141,238,0.12);
    border: 1px solid rgba(91,141,238,0.3);
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem; padding: 3px 10px; border-radius: 4px;
    letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 1rem;
  }
  h1 { font-family: 'Syne', sans-serif; font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 800; line-height: 1.15; margin-bottom: 0.5rem; }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 1rem; font-weight: 300; }

  .toc-bar {
    background: var(--surface); border-bottom: 1px solid var(--border);
    padding: 0.75rem 2rem; display: flex; gap: 0.5rem; flex-wrap: wrap;
    position: sticky; top: 0; z-index: 100;
  }
  .toc-btn {
    font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
    padding: 4px 12px; border-radius: 4px; border: 1px solid var(--border);
    background: transparent; color: var(--muted); cursor: pointer;
    transition: all 0.2s; text-decoration: none;
  }
  .toc-btn:hover { background: var(--surface2); color: var(--text); border-color: var(--accent); }

  main { max-width: 980px; margin: 0 auto; padding: 2.5rem 1.5rem 5rem; }

  .section {
    margin-bottom: 2rem; border: 1px solid var(--border); border-radius: 12px;
    overflow: hidden; background: var(--surface); transition: border-color 0.3s;
  }
  .section:hover { border-color: rgba(91,141,238,0.25); }
  .section-header {
    padding: 1.1rem 1.5rem; display: flex; align-items: center; gap: 0.9rem;
    cursor: pointer; user-select: none; background: var(--surface2); transition: background 0.2s;
  }
  .section-header:hover { background: #1f2538; }
  .section-num {
    font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--accent);
    background: rgba(91,141,238,0.1); border: 1px solid rgba(91,141,238,0.25);
    border-radius: 4px; padding: 2px 7px;
  }
  .section-title { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700; flex: 1; }
  .chevron { color: var(--muted); font-size: 0.75rem; transition: transform 0.25s; }
  .section.collapsed .chevron { transform: rotate(-90deg); }
  .section-body { padding: 1.5rem; }
  .section.collapsed .section-body { display: none; }

  p { font-size: 0.94rem; margin-bottom: 0.75rem; }

  .highlight-box { border-left: 3px solid var(--accent); background: rgba(91,141,238,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .warn-box { border-left: 3px solid var(--accent2); background: rgba(224,92,122,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .tip-box { border-left: 3px solid var(--accent3); background: rgba(54,201,160,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .purple-box { border-left: 3px solid var(--purple); background: rgba(201,122,245,0.07); border-radius: 0 8px 8px 0; padding: 0.9rem 1.2rem; margin: 1rem 0; font-size: 0.91rem; }
  .box-label { font-family: 'JetBrains Mono', monospace; font-size: 0.63rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.35rem; font-weight: 700; }
  .label-blue { color: var(--accent); } .label-red { color: var(--accent2); } .label-green { color: var(--accent3); } .label-orange { color: var(--accent4); } .label-purple { color: var(--purple); }

  pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px; padding: 1rem 1.2rem; overflow-x: auto; margin: 1rem 0; }
  code { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; line-height: 1.85; color: #c9d0e8; }
  .cmt { color: #636e8c; font-style: italic; }
  .kw { color: var(--accent); } .reg { color: var(--accent3); } .lbl { color: var(--accent2); }
  .num { color: var(--accent4); } .str { color: #e8a87c; }

  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; margin: 1rem 0; }
  th { background: var(--surface2); color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.07em; padding: 0.6rem 0.9rem; border: 1px solid var(--border); text-align: left; }
  td { padding: 0.55rem 0.9rem; border: 1px solid var(--border); vertical-align: middle; }
  tr:hover td { background: rgba(255,255,255,0.02); }
  .mono { font-family: 'JetBrains Mono', monospace; color: var(--accent3); font-size: 0.82rem; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0; }
  @media (max-width: 600px) { .two-col { grid-template-columns: 1fr; } }
  .mini-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 0.9rem 1rem; }
  .mini-card .mc-title { font-family:'JetBrains Mono',monospace; color: var(--accent4); font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem; }

  /* FORMULA DISPLAY */
  .formula {
    background: var(--code-bg); border: 1px solid rgba(91,141,238,0.3);
    border-radius: 8px; padding: 0.9rem 1.2rem; margin: 1rem 0;
    font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
    color: var(--text); text-align: center; line-height: 2;
  }
  .formula .fa { color: var(--accent2); }
  .formula .fb { color: var(--accent3); }
  .formula .fc { color: var(--accent4); }
  .formula .fd { color: var(--purple); }

  /* MEMORY CELL STRIP */
  .mem-strip { display: flex; align-items: stretch; margin: 1rem 0; overflow-x: auto; gap: 0; }
  .mem-cell {
    min-width: 52px; padding: 0.45rem 0.3rem; border: 1px solid var(--border);
    background: var(--surface2); font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem; text-align: center; position: relative;
    transition: all 0.25s; cursor: default; flex-shrink: 0;
  }
  .mem-cell:first-child { border-radius: 6px 0 0 6px; }
  .mem-cell:last-child { border-radius: 0 6px 6px 0; }
  .mem-cell .cell-idx { font-size: 0.6rem; color: var(--muted); margin-bottom: 2px; }
  .mem-cell .cell-val { font-size: 0.8rem; color: var(--text); }
  .mem-cell .cell-addr { font-size: 0.58rem; color: var(--muted); margin-top: 2px; }
  .mem-cell.active { background: rgba(91,141,238,0.2); border-color: var(--accent); }
  .mem-cell.active .cell-val { color: var(--accent); }
  .mem-cell.active .cell-idx { color: var(--accent); }
  .mem-cell.highlight { background: rgba(245,166,35,0.2); border-color: var(--accent4); }
  .mem-cell.highlight .cell-val { color: var(--accent4); }
  .mem-cell.highlight .cell-idx { color: var(--accent4); }

  /* VECTOR VISUALIZER */
  .viz-tool {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; padding: 1.4rem; margin: 1rem 0;
  }
  .viz-tool h4 { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 700; color: var(--accent4); margin-bottom: 1.1rem; }
  .viz-input-row { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .viz-input {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px;
    color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;
    padding: 0.45rem 0.65rem; width: 70px; outline: none; transition: border-color 0.2s;
  }
  .viz-input:focus { border-color: var(--accent); }
  .viz-btn {
    background: rgba(91,141,238,0.15); border: 1px solid rgba(91,141,238,0.35);
    color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
    padding: 0.45rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s;
  }
  .viz-btn:hover { background: rgba(91,141,238,0.28); }
  .viz-result {
    background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px;
    padding: 0.85rem 1rem; margin-top: 0.75rem; font-family: 'JetBrains Mono', monospace; font-size: 0.84rem; line-height: 2;
  }
  .viz-result .step { display: flex; gap: 0.6rem; align-items: baseline; flex-wrap: wrap; }
  .viz-result .step-label { color: var(--muted); font-size: 0.75rem; min-width: 180px; }
  .viz-result .step-val { color: var(--text); }
  .viz-result .step-val em { color: var(--accent4); font-style: normal; }

  /* MATRIX GRID */
  .matrix-grid {
    display: inline-grid; gap: 3px; margin: 1rem 0; font-family: 'JetBrains Mono', monospace; font-size: 0.78rem;
  }
  .mat-cell {
    width: 44px; height: 36px; display: flex; align-items: center; justify-content: center;
    border-radius: 5px; border: 1px solid var(--border); background: var(--surface2);
    color: var(--muted); transition: all 0.25s; cursor: pointer;
    font-size: 0.75rem;
  }
  .mat-cell.header-row { background: rgba(91,141,238,0.1); color: var(--accent); border-color: rgba(91,141,238,0.3); cursor: default; font-size: 0.7rem; }
  .mat-cell.header-col { background: rgba(54,201,160,0.1); color: var(--accent3); border-color: rgba(54,201,160,0.3); cursor: default; font-size: 0.7rem; }
  .mat-cell.selected { background: rgba(245,166,35,0.22); border-color: var(--accent4); color: var(--accent4); font-weight: 700; }
  .mat-cell:not(.header-row):not(.header-col):hover { background: rgba(201,122,245,0.15); border-color: var(--purple); color: var(--purple); }

  /* QUIZ */
  .quiz-wrap { margin-top: 2.5rem; }
  .quiz-wrap h3 { font-family: 'Syne', sans-serif; font-size: 1rem; margin-bottom: 1rem; color: var(--accent); }
  .quiz-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1.2rem 1.4rem; margin-bottom: 1rem; }
  .quiz-q { font-size: 0.92rem; margin-bottom: 0.75rem; }
  .quiz-opts { display: flex; flex-direction: column; gap: 0.4rem; }
  .quiz-opt {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 6px;
    padding: 0.55rem 0.85rem; cursor: pointer; font-size: 0.88rem; transition: all 0.15s;
    font-family: 'Lato', sans-serif; color: var(--text); text-align: left;
  }
  .quiz-opt:hover { border-color: var(--accent); }
  .quiz-opt:disabled { cursor: default; }
  .quiz-opt.correct { border-color: var(--accent3); background: rgba(54,201,160,0.1); color: var(--accent3); }
  .quiz-opt.wrong { border-color: var(--accent2); background: rgba(224,92,122,0.1); color: var(--accent2); }
  .quiz-feedback { font-size: 0.83rem; margin-top: 0.6rem; color: var(--muted); font-style: italic; }
`,
    body: `<header>
  <div class="chip">INF â€” Assembleur</div>
  <h1>Chapitre 6 â€” <span>Les tableaux</span></h1>
  <p class="subtitle">Vecteurs, matrices, adressage indexÃ© Â· Notes de cours interactives</p>
</header>

<nav class="toc-bar">
  <a class="toc-btn" href="#s1">01 DÃ©finition</a>
  <a class="toc-btn" href="#s2">02 Vecteurs</a>
  <a class="toc-btn" href="#s3">03 Adressage indexÃ©</a>
  <a class="toc-btn" href="#s4">04 Vecteurs sur ARM</a>
  <a class="toc-btn" href="#s5">05 Matrices</a>
  <a class="toc-btn" href="#s6">06 Formule d'adresse</a>
  <a class="toc-btn" href="#s7">07 Matrices sur ARM</a>
  <a class="toc-btn" href="#s8">08 d dimensions</a>
  <a class="toc-btn" href="#s9">09 Indices vs index</a>
  <a class="toc-btn" href="#quiz">ğŸ§  Quiz</a>
</nav>

<main>

<!-- S1 -->
<div class="section" id="s1">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">01</span>
    <span class="section-title">DÃ©finition â€” qu'est-ce qu'un tableau ?</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Un tableau est une structure de donnÃ©es regroupant plusieurs Ã©lÃ©ments qui partagent toutes les mÃªmes propriÃ©tÃ©s :</p>
    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">PropriÃ©tÃ©s des composantes</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âœ¦ MÃªme <strong>type</strong> (donc mÃªme taille en octets)<br>
          âœ¦ <strong>Contigus</strong> en mÃ©moire (pas de trous)<br>
          âœ¦ Partagent un <strong>nom</strong> commun (= une adresse de base)
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">AccÃ¨s Ã  un Ã©lÃ©ment</div>
        <div style="font-size:0.88rem; line-height:1.9;">
          âœ¦ Via un <strong>indice</strong> (i, j, kâ€¦)<br>
          âœ¦ Qui se traduit en un <strong>dÃ©placement</strong> (offset) par rapport Ã  l'adresse de base<br>
          âœ¦ Adresse = base + dÃ©placement
        </div>
      </div>
    </div>
    <div class="highlight-box">
      <div class="box-label label-blue">Dimensions</div>
      Tableau 1D â†’ <strong>Vecteur</strong> (un seul indice i)<br>
      Tableau 2D â†’ <strong>Matrice</strong> (indices i = ligne, j = colonne)<br>
      Tableau dD â†’ indice = <em>l</em>-uplet (iâ‚, iâ‚‚, â€¦, i<sub>l</sub>)
    </div>
  </div>
</div>

<!-- S2 -->
<div class="section" id="s2">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">02</span>
    <span class="section-title">Vecteurs â€” reprÃ©sentation en mÃ©moire</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Un vecteur est naturellement facile Ã  reprÃ©senter : <strong>la mÃ©moire elle-mÃªme est un vecteur de cellules</strong>. On pose les Ã©lÃ©ments l'un aprÃ¨s l'autre.</p>

    <div class="formula">
      Adresse de la composante <span class="fa">i</span> = <span class="fb">Î±</span> + (<span class="fa">i</span> âˆ’ 1) Ã— <span class="fc">lg</span>
    </div>
    <p style="font-size:0.85rem; color:var(--muted);">oÃ¹ <strong style="color:var(--accent3)">Î±</strong> = adresse de base du vecteur &nbsp;Â·&nbsp; <strong style="color:var(--accent4)">lg</strong> = taille en octets de chaque Ã©lÃ©ment</p>

    <p>Si les indices commencent Ã  <strong>0</strong> (comme dans la majoritÃ© des langages) :</p>
    <div class="formula">
      Adresse de la composante <span class="fa">i</span> = <span class="fb">Î±</span> + <span class="fa">i</span> Ã— <span class="fc">lg</span>
    </div>

    <!-- VECTOR MEMORY VISUALIZER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Visualiseur de vecteur en mÃ©moire</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">Taille Ã©lÃ©ment lg (octets) :</label>
        <input class="viz-input" type="number" id="vlg" value="4" min="1" max="8">
        <label style="font-size:0.85rem; color:var(--muted);">Nb d'Ã©lÃ©ments :</label>
        <input class="viz-input" type="number" id="vn" value="6" min="2" max="10">
        <label style="font-size:0.85rem; color:var(--muted);">Indice i (base 0) :</label>
        <input class="viz-input" type="number" id="vi" value="2" min="0" max="9">
        <button class="viz-btn" onclick="renderVector()">Calculer</button>
      </div>
      <div id="vec-strip"></div>
      <div class="viz-result" id="vec-result" style="display:none;"></div>
    </div>
  </div>
</div>

<!-- S3 -->
<div class="section" id="s3">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">03</span>
    <span class="section-title">Adressage indexÃ© sur ARM</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>L'accÃ¨s Ã  une composante utilise l'<strong>adressage indexÃ©</strong> : l'adresse de base est dans un registre, l'index est l'offset.</p>

    <table>
      <tr><th>Cas</th><th>Condition</th><th>Instruction ARM</th></tr>
      <tr>
        <td>Index constant</td>
        <td>Index connu Ã  la compilation <strong>et</strong> &lt; 2<sup>12</sup></td>
        <td class="mono">ldrsw x1, [x0, #index]</td>
      </tr>
      <tr>
        <td>Index variable</td>
        <td>Index calculÃ© au runtime (dans un registre)</td>
        <td class="mono">ldrsw x1, [x0, x2]</td>
      </tr>
    </table>

    <pre><code><span class="cmt">// x0 = adresse de base du vecteur</span>
<span class="cmt">// x2 = i Ã— lg  (index calculÃ©)</span>

<span class="kw">ldrsw</span> <span class="reg">x1</span>, [<span class="reg">x0</span>, <span class="num">#8</span>]    <span class="cmt">// Index constant 8 (ex: 3e Ã©lÃ©ment de mots 32bits)</span>
<span class="kw">ldrsw</span> <span class="reg">x1</span>, [<span class="reg">x0</span>, <span class="reg">x2</span>]    <span class="cmt">// Index dans registre x2</span></code></pre>

    <div class="warn-box">
      <div class="box-label label-red">Attention</div>
      L'index passÃ© Ã  l'instruction est toujours en <strong>octets</strong>, pas en numÃ©ro d'Ã©lÃ©ment. Il faut multiplier i Ã— lg avant de l'utiliser.
    </div>
  </div>
</div>

<!-- S4 -->
<div class="section" id="s4">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">04</span>
    <span class="section-title">DÃ©claration de vecteurs sur ARM</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>On dÃ©clare les vecteurs dans les sections de donnÃ©es :</p>
    <pre><code><span class="cmt">// Vecteur non initialisÃ© (variables) â€” section .bss</span>
<span class="kw">.section</span> <span class="str">".bss"</span>
<span class="kw">.align</span> 4
<span class="lbl">v1:</span>  <span class="kw">.skip</span> 4*100        <span class="cmt">// 100 mots de 32 bits = 400 octets</span>

<span class="cmt">// Vecteur initialisÃ© (donnÃ©es) â€” section .data</span>
<span class="kw">.section</span> <span class="str">".data"</span>
<span class="kw">.align</span> 2
<span class="lbl">v2:</span>  <span class="kw">.half</span> 4, 13, 34, 58, 67, 68, 77, 79, 83, 95</code></pre>

    <div class="highlight-box">
      <div class="box-label label-blue">Exemples de calcul d'adresse</div>
      <strong>v1[36]</strong> = v1 + 36 Ã— 4 = v1 + <em style="color:var(--accent4)">144</em> octets<br>
      <strong>v2[6]</strong> = v2 + 6 Ã— 2 = v2 + <em style="color:var(--accent4)">12</em> octets
    </div>

    <table>
      <tr><th>Section</th><th>Directive</th><th>Usage typique</th></tr>
      <tr><td class="mono">.bss</td><td class="mono">.skip N</td><td>Variables non initialisÃ©es (rÃ©serve N octets)</td></tr>
      <tr><td class="mono">.data</td><td class="mono">.half / .word / .byte</td><td>DonnÃ©es initialisÃ©es avec des valeurs</td></tr>
      <tr><td class="mono">.rodata</td><td class="mono">.asciz</td><td>Constantes (chaÃ®nes de format)</td></tr>
    </table>
  </div>
</div>

<!-- S5 -->
<div class="section" id="s5">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">05</span>
    <span class="section-title">Matrices â€” aplatissement en mÃ©moire</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>La mÃ©moire est <em>unidimensionnelle</em> â€” il faut <strong>aplatir</strong> une matrice 2D en un vecteur 1D.</p>

    <div class="two-col">
      <div class="mini-card">
        <div class="mc-title">StratÃ©gie : rangÃ©es d'abord (row-major)</div>
        <div style="font-size:0.86rem; line-height:1.8;">
          On place la 1Ã¨re rangÃ©e complÃ¨te en mÃ©moire, puis la 2Ã¨me, etc.<br>
          <span style="color:var(--muted);">C'est la convention la plus courante (C, Java, ARM).</span>
        </div>
      </div>
      <div class="mini-card">
        <div class="mc-title">StratÃ©gie : colonnes d'abord (col-major)</div>
        <div style="font-size:0.86rem; line-height:1.8;">
          On place la 1Ã¨re colonne complÃ¨te en mÃ©moire, puis la 2Ã¨me, etc.<br>
          <span style="color:var(--muted);">Convention de FORTRAN, MATLAB.</span>
        </div>
      </div>
    </div>

    <p>Pour une matrice A de M rangÃ©es Ã— N colonnes, on alloue un vecteur de <strong>M cellules</strong>, chaque cellule faisant <strong>N Ã— lg octets</strong>.</p>

    <!-- INTERACTIVE MATRIX VISUALIZER -->
    <div class="viz-tool">
      <h4>ğŸ”§ Visualiseur de matrice â€” cliquer une cellule pour voir son adresse</h4>
      <div class="viz-input-row">
        <label style="font-size:0.85rem; color:var(--muted);">RangÃ©es M :</label>
        <input class="viz-input" type="number" id="mM" value="3" min="2" max="5">
        <label style="font-size:0.85rem; color:var(--muted);">Colonnes N :</label>
        <input class="viz-input" type="number" id="mN" value="4" min="2" max="6">
        <label style="font-size:0.85rem; color:var(--muted);">lg (octets) :</label>
        <input class="viz-input" type="number" id="mLg" value="4" min="1" max="8">
        <button class="viz-btn" onclick="renderMatrix()">GÃ©nÃ©rer</button>
      </div>
      <div id="mat-grid-wrap" style="overflow-x:auto;"></div>
      <div class="viz-result" id="mat-result" style="display:none; margin-top:0.75rem;"></div>
      <div id="mat-strip-wrap" style="margin-top:1rem; display:none;">
        <div style="font-family:'JetBrains Mono',monospace; font-size:0.68rem; color:var(--muted); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:0.4rem;">ReprÃ©sentation linÃ©aire en mÃ©moire (rangÃ©es d'abord)</div>
        <div class="mem-strip" id="mat-strip"></div>
      </div>
    </div>
  </div>
</div>

<!-- S6 -->
<div class="section" id="s6">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">06</span>
    <span class="section-title">Formule d'adresse d'une cellule</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Pour une matrice A de N colonnes, l'adresse de A[i, j] (indices base 0) est :</p>

    <div class="formula">
      A[<span class="fa">i</span>, <span class="fb">j</span>] = A + (<span class="fa">i</span> Ã— <span class="fb">N</span> + <span class="fb">j</span>) Ã— <span class="fc">lg</span>
    </div>

    <p>Ce qui peut se dÃ©composer en :</p>
    <table>
      <tr><th>Terme</th><th>Signification</th></tr>
      <tr><td class="mono">i Ã— N Ã— lg</td><td>DÃ©placement pour atteindre la <strong>rangÃ©e i</strong> (sauter i rangÃ©es entiÃ¨res)</td></tr>
      <tr><td class="mono">j Ã— lg</td><td>DÃ©placement pour atteindre la <strong>colonne j</strong> dans la rangÃ©e</td></tr>
      <tr><td class="mono">(iÃ—N + j) Ã— lg</td><td>DÃ©placement total = index linÃ©aire Ã— taille Ã©lÃ©ment</td></tr>
    </table>

    <div class="tip-box">
      <div class="box-label label-green">Indices base 1 (comme dans le cours)</div>
      Si les indices commencent Ã  1 : A[i, j] = A + ((iâˆ’1) Ã— N + (jâˆ’1)) Ã— lg<br>
      <strong>Exemple :</strong> m1[30, 20] = m1 + ((30âˆ’1)Ã—100 + (20âˆ’1)) Ã— 4 = m1 + (2900+19)Ã—4 = m1 + 11676
    </div>

    <div class="warn-box">
      <div class="box-label label-red">PropriÃ©tÃ© importante</div>
      Index en 1D = Index<sub>ligne</sub> + Index<sub>colonne</sub><br>
      oÃ¹ Index<sub>ligne</sub> = i Ã— N Ã— lg &nbsp;&nbsp;et&nbsp;&nbsp; Index<sub>colonne</sub> = j Ã— lg
    </div>
  </div>
</div>

<!-- S7 -->
<div class="section" id="s7">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">07</span>
    <span class="section-title">DÃ©claration de matrices sur ARM</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <pre><code><span class="cmt">// Matrice non initialisÃ©e 100Ã—100 de mots 32 bits</span>
<span class="kw">.section</span> <span class="str">".bss"</span>
<span class="kw">.align</span> 4
<span class="lbl">m1:</span>  <span class="kw">.skip</span> 4*100*100    <span class="cmt">// 40 000 octets</span>

<span class="cmt">// Matrice initialisÃ©e (3Ã—3) de demi-mots 16 bits</span>
<span class="kw">.section</span> <span class="str">".data"</span>
<span class="kw">.align</span> 2
<span class="lbl">m2:</span>  <span class="kw">.half</span> 4, 13, 34, 58, 67, 68, 77, 79, 83</code></pre>

    <div class="highlight-box">
      <div class="box-label label-blue">Calcul d'adresse â€” exemples</div>
      <strong>m1[30, 20]</strong> (indices base 1, N=100, lg=4) :<br>
      &nbsp;&nbsp;= m1 + ((30âˆ’1)Ã—100 + (20âˆ’1)) Ã— 4 = m1 + 2919 Ã— 4 = m1 + <em style="color:var(--accent4)">11676</em><br><br>
      <strong>m2[2, 3]</strong> (indices base 1, N=3, lg=2) :<br>
      &nbsp;&nbsp;= m2 + ((2âˆ’1)Ã—3 + (3âˆ’1)) Ã— 2 = m2 + 5 Ã— 2 = m2 + <em style="color:var(--accent4)">10</em>
    </div>

    <p>Exemple d'affichage d'une matrice en mÃ©moire :</p>
    <pre><code><span class="cmt">// x19 = adresse A, x20 = M (nb rangÃ©es), x21 = N (nb colonnes)</span>
<span class="cmt">// Boucle externe : rangÃ©es (i de 0 Ã  M-1)</span>
<span class="cmt">// Boucle interne : colonnes (j de 0 Ã  N-1)</span>

<span class="lbl">mat00:</span>                           <span class="cmt">// i = 0</span>
    <span class="kw">mov</span>   <span class="reg">x22</span>, <span class="num">#0</span>              <span class="cmt">// j = 0</span>
<span class="lbl">mat10:</span>
    <span class="kw">mul</span>   <span class="reg">x23</span>, <span class="reg">x22</span>, <span class="num">#4</span>         <span class="cmt">// offset colonne = j Ã— lg</span>
    <span class="kw">ldr</span>   <span class="reg">w0</span>, [<span class="reg">x19</span>, <span class="reg">x23</span>]       <span class="cmt">// charge A[i][j]</span>
    <span class="kw">adr</span>   <span class="reg">x0</span>, ptfmt1
    <span class="kw">bl</span>    printf
    <span class="kw">add</span>   <span class="reg">x22</span>, <span class="reg">x22</span>, <span class="num">#1</span>         <span class="cmt">// j++</span>
    <span class="kw">cmp</span>   <span class="reg">x22</span>, <span class="reg">x21</span>
    <span class="kw">b.lt</span>  mat10                 <span class="cmt">// rÃ©pÃ©ter tant que j &lt; N</span></code></pre>
  </div>
</div>

<!-- S8 -->
<div class="section" id="s8">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">08</span>
    <span class="section-title">GÃ©nÃ©ralisation Ã  d dimensions</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <p>Pour un tableau T de dimensions (M, N, P, Q) et un indice T[i, j, k, l] :</p>

    <div class="formula">
      T[<span class="fa">i</span>, <span class="fb">j</span>, <span class="fc">k</span>, <span class="fd">l</span>] = A + (( <span class="fa">i</span>Ã—<span class="fb">N</span> + <span class="fb">j</span>)Ã—<span class="fc">P</span> + <span class="fc">k</span>)Ã—<span class="fd">Q</span> + <span class="fd">l</span>) Ã— lg
    </div>

    <p>Le principe est le mÃªme : on imbrique les dimensions de la plus grande vers la plus petite, comme des poupÃ©es russes.</p>

    <div class="tip-box">
      <div class="box-label label-green">Pattern gÃ©nÃ©ral</div>
      Chaque dimension supplÃ©mentaire <strong>multiplie</strong> toutes les dimensions intÃ©rieures.<br>
      Pour 2D : <code>(iÃ—N + j) Ã— lg</code><br>
      Pour 3D : <code>((iÃ—N + j)Ã—P + k) Ã— lg</code><br>
      Pour 4D : <code>(((iÃ—N + j)Ã—P + k)Ã—Q + l) Ã— lg</code>
    </div>
  </div>
</div>

<!-- S9 -->
<div class="section" id="s9">
  <div class="section-header" onclick="toggle(this)">
    <span class="section-num">09</span>
    <span class="section-title">Indices vs Index</span>
    <span class="chevron">â–¾</span>
  </div>
  <div class="section-body">
    <table>
      <tr><th></th><th>Indice</th><th>Index</th></tr>
      <tr>
        <td><strong>DÃ©finition</strong></td>
        <td>NumÃ©ro de la composante (ex: i=3)</td>
        <td>DÃ©placement en octets depuis l'adresse de base</td>
      </tr>
      <tr>
        <td><strong>Avantages</strong></td>
        <td>Plus intuitif Â· Ne dÃ©pend pas du type de donnÃ©es</td>
        <td>Directement utilisable en mÃ©moire Â· Idx<sub>ligne</sub> + Idx<sub>col</sub> = Idx<sub>composante</sub></td>
      </tr>
      <tr>
        <td><strong>InconvÃ©nient</strong></td>
        <td>Doit Ãªtre converti en index (Ã— lg) pour l'utiliser</td>
        <td>DÃ©pend de lg, moins intuitif Ã  lire</td>
      </tr>
      <tr>
        <td><strong>Conversion</strong></td>
        <td colspan="2" style="text-align:center; font-family:'JetBrains Mono',monospace; color:var(--accent4);">Index = Indice Ã— lg</td>
      </tr>
    </table>

    <div class="purple-box">
      <div class="box-label label-purple">PropriÃ©tÃ© clÃ© des index (2D)</div>
      Index<sub>composante</sub> = Index<sub>ligne</sub> + Index<sub>colonne</sub><br>
      <span style="color:var(--muted); font-size:0.88rem;">ce qui permet de calculer les deux contributions sÃ©parÃ©ment et de les additionner.</span>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="quiz-wrap" id="quiz">
  <h3>ğŸ§  Quiz de rÃ©vision â€” Chapitre 6</h3>

  <div class="quiz-card" id="q1">
    <p class="quiz-q"><strong>Q1.</strong> Un vecteur v de mots 32 bits (lg=4) commence Ã  l'adresse Î±. Quelle est l'adresse de v[5] (indice base 0) ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” cela serait vrai si lg=1 ou si les indices commencaient a 1.')">Î± + 5</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q1','Correct ! Index = i Ã— lg = 5 Ã— 4 = 20 octets.')">Î± + 20</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q1','Non â€” ce serait la 6e cellule avec des indices base 1.')">Î± + 16</button>
    </div>
    <p class="quiz-feedback" id="q1-fb"></p>
  </div>

  <div class="quiz-card" id="q2">
    <p class="quiz-q"><strong>Q2.</strong> Quelle instruction ARM lit un mot 32 bits avec un index variable dans x2 ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” cette syntaxe est pour un index constant connu a la compilation.')"><code>ldrsw x1, [x0, #8]</code></button>
      <button class="quiz-opt" onclick="ans(this,'correct','q2','Oui ! On place le registre x2 (contenant iÃ—lg) directement comme offset.')"><code>ldrsw x1, [x0, x2]</code></button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q2','Non â€” ldr sans suffix signe ne gere pas l extension de signe pour 32 bits.')"><code>ldr x1, [x0, x2]</code></button>
    </div>
    <p class="quiz-feedback" id="q2-fb"></p>
  </div>

  <div class="quiz-card" id="q3">
    <p class="quiz-q"><strong>Q3.</strong> Pour une matrice A[MÃ—N] de mots 32 bits (base 0), quelle est la formule d'adresse de A[i, j] ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” il manque la taille de l element et la contribution de la colonne.')">A + i Ã— N</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q3','Non â€” il faut multiplier par lg pour obtenir un deplacement en octets.')">A + i Ã— N + j</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q3','Exact ! (iÃ—N + j) donne l index lineaire, que l on multiplie par lg=4 pour obtenir le deplacement en octets.')">A + (i Ã— N + j) Ã— 4</button>
    </div>
    <p class="quiz-feedback" id="q3-fb"></p>
  </div>

  <div class="quiz-card" id="q4">
    <p class="quiz-q"><strong>Q4.</strong> On dÃ©clare <code>m1: .skip 4*100*100</code>. Que reprÃ©sente cette dÃ©claration ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” .skip reserve de l espace, il n y a pas de valeurs initialisees.')">Un vecteur de 400 valeurs initialisÃ©es Ã  0</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q4','Oui ! On reserve 40 000 octets pour une matrice 100x100 de mots 32 bits (4 octets chacun).')">Une matrice 100Ã—100 de mots 32 bits non initialisÃ©e</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q4','Non â€” le .skip est dans .bss, pas dans .rodata.')">Une constante de 40 000</button>
    </div>
    <p class="quiz-feedback" id="q4-fb"></p>
  </div>

  <div class="quiz-card" id="q5">
    <p class="quiz-q"><strong>Q5.</strong> Quelle est la diffÃ©rence entre un <em>indice</em> et un <em>index</em> ?</p>
    <div class="quiz-opts">
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” les deux peuvent designer des tableaux 1D ou 2D.')">L indice est pour les tableaux 1D, l index pour les tableaux 2D</button>
      <button class="quiz-opt" onclick="ans(this,'correct','q5','Exact ! L indice est le numero logique (ex: 3e element), l index est le deplacement reel en memoire (ex: 12 octets si lg=4).')">L indice est le numero de la composante, l index est le deplacement en octets</button>
      <button class="quiz-opt" onclick="ans(this,'wrong','q5','Non â€” c est l inverse : l indice est independant de lg, l index en depend.')">L index est independant du type, l indice depend de lg</button>
    </div>
    <p class="quiz-feedback" id="q5-fb"></p>
  </div>

</div>
</main>`,
    script: `// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggle(header) {
  header.closest('.section').classList.toggle('collapsed');
}
function ans(btn, result, qid, feedback) {
  const card = document.getElementById(qid);
  card.querySelectorAll('.quiz-opt').forEach(o => { o.disabled = true; o.style.opacity = '0.5'; });
  btn.style.opacity = '1';
  btn.classList.add(result);
  document.getElementById(qid + '-fb').textContent = (result === 'correct' ? 'âœ… ' : 'âŒ ') + feedback;
}
document.querySelectorAll('.toc-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    e.preventDefault();
    const t = document.querySelector(btn.getAttribute('href'));
    if (t) { t.scrollIntoView({ behavior: 'smooth', block: 'start' }); if (t.classList.contains('collapsed')) t.classList.remove('collapsed'); }
  });
});

// â”€â”€ VECTOR VISUALIZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderVector() {
  const lg = parseInt(document.getElementById('vlg').value) || 4;
  const n  = Math.min(parseInt(document.getElementById('vn').value) || 6, 10);
  const i  = parseInt(document.getElementById('vi').value) || 0;
  const iClamped = Math.max(0, Math.min(i, n - 1));

  // Build memory strip
  let strip = '';
  for (let k = 0; k < n; k++) {
    const offset = k * lg;
    const cls = k === iClamped ? 'highlight' : '';
    strip += \`<div class="mem-cell \${cls}">
      <div class="cell-idx">[\${k}]</div>
      <div class="cell-val">v[\${k}]</div>
      <div class="cell-addr">Î±+\${offset}</div>
    </div>\`;
  }
  document.getElementById('vec-strip').innerHTML = \`<div class="mem-strip">\${strip}</div>\`;

  const offset = iClamped * lg;
  const resultEl = document.getElementById('vec-result');
  resultEl.style.display = 'block';
  resultEl.innerHTML = \`
    <div class="step"><span class="step-label">Formule :</span><span class="step-val">Î± + i Ã— lg</span></div>
    <div class="step"><span class="step-label">Substitution :</span><span class="step-val">Î± + \${iClamped} Ã— \${lg}</span></div>
    <div class="step"><span class="step-label">RÃ©sultat :</span><span class="step-val">Î± + <em>\${offset}</em> octets</span></div>
    <div class="step"><span class="step-label">Instruction ARM :</span><span class="step-val" style="color:var(--accent3); font-size:0.88rem;">ldrsw x1, [x0, #\${offset}]  &nbsp;<span style="color:var(--muted)">(si index constant)</span></span></div>\`;
}
renderVector();

// â”€â”€ MATRIX VISUALIZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let matState = { M: 3, N: 4, lg: 4 };

function renderMatrix() {
  const M  = Math.min(parseInt(document.getElementById('mM').value) || 3, 5);
  const N  = Math.min(parseInt(document.getElementById('mN').value) || 4, 6);
  const lg = parseInt(document.getElementById('mLg').value) || 4;
  matState = { M, N, lg };

  // Build grid
  const cols = N + 1;
  let gridHtml = \`<div class="matrix-grid" style="grid-template-columns: repeat(\${cols}, 44px);" id="mat-grid">\`;
  // Header row
  gridHtml += \`<div class="mat-cell header-row" style="background:transparent; border-color:transparent;"></div>\`;
  for (let j = 0; j < N; j++) gridHtml += \`<div class="mat-cell header-row">j=\${j}</div>\`;
  // Data rows
  for (let r = 0; r < M; r++) {
    gridHtml += \`<div class="mat-cell header-col">i=\${r}</div>\`;
    for (let c = 0; c < N; c++) {
      const linIdx = r * N + c;
      gridHtml += \`<div class="mat-cell" data-i="\${r}" data-j="\${c}" data-lin="\${linIdx}" onclick="selectCell(\${r},\${c})">[\${r},\${c}]</div>\`;
    }
  }
  gridHtml += '</div>';
  document.getElementById('mat-grid-wrap').innerHTML = gridHtml;

  // Build linear strip
  let stripHtml = '';
  for (let k = 0; k < M * N; k++) {
    const ri = Math.floor(k / N), ci = k % N;
    stripHtml += \`<div class="mem-cell" id="strip-\${k}">
      <div class="cell-idx">[\${ri},\${ci}]</div>
      <div class="cell-val">\${k}</div>
      <div class="cell-addr">A+\${k*lg}</div>
    </div>\`;
  }
  document.getElementById('mat-strip').innerHTML = stripHtml;
  document.getElementById('mat-strip-wrap').style.display = 'block';
  document.getElementById('mat-result').style.display = 'none';
}

function selectCell(i, j) {
  const { M, N, lg } = matState;
  // Highlight grid
  document.querySelectorAll('.mat-cell[data-i]').forEach(el => el.classList.remove('selected'));
  const cell = document.querySelector(\`.mat-cell[data-i="\${i}"][data-j="\${j}"]\`);
  if (cell) cell.classList.add('selected');

  // Highlight strip
  const linIdx = i * N + j;
  document.querySelectorAll('.mem-cell').forEach(el => el.classList.remove('highlight'));
  const stripEl = document.getElementById(\`strip-\${linIdx}\`);
  if (stripEl) { stripEl.classList.add('highlight'); stripEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); }

  // Show calculation
  const offsetLigne = i * N * lg;
  const offsetCol   = j * lg;
  const total       = (i * N + j) * lg;
  const resultEl    = document.getElementById('mat-result');
  resultEl.style.display = 'block';
  resultEl.innerHTML = \`
    <div class="step"><span class="step-label">Cellule sÃ©lectionnÃ©e :</span><span class="step-val" style="color:var(--accent4)">A[\${i}, \${j}]</span></div>
    <div class="step"><span class="step-label">Formule :</span><span class="step-val">A + (iÃ—N + j) Ã— lg</span></div>
    <div class="step"><span class="step-label">Offset ligne :</span><span class="step-val">\${i} Ã— \${N} Ã— \${lg} = <em>\${offsetLigne}</em> octets</span></div>
    <div class="step"><span class="step-label">Offset colonne :</span><span class="step-val">\${j} Ã— \${lg} = <em>\${offsetCol}</em> octets</span></div>
    <div class="step"><span class="step-label">Index linÃ©aire :</span><span class="step-val">\${i}Ã—\${N} + \${j} = <em>\${linIdx}</em></span></div>
    <div class="step"><span class="step-label">DÃ©placement total :</span><span class="step-val">A + <em>\${total}</em> octets</span></div>\`;
}

renderMatrix();`
  },
];

</script>

<script>
const ACCENT_RGB = {
  '#5b8dee':'91,141,238',
  '#e05c7a':'224,92,122',
  '#36c9a0':'54,201,160',
  '#f5a623':'245,166,35',
  '#c97af5':'201,122,245',
};

let active = -1;
const frames = [];

function buildUI() {
  const nav = document.getElementById('snav');
  const grid = document.getElementById('ch-grid');
  const container = document.getElementById('ch-container');

  CHAPTERS.forEach((ch, i) => {
    // â”€â”€ Sidebar nav item
    const item = document.createElement('div');
    item.className = 'nav-item';
    item.style.setProperty('--ch-accent', ch.accent);
    item.innerHTML = `
      <div class="nav-num">0${i+1}</div>
      <div class="nav-text">
        <div class="nav-ch">Chapitre ${i+1}</div>
        <div class="nav-title">${ch.subtitle}</div>
      </div>`;
    item.addEventListener('click', () => go(i));
    nav.appendChild(item);

    // â”€â”€ Welcome card
    const card = document.createElement('div');
    card.className = 'ch-card';
    card.style.cssText = `border-color:${ch.accent}33`;
    card.innerHTML = `
      <div class="ch-card-num" style="color:${ch.accent}">Chapitre ${i+1}</div>
      <div class="ch-card-title">${ch.subtitle}</div>
      <div class="ch-card-desc">${ch.desc}</div>`;
    card.addEventListener('mouseenter', () => card.style.borderColor = ch.accent+'77');
    card.addEventListener('mouseleave', () => card.style.borderColor = ch.accent+'33');
    card.addEventListener('click', () => go(i));
    grid.appendChild(card);

    // â”€â”€ Iframe for each chapter
    const iframe = document.createElement('iframe');
    iframe.className = 'ch-frame';
    iframe.setAttribute('scrolling', 'no');
    iframe._loaded = false;
    iframe._chIdx = i;
    container.appendChild(iframe);
    frames.push(iframe);
  });
}

function buildIframeDoc(ch) {
  return `<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;700;800&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>${ch.css}</style>
<style>
  html, body { margin: 0; overflow: hidden; }
</style>
</head>
<body>
${ch.body}
<script>
${ch.script}
<\/script>
<script>
// â”€â”€ Scroll forwarding: send all wheel events to parent window â”€â”€
document.addEventListener('wheel', function(e) {
  e.preventDefault();
  window.parent.postMessage({ type: 'wheel', deltaY: e.deltaY, deltaX: e.deltaX, deltaMode: e.deltaMode }, '*');
}, { passive: false });

// â”€â”€ Key forwarding: arrow keys, page up/down, space â”€â”€
document.addEventListener('keydown', function(e) {
  const keys = ['ArrowUp','ArrowDown','PageUp','PageDown',' '];
  if (keys.includes(e.key)) {
    window.parent.postMessage({ type: 'keydown', key: e.key }, '*');
  }
});

// â”€â”€ Auto-resize when DOM changes (collapsing sections, quiz answers etc) â”€â”€
function notifyHeight() {
  const h = document.body.scrollHeight;
  window.parent.postMessage({ type: 'resize', height: h }, '*');
}
const mo = new MutationObserver(notifyHeight);
mo.observe(document.body, { childList: true, subtree: true, attributes: true, characterData: true });
// Also after transitions
document.body.addEventListener('transitionend', notifyHeight);
document.body.addEventListener('animationend', notifyHeight);
// Initial height
window.addEventListener('load', notifyHeight);
setTimeout(notifyHeight, 300);
setTimeout(notifyHeight, 1000);
<\/script>
</body>
</html>`;
}

function resizeFrame(iframe, h) {
  if (h) {
    iframe.style.height = h + 'px';
  } else {
    try {
      const sh = iframe.contentDocument.body.scrollHeight;
      iframe.style.height = sh + 'px';
    } catch(e) {}
  }
}

// â”€â”€ Receive messages from iframes â”€â”€
window.addEventListener('message', function(e) {
  if (!e.data || !e.data.type) return;

  if (e.data.type === 'wheel') {
    // Multiply deltaY by line/page factor depending on deltaMode
    let dy = e.data.deltaY;
    if (e.data.deltaMode === 1) dy *= 20;      // DOM_DELTA_LINE
    if (e.data.deltaMode === 2) dy *= window.innerHeight; // DOM_DELTA_PAGE
    window.scrollBy({ top: dy, left: e.data.deltaX || 0, behavior: 'auto' });
  }

  if (e.data.type === 'keydown') {
    const scrollMap = {
      'ArrowDown': 80, 'ArrowUp': -80,
      'PageDown': window.innerHeight * 0.9, 'PageUp': -window.innerHeight * 0.9,
      ' ': window.innerHeight * 0.9
    };
    if (scrollMap[e.data.key] !== undefined) {
      window.scrollBy({ top: scrollMap[e.data.key], behavior: 'smooth' });
    }
  }

  if (e.data.type === 'resize') {
    // Find which iframe sent this
    for (const f of frames) {
      try {
        if (f.contentWindow === e.source) {
          resizeFrame(f, e.data.height);
          break;
        }
      } catch(_) {}
    }
  }
});

function go(idx) {
  // Hide welcome
  document.getElementById('welcome').style.display = 'none';

  // Deactivate all
  frames.forEach((f, i) => {
    f.classList.toggle('active', i === idx);
  });
  document.querySelectorAll('.nav-item').forEach((el, i) => {
    el.classList.toggle('active', i === idx);
  });

  // Load iframe content if not yet loaded
  const frame = frames[idx];
  if (!frame._loaded) {
    frame._loaded = true;
    const doc = frame.contentDocument || frame.contentWindow.document;
    doc.open();
    doc.write(buildIframeDoc(CHAPTERS[idx]));
    doc.close();
  }

  active = idx;
  window.scrollTo({ top: 0, behavior: 'instant' });
  updateProgress();
  if (window.innerWidth <= 768) closeSidebar();
}

// Progress bar tracks outer window scroll
function updateProgress() {
  const bar = document.getElementById('progress');
  const total = document.documentElement.scrollHeight - window.innerHeight;
  const pct = total > 0 ? window.scrollY / total : 0;
  bar.style.background = active >= 0 ? CHAPTERS[active].accent : '#5b8dee';
  bar.style.transform = `scaleX(${pct})`;
}
window.addEventListener('scroll', updateProgress);

// Resize iframes on window resize (re-request height from iframe)
window.addEventListener('resize', () => {
  frames.forEach(f => {
    if (f.classList.contains('active')) {
      try { f.contentWindow.postMessage({ type: 'requestHeight' }, '*'); } catch(_) {}
      resizeFrame(f);
    }
  });
});

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('overlay').classList.toggle('show');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('overlay').classList.remove('show');
}

buildUI();
</script>
</body>
</html>
